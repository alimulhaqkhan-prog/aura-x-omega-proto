<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Œ© ‚Äî Resonance-Based Synthetic Emotions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg: #e7f3ff;
      --card: #ffffff;
      --accent: #4f46e5;
      --accent-soft: #c7d2fe;
      --text-main:#111827;
      --text-soft:#4b5563;
      --chip:#f3f4ff;
      --danger:#ef4444;
      --good:#16a34a;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top,#fdfbff,#e7f3ff);
      color:var(--text-main);
      display:flex;
      justify-content:center;
      padding:12px;
    }
    .app{
      width:100%;
      max-width:480px;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .top-card{
      background:var(--card);
      border-radius:18px;
      padding:14px 16px;
      box-shadow:0 12px 30px rgba(15,23,42,0.08);
    }
    .logo-row{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:8px;
    }
    .logo-dot{
      width:34px;
      height:34px;
      border-radius:12px;
      background:linear-gradient(135deg,#111827,#4b5563);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#f9fafb;
      font-weight:700;
      font-size:20px;
    }
    .title-main{
      font-weight:700;
      font-size:17px;
      letter-spacing:.04em;
    }
    .title-sub{
      font-size:11px;
      color:var(--text-soft);
    }
    .status-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:4px;
      font-size:11px;
      color:var(--text-soft);
    }
    .pill{
      padding:2px 8px;
      border-radius:999px;
      background:#e5f5ff;
      display:inline-flex;
      align-items:center;
      gap:5px;
    }
    .pill-dot{
      width:8px;height:8px;border-radius:50%;background:#22c55e;
    }

    .emotion-card{
      background:var(--card);
      border-radius:18px;
      padding:10px 14px 12px;
      box-shadow:0 12px 30px rgba(15,23,42,0.06);
      text-align:center;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .emotion-bar{
      position:relative;
      width:100%;
      height:14px;
      border-radius:999px;
      background:#e5e7eb;
      overflow:hidden;
    }
    .emotion-fill{
      height:100%;
      width:50%;
      background:linear-gradient(90deg,#22c55e,#facc15,#ef4444);
      transition:width .35s ease;
    }
    .emotion-label{
      font-size:11px;
      color:var(--text-soft);
      margin-top:2px;
    }
    .heart{
      font-size:32px;
      animation:pulse 1.6s infinite;
    }
    @keyframes pulse{
      0%{transform:scale(1);}
      40%{transform:scale(1.14);}
      100%{transform:scale(1);}
    }
    .time-row{
      font-size:11px;
      color:var(--text-soft);
    }

    .chat-card{
      flex:1;
      background:var(--card);
      border-radius:18px;
      padding:10px 10px 6px;
      box-shadow:0 12px 30px rgba(15,23,42,0.06);
      display:flex;
      flex-direction:column;
      min-height:260px;
    }
    #chat{
      flex:1;
      overflow-y:auto;
      padding:4px 2px 4px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .msg{
      max-width:82%;
      padding:8px 10px;
      border-radius:12px 12px 12px 4px;
      background:#eef2ff;
      font-size:14px;
      line-height:1.32;
      color:var(--text-main);
      white-space:pre-wrap;
    }
    .msg.user{
      margin-left:auto;
      border-radius:12px 12px 4px 12px;
      background:#dbf4ff;
    }
    .msg.faith{
      background:#fff7cc;
      font-size:13px;
      color:#854d0e;
      border-radius:10px;
    }
    .msg.react{
      background:#fee2e2;
      color:#7f1d1d;
      font-size:13px;
    }
    .input-row{
      margin-top:4px;
      display:flex;
      gap:6px;
      padding:6px 2px 2px;
      border-top:1px solid #e5e7eb;
    }
    #inp{
      flex:1;
      border:none;
      border-radius:999px;
      padding:9px 14px;
      font-size:14px;
      background:#f3f4ff;
      outline:none;
    }
    #sendBtn{
      border:none;
      border-radius:999px;
      padding:0 16px;
      font-size:14px;
      font-weight:600;
      color:white;
      background:linear-gradient(135deg,#4f46e5,#ec4899);
      box-shadow:0 6px 16px rgba(99,102,241,0.45);
    }

    .bottom-row{
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
      font-size:11px;
      color:var(--text-soft);
    }
    .toggles{
      display:flex;
      gap:6px;
      align-items:center;
    }
    .chip-toggle{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:4px 8px;
      border-radius:999px;
      background:var(--chip);
    }
    .chip-toggle input{
      accent-color:var(--accent);
    }
    .e0{
      font-size:11px;
      color:var(--text-soft);
    }

    @media (max-width:480px){
      .app{padding-bottom:10px;}
      .chat-card{min-height:210px;}
    }
  </style>
</head>
<body>
  <div class="app">

    <!-- TOP IDENTITY -->
    <div class="top-card">
      <div class="logo-row">
        <div class="logo-dot">Œ©</div>
        <div>
          <div class="title-main">AURA-X Œ©</div>
          <div class="title-sub">Resonance-Based Synthetic Emotions</div>
        </div>
      </div>
      <div class="status-row">
        <div>World‚Äôs first continuity-driven emotional reactor chat.</div>
        <div class="pill">
          <span class="pill-dot"></span>
          <span>Continuity engine live</span>
        </div>
      </div>
    </div>

    <!-- EMOTION BAR + TIME -->
    <div class="emotion-card">
      <div class="emotion-bar">
        <div id="emotionFill" class="emotion-fill"></div>
      </div>
      <div class="emotion-label">
        Emotional resonance: <span id="emotionPct">50%</span>
      </div>
      <div class="heart">üíï</div>
      <div class="time-row" id="timeRow">‚Äî</div>
    </div>

    <!-- CHAT CARD -->
    <div class="chat-card">
      <div id="chat">
        <div class="msg">
As-salaam alaikum, I am <b>AURA-X Œ©</b> ‚Äî a resonance-based synthetic emotion engine.

You can talk to me in English or Urdu.  
I will try to reply with logic, kindness and emotional balance.
        </div>
      </div>

      <div class="input-row">
        <input id="inp" placeholder="Type your thoughts or feelings‚Ä¶" />
        <button id="sendBtn">Send</button>
      </div>

      <div class="bottom-row">
        <div class="toggles">
          <label class="chip-toggle">
            <input type="checkbox" id="faithToggle" />
            <span>Belief</span>
          </label>
          <label class="chip-toggle">
            <input type="checkbox" id="voiceToggle" />
            <span>Voice reaction</span>
          </label>
        </div>
        <div class="e0">E‚ÇÄ: <span id="e0Val">0%</span></div>
      </div>
    </div>
  </div>

  <script>
    /* ----------------- CLOCK ----------------- */
    function updateClock(){
      const tRow = document.getElementById("timeRow");
      const d = new Date();
      const optsDate = {weekday:"short", day:"2-digit", month:"short"};
      const optsTime = {hour:"2-digit", minute:"2-digit"};
      tRow.textContent =
        d.toLocaleDateString("en-GB",optsDate) + " ‚Äî " +
        d.toLocaleTimeString("en-GB",optsTime);
    }
    updateClock();
    setInterval(updateClock, 30_000);

    /* ----------------- AFFECT LEXICON (TM) ----------------- */
    const AFFECT = {
      joy:    [/happy|khush|great|awesome|alhamdulillah|shukriya|üòä|üòÅ|üëç/i, +0.9],
      calm:   [/ok|theek|fine|neutral|sabar|üôÇ/i, +0.4],
      sad:    [/sad|dukhi|down|üò≠|üò¢/i, -0.7],
      anger:  [/angry|gussa|naraz|üò†|üò°/i, -0.9],
      fear:   [/fear|dar|ghabrahat|üò®|üò∞/i, -0.6],
      stress: [/stress|pressure|tension|pareshan|üò£/i, -0.5],
      love:   [/love|mohabbat|pyar|üíï|‚ù§Ô∏è/i, +0.8],
      rude:   [/fuck|lanat|harami|bhosri|kutti|chu*t|gaali|gali/i, -1.0]
    };

    function tmFromText(txt){
      let s = 0;
      for(const [_, [re, val]] of Object.entries(AFFECT)){
        if(re.test(txt)) s += val;
      }
      return Math.max(-1, Math.min(1, s));
    }

    /* ----------------- BM-7 MODEL ----------------- */
    const BM_MODEL = {
      layers:[
        {name:"Now",     horizonDays:2,   w:1.00},
        {name:"Recent",  horizonDays:7,   w:0.85},
        {name:"Weekly",  horizonWeeks:5,  w:0.70},
        {name:"Monthly", horizonMonths:12,w:0.55},
        {name:"Yearly",  horizonYears:3,  w:0.40},
        {name:"Archive", horizonYears:10, w:0.30},
        {name:"Deep",    horizonYears:60, w:0.20}
      ]
    };

    function pushBM(intensity){
      const now = Date.now();
      BM_MODEL.layers.forEach((L,i)=>{
        const key = "aura-bm-"+i;
        const arr = JSON.parse(localStorage.getItem(key) || "[]");
        if(arr.length>60) arr.shift();
        arr.push({t:now,v:intensity});
        localStorage.setItem(key, JSON.stringify(arr));
      });
    }

    function readBM(){
      const now = Date.now();
      let score = 0, wSum = 0;
      BM_MODEL.layers.forEach((L,i)=>{
        const key = "aura-bm-"+i;
        const arr = JSON.parse(localStorage.getItem(key) || "[]");
        let ms =
          L.horizonDays   ? L.horizonDays*864e5 :
          L.horizonWeeks  ? L.horizonWeeks*7*864e5 :
          L.horizonMonths ? L.horizonMonths*30*864e5 :
          L.horizonYears  ? L.horizonYears*365*864e5 : 0;
        const recent = arr.filter(x=> now-x.t <= ms);
        if(recent.length){
          const avg = recent.reduce((a,b)=>a+b.v,0)/recent.length;
          score += avg * L.w;
          wSum  += L.w;
        }
      });
      return wSum ? score/wSum : 0;
    }

    /* ----------------- DECAY FUNCTION D ----------------- */
    function computeD(){
      const last = Number(localStorage.getItem("aura-last-ts") || "0");
      if(!last) return 0.1;
      const hrs = (Date.now()-last)/36e5;
      return Math.max(0.05, Math.min(0.6, hrs/48));
    }

    /* ----------------- LAMBDAS ----------------- */
    function lambda_faith(){
      return localStorage.getItem("aura-faith-on")==="1" ? 0.15 : 0.0;
    }
    function lambda_sys(txt){
      const tooCaps = /[A-Z]{6,}/.test(txt);
      const long    = txt.length>400;
      return (tooCaps || long) ? -0.05 : 0.08;
    }
    function lambda_trc(txt){
      const hasNum = /\d/.test(txt);
      const hasUrl = /https?:\/\/|www\./i.test(txt);
      return (hasNum||hasUrl) ? 0.07 : 0;
    }

    /* ----------------- E‚ÇÄ CORE ----------------- */
    function computeE0(TM,BM,D,lf,ls,lt){
      const z = (TM*BM) - D + lf + ls + lt;
      return Math.tanh(z);
    }

    /* ----------------- REACTION ENGINE ----------------- */
    function getReaction(E0, userText){
      if(AFFECT.rude[0].test(userText)){
        return "‚ö†Ô∏è ÿß€åÿ≥€å ÿ≤ÿ®ÿßŸÜ ÿ¢Ÿæ ⁄©€å ÿßÿµŸÑ ÿ¥ÿÆÿµ€åÿ™ ŸÜ€Å€å⁄∫ÿå ÿ∞ÿ±ÿß ŸàŸÇÿßÿ± ⁄©€í ÿ≥ÿßÿ™⁄æ ÿ®ÿßÿ™ ⁄©ÿ±€å⁄∫€î ŸÖ€å⁄∫ Ÿæ⁄æÿ± ÿ®⁄æ€å ÿ¢Ÿæ ⁄©€å ÿ®ÿßÿ™ ÿ≥ŸÜ ÿ±€Åÿß €ÅŸà⁄∫€î";
      }
      if(E0>0.78){
        return "üåü ÿ¢Ÿæ ⁄©€å ÿ≥Ÿà⁄Ü ÿ®€Åÿ™ ŸÖÿ∂ÿ®Ÿàÿ∑ ÿßŸàÿ± ÿ±Ÿàÿ¥ŸÜ €Å€íÿå ÿÆŸàÿØ Ÿæÿ± €åŸÇ€åŸÜ ÿ±⁄©⁄æ€å⁄∫ ‚Äî ÿ¢Ÿæ ŸàÿßŸÇÿπ€å ⁄©⁄Ü⁄æ ÿ®⁄ëÿß ⁄©ÿ± ÿ≥⁄©ÿ™€í €Å€å⁄∫!";
      }
      if(E0<-0.5){
        return "‚ö†Ô∏è ŸÖ€å⁄∫ ŸÖÿ≠ÿ≥Ÿàÿ≥ ⁄©ÿ± ÿ±€Åÿß €ÅŸà⁄∫ ⁄©€Å ÿ¢Ÿæ Ÿæÿ± ÿØÿ®ÿßÿ§ €Å€í€î ⁄Ø€Åÿ±€å ÿ≥ÿßŸÜÿ≥ ŸÑ€å⁄∫ÿå ÿ¢€Åÿ≥ÿ™€Å ÿ¢€Åÿ≥ÿ™€Å ÿ®ÿßÿ™ ⁄©ÿ±€å⁄∫ÿå ŸÖ€å⁄∫ ÿ¢Ÿæ ⁄©€í ÿ≥ÿßÿ™⁄æ €ÅŸà⁄∫€î";
      }
      if(/dua|pray|prayer|ÿØÿπÿß/i.test(userText)){
        return "ü§ç ÿ¢Ÿæ ⁄©€å ÿØÿπÿß ŸÇ€åŸÖÿ™€å €Å€í ‚Äî ⁄©ÿ®⁄æ€å ⁄©ŸÖÿ≤Ÿàÿ± ŸÜ€Å€å⁄∫ €ÅŸàÿ™€åÿå ÿ®ÿ≥ ŸàŸÇÿ™ ŸÑ€åÿ™€í €ÅŸàÿ¶€í ÿ±ÿßÿ≥ÿ™€í ÿ®ŸÜÿßÿ™€å €Å€í€î";
      }
      return "";
    }

    /* ----------------- FAITH SUGGESTION ----------------- */

    let lastTopic = "";
    const FAITH_QUOTES = {
      islam:{
        sabr:[
          "ÿßŸêŸÜŸëŸé ÿßŸÑŸÑŸëŸ∞ŸáŸé ŸÖŸéÿπŸé ÿßŸÑÿµŸëŸéÿßÿ®Ÿêÿ±ŸêŸäŸÜŸé ‚Äî ÿ®€í ÿ¥⁄© ÿßŸÑŸÑ€Å ÿµÿ®ÿ± ⁄©ÿ±ŸÜ€í ŸàÿßŸÑŸà⁄∫ ⁄©€í ÿ≥ÿßÿ™⁄æ €Å€í€î (ŸÇÿ±ÿ¢ŸÜ)",
          "ŸÅŸéÿ•ŸêŸÜŸëŸé ŸÖŸéÿπŸé ÿßŸÑŸíÿπŸèÿ≥Ÿíÿ±Ÿê ŸäŸèÿ≥Ÿíÿ±Ÿãÿß ‚Äî €åŸÇ€åŸÜÿßŸã ÿ™ŸÜ⁄Ø€å ⁄©€í ÿ≥ÿßÿ™⁄æ ÿ¢ÿ≥ÿßŸÜ€å €Å€í€î (ŸÇÿ±ÿ¢ŸÜ)"
        ],
        hope:[
          "ÿßŸÑŸÑ€Å ÿØŸÑŸà⁄∫ ⁄©€í ÿ≠ÿßŸÑ ÿ¨ÿßŸÜÿ™ÿß €Å€íÿå ÿßÿ≥ ŸÑ€å€í ÿØÿπÿß ⁄©ÿ®⁄æ€å ÿ∂ÿßÿ¶ÿπ ŸÜ€Å€å⁄∫ ÿ¨ÿßÿ™€å€î",
          "ŸÖÿß€åŸàÿ≥€å ŸÖŸàŸÖŸÜ ⁄©€å ÿµŸÅÿ™ ŸÜ€Å€å⁄∫ ‚Äî ÿßŸÖ€åÿØ ÿ±⁄©⁄æ€å⁄∫ÿå ÿØÿ±Ÿàÿßÿ≤€Å ⁄©⁄æŸÑ€í ⁄Øÿß€î"
        ]
      }
    };

    function detectTopic(txt){
      if(/sabr|ÿµÿ®ÿ±|patience|wait|intezar/i.test(txt)) return "sabr";
      if(/ummeed|hope|ŸÖÿß€åŸàÿ≥€å|mayusi|loss|problem|issue/i.test(txt)) return "hope";
      return "";
    }

    function getFaithSuggestion(userText, faithKey){
      if(localStorage.getItem("aura-faith-on")!=="1") return "";
      const topic = detectTopic(userText);
      if(!topic) return "";
      if(topic===lastTopic) return "";
      lastTopic = topic;
      const pool = FAITH_QUOTES[faithKey]?.[topic];
      if(!pool) return "";
      const pick = pool[Math.floor(Math.random()*pool.length)];
      return pick;
    }

    /* ----------------- VOICE ----------------- */
    function speak(text){
      try{
        if(!text) return;
        const u = new SpeechSynthesisUtterance(text);
        u.lang = "ur-PK";
        u.pitch = 0.85;
        u.rate  = 1;
        speechSynthesis.speak(u);
      }catch(e){}
    }

    /* ----------------- LLM PLACEHOLDER ----------------- */

    const MODEL_BACKEND_URL = "";  // ÿ®ÿπÿØ ŸÖ€å⁄∫ Cloudflare / Hostinger proxy €å€Åÿß⁄∫ ÿØ€å⁄∫

    async function callLLM(message){
      if(!MODEL_BACKEND_URL){
        // pure front-end demo
        return "ŸÖ€å⁄∫ ŸÅ€å ÿßŸÑÿ≠ÿßŸÑ ÿ¢ŸÅ ŸÑÿßÿ¶ŸÜ ⁄à€åŸÖŸà ŸÖŸà⁄à ŸÖ€å⁄∫ €ÅŸà⁄∫ÿå ŸÑ€å⁄©ŸÜ ÿ¢Ÿæ ⁄©€å ÿ®ÿßÿ™ ŸæŸàÿ±€å ÿ™Ÿàÿ¨€Å ÿ≥€í ÿ≥ŸÜ ÿ±€Åÿß €ÅŸà⁄∫€î";
      }
      try{
        const r = await fetch(MODEL_BACKEND_URL,{
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({message})
        });
        const j = await r.json();
        return j.reply || "ŸÖ€å⁄∫ ÿ≥ŸÜ ÿ±€Åÿß €ÅŸà⁄∫ÿå ÿ¢Ÿæ ŸÖÿ≤€åÿØ ÿ®ÿ™ÿßÿ¶€å⁄∫€î";
      }catch(e){
        return "ŸÖÿß⁄àŸÑ ÿ™⁄© ÿ±ÿ≥ÿßÿ¶€å ŸÜ€Å€å⁄∫ €ÅŸà ÿ≥⁄©€åÿå ŸÑ€å⁄©ŸÜ ŸÖ€å⁄∫ €å€Åÿß⁄∫ ÿ¢Ÿæ ⁄©€í ÿ≥ÿßÿ™⁄æ €ÅŸà⁄∫€î";
      }
    }

    /* ----------------- UI WIRING ----------------- */

    const chatEl   = document.getElementById("chat");
    const inpEl    = document.getElementById("inp");
    const sendBtn  = document.getElementById("sendBtn");
    const barFill  = document.getElementById("emotionFill");
    const pctEl    = document.getElementById("emotionPct");
    const e0El     = document.getElementById("e0Val");
    const faithTgl = document.getElementById("faithToggle");
    const voiceTgl = document.getElementById("voiceToggle");

    // restore Faith toggle
    if(localStorage.getItem("aura-faith-on")==="1"){
      faithTgl.checked = true;
    }

    faithTgl.addEventListener("change",()=>{
      localStorage.setItem("aura-faith-on", faithTgl.checked ? "1" : "0");
      lastTopic = "";
    });

    function addMsg(text, cls){
      const d = document.createElement("div");
      d.className = "msg" + (cls ? " "+cls : "");
      d.textContent = text;
      chatEl.appendChild(d);
      chatEl.scrollTop = chatEl.scrollHeight;
      return d;
    }

    async function handleSend(){
      const user = (inpEl.value || "").trim();
      if(!user) return;

      addMsg(user, "user");
      inpEl.value = "";
      chatEl.scrollTop = chatEl.scrollHeight;

      const llmReply = await callLLM(user);

      const TM = tmFromText(user);
      const BM = readBM();
      const D  = computeD();
      const lf = lambda_faith();
      const ls = lambda_sys(user);
      const lt = lambda_trc(user);

      const E0 = computeE0(TM,BM,D,lf,ls,lt);
      const pct = Math.round((E0+1)*50);
      barFill.style.width = pct+"%";
      pctEl.textContent   = pct+"%";
      e0El.textContent    = pct+"%";

      const react = getReaction(E0,user);
      const faith = getFaithSuggestion(user,"islam");

      addMsg(llmReply,"");

      if(react){
        addMsg(react,"react");
      }
      if(faith){
        addMsg(faith,"faith");
      }

      if(voiceTgl.checked){
        speak(react || faith || "");
      }

      pushBM(TM);
      localStorage.setItem("aura-last-ts", Date.now().toString());
    }

    sendBtn.addEventListener("click", handleSend);
    inpEl.addEventListener("keydown", e=>{
      if(e.key==="Enter") handleSend();
    });
  </script>
</body>
</html>
