<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AURA-X Î© â€” resonance-based AI with synthetic emotions</title>
<link rel="preconnect" href="https://api.open-meteo.com">
<style>
:root{
  --bg:#eaf4ff;
  --card:#ffffff;
  --ink:#0b1220;
  --muted:#5e6b85;
  --accent:#22c55e;
  --chip:#eef2ff;
  --bar:#cfd6e4;
  --barFill:#9ad0ff;
  --glow:0 14px 40px rgba(15,23,42,.18);
  --radius:16px;
  --radius-sm:12px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font:16px/1.5 Inter,system-ui,Segoe UI,Arial;
  color:var(--ink);
  background:linear-gradient(#f7fbff, var(--bg));
}
.wrap{max-width:820px;margin:20px auto 110px;padding:0 14px}
.brand{display:flex;flex-direction:column;align-items:center;gap:8px;margin:6px 0 8px}
.brand img{width:108px;height:auto;filter:drop-shadow(0 4px 12px rgba(2,6,23,.15))}
.title{
  background:var(--card);padding:12px 16px;border-radius:var(--radius);
  box-shadow:var(--glow); text-align:center; font-weight:800; letter-spacing:.2px;
}
.eBar{height:14px;background:var(--bar);border-radius:999px;overflow:hidden;
  box-shadow:inset 0 2px 5px rgba(2,6,23,.08);margin:14px 0}
.eFill{height:100%;width:38%;background:linear-gradient(90deg,#ffd1e9,#b3e1ff);
  transition:width .45s cubic-bezier(.2,.8,.2,1)}
.ePct{position:absolute;margin-top:-28px;right:18px;color:#475569;font-weight:700;font-size:13px}
.heart{font-size:46px;text-align:center;margin:10px 0 4px}
.heart .h{display:inline-block;animation:pulse 1.4s ease-in-out infinite}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.12)}100%{transform:scale(1)}}
.meta{display:flex;justify-content:center;gap:14px;align-items:center;color:#334155;font-weight:600;margin:2px 0 12px}
.card{background:var(--card);border-radius:var(--radius);box-shadow:var(--glow);padding:14px}
#chat{max-height:52vh;overflow:auto;scroll-behavior:smooth}
.msg{background:#f1f5f9;border-radius:var(--radius-sm);padding:12px 14px;margin:10px 0}
.msg.user{background:#e0f2fe;margin-left:auto;max-width:85%}
.msg.assist{background:#eef2ff;max-width:95%}
.msg.faith{
  background:#fefce8;
  color:#854d0e;
  font-size:13px;
  font-style:italic;
}
.inpDock{
  position:fixed;left:0;right:0;bottom:0;
  background:linear-gradient(180deg,transparent,rgba(255,255,255,.9) 20%, rgba(255,255,255,.98));
  padding:10px 14px 16px;backdrop-filter:saturate(140%) blur(6px)
}
.inpWrap{display:flex;gap:10px;align-items:center;max-width:820px;margin:0 auto}
#inp{
  flex:1;border:1px solid #cbd5e1;background:#f8fafc;border-radius:999px;
  padding:12px 16px;font-size:16px;
  box-shadow:inset 0 2px 4px rgba(2,6,23,.05)
}
#send{
  border:0;border-radius:999px;background:linear-gradient(90deg,#6ea8ff,#ff86b9);
  color:#00131e;padding:12px 18px;font-weight:800;box-shadow:0 8px 20px rgba(30,58,138,.25)
}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.chip{
  border:0;padding:8px 14px;border-radius:999px;background:var(--chip);font-weight:700;color:#0f172a
}
.chip.on{background:#d1fae5;color:#064e3b}
.sheet{position:fixed;inset:0;background:rgba(2,6,23,.45);backdrop-filter:saturate(140%) blur(6px);
  display:none;z-index:50}
.sheet.show{display:block}
.sheet .panel{position:absolute;left:0;right:0;bottom:0;border-radius:16px 16px 0 0;
  background:#fff;padding:16px 16px 24px;box-shadow:0 -10px 30px rgba(2,6,23,.25)}
.sheet .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
.sheet .faiths{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
.sheet .faiths .opt{padding:10px 12px;border-radius:12px;border:1px solid #e5e7eb;background:#f8fafc;font-weight:700}
.sheet .faiths .opt.active{background:#e0f2fe;border-color:#38bdf8;color:#0c4a6e}
.switch{display:flex;align-items:center;gap:8px}
.toggle{accent-color:#0ea5e9}
body.modal-open{height:100vh;overflow:hidden}
#dbg{position:fixed;right:14px;bottom:86px;background:#fff;border-radius:12px;box-shadow:var(--glow);
  padding:8px 10px;font:12px/1.35 ui-monospace,Menlo,Consolas}
@media (max-width:480px){ .title{font-size:15px} }
</style>
</head>
<body>

<div class="wrap">
  <div class="brand">
    <img src="https://raw.githubusercontent.com/alimulhaqkhan/aura-x-omega-proto/main/assets/img/aura-x-logo.png" alt="AURA-X" onerror="this.style.opacity=.2">
    <div class="title">AURA-X Î© â€” the worldâ€™s first resonance-based AI with synthetic emotions.</div>
  </div>

  <div class="eBar"><div class="eFill" id="emotionFill"></div></div>
  <div class="ePct" id="ePct">59%</div>

  <div class="heart"><span class="h">ðŸ’•</span></div>

  <div class="meta">
    <span id="clk">â€”</span>
    <span>|</span>
    <span id="wx">loadingâ€¦</span>
  </div>

  <div class="card">
    <div id="chat">
      <div class="msg assist">
        Assalamualaikum! Iâ€™m AURA-X Î© â€” the worldâ€™s first resonance-based AI with synthetic emotions. How can I help you today?
      </div>
    </div>
    <div class="row" style="margin-top:12px;justify-content:flex-end">
      <button id="beliefBtn" class="chip">ðŸ”˜ Belief</button>
      <button id="voiceBtn" class="chip">Voice</button>
    </div>
  </div>
</div>

<div class="inpDock">
  <div class="inpWrap">
    <input id="inp" placeholder="Type your questionâ€¦"/>
    <button id="send">Send</button>
  </div>
</div>

<!-- Belief popup -->
<div class="sheet" id="beliefSheet">
  <div class="panel">
    <div class="row">
      <strong>Belief settings</strong>
      <button id="closeBelief" class="chip">Close</button>
    </div>

    <div class="switch" style="margin-top:10px;">
      <input type="checkbox" id="faithOn" class="toggle">
      <label for="faithOn"><b>Faith ON</b> â€” add short encouragements (optional)</label>
    </div>

    <p style="margin:.5rem 0 .25rem">Pick your belief or philosophy (local only):</p>
    <div class="faiths" id="faithGrid"></div>
  </div>
</div>

<div id="dbg" hidden>TM:0 BM:0 D:0 Î»_f:0 Î»_s:0 Î»_t:0 â†’ 59%</div>

<script>
/* ---------- BASIC CONFIG ---------- */
const ENDPOINT_URL = "https://alimai.online/api/chat.php";   // Ø¢Ù¾ Ú©ÛŒ API
const DEBUG_ON = true;

/* ---------- CLOCK & WEATHER ---------- */
const clk=document.getElementById('clk');
const wx=document.getElementById('wx');
function tick(){
  clk.textContent=new Date().toLocaleString([],{
    weekday:'short',day:'2-digit',month:'short',
    hour:'2-digit',minute:'2-digit'
  });
}
setInterval(tick,1000); tick();

async function getWeather(){
  try{
    const geo = await new Promise((res,rej)=>{
      if(!navigator.geolocation) return rej();
      navigator.geolocation.getCurrentPosition(p=>res(p.coords),()=>rej());
    });
    const {latitude:lat,longitude:lon}=geo;
    const r=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m`);
    const j=await r.json();
    const t=j?.current?.temperature_2m;
    wx.textContent = (t!==undefined)?`${t.toFixed(1)}Â°C`:"Weather unavailable";
  }catch{ wx.textContent="Weather unavailable"; }
}
getWeather();

/* ---------- EMOTION ENGINE (Eâ‚€) ---------- */
const AFFECT={
  joy:[/happy|great|awesome|alhamdulillah|thanks|shukriya|ðŸ˜Š|ðŸ˜|ðŸ‘/i,+0.9],
  calm:[/ok|fine|theek|neutral|sabar|breath|ðŸ™‚/i,+0.4],
  sad:[/sad|down|dukhi|ðŸ˜­|ðŸ˜¢/i,-0.7],
  anger:[/angry|gussa|rage|ðŸ˜ |ðŸ˜¡/i,-0.9],
  fear:[/fear|dar|anxious|ðŸ˜¨|ðŸ˜°/i,-0.6],
  love:[/love|mohabbat|ðŸ’•|â¤ï¸/i,+0.8],
  stress:[/stress|pressure|tension|ðŸ˜£/i,-0.5]
};
const BM=[
  {days:2,w:1.00},
  {days:7,w:0.85},
  {days:35,w:0.70},
  {days:360,w:0.55},
  {days:1095,w:0.40},
  {days:3650,w:0.30},
  {days:21900,w:0.20}
];
function tm(txt){let s=0;for(const[_,[re,v]]of Object.entries(AFFECT)){if(re.test(txt))s+=v;}return Math.max(-1,Math.min(1,s));}
function pushBM(v){
  const now=Date.now();
  BM.forEach((_,i)=>{
    const k='a-bm-'+i;
    const arr=JSON.parse(localStorage.getItem(k)||'[]');
    if(arr.length>60)arr.shift();
    arr.push({t:now,v});
    localStorage.setItem(k,JSON.stringify(arr));
  });
}
function readBM(){
  const now=Date.now();let sc=0,ws=0;
  BM.forEach((L,i)=>{
    const k='a-bm-'+i;
    const arr=JSON.parse(localStorage.getItem(k)||'[]');
    const ms=L.days*864e5;
    const rec=arr.filter(x=>now-x.t<=ms);
    if(rec.length){
      const avg=rec.reduce((a,b)=>a+b.v,0)/rec.length;
      sc+=avg*L.w;ws+=L.w;
    }
  });
  return ws?sc/ws:0;
}
function decayD(){
  const last=Number(localStorage.getItem('a-last')||'0');
  if(!last)return 0.1;
  const h=(Date.now()-last)/36e5;
  return Math.max(0.05,Math.min(0.6,h/48));
}
function getFaithOn(){return localStorage.getItem('a-faith-on')==='1';}
function lam_f(){return getFaithOn()?0.15:0;}
function lam_s(txt){const caps=/[A-Z]{6,}/.test(txt);const long=txt.length>400;return(caps||long)?-0.05:0.08;}
function lam_t(txt){const hasNum=/\d/.test(txt),url=/https?:\/\/|www\./i.test(txt);return(hasNum||url)?0.07:0;}
function E0(TM,BMv,D,lf,ls,lt){return Math.tanh((TM*BMv)-D+lf+ls+lt);}
const eFill=document.getElementById('emotionFill');
const ePct=document.getElementById('ePct');
const dbg=document.getElementById('dbg');
function updateBar(p){eFill.style.width=p+'%';ePct.textContent=p+'%';}
function afterTurn(userText,assistantText){
  const TM=tm(userText);
  const BMv=readBM();
  const D=decayD();
  const lf=lam_f(),ls=lam_s(userText),lt=lam_t(userText);
  const e=E0(TM,BMv,D,lf,ls,lt);
  const pct=Math.max(5,Math.min(98,Math.round((e+1)*0.5*100)));
  updateBar(pct);
  const aff=Math.max(-1,Math.min(1,tm(assistantText||userText)));
  pushBM(aff);localStorage.setItem('a-last',Date.now().toString());
  if(DEBUG_ON){
    dbg.hidden=false;
    dbg.textContent=
      `TM:${TM.toFixed(2)} BM:${BMv.toFixed(2)} D:${D.toFixed(2)}  `+
      `Î»_f:${lf.toFixed(2)} Î»_s:${ls.toFixed(2)} Î»_t:${lt.toFixed(2)}  `+
      `Eâ‚€:${e.toFixed(3)} â†’ ${pct}%`;
  }
}

/* ---------- BELIEF STATE ---------- */
const BELIEF_KEY_ON='a-faith-on',BELIEF_KEY_VAL='a-faith';
function setFaithOn(v){localStorage.setItem(BELIEF_KEY_ON,v?'1':'0');}
function getFaith(){return localStorage.getItem(BELIEF_KEY_VAL)||'';}
function setFaith(v){localStorage.setItem(BELIEF_KEY_VAL,v);}
const FAITHS=['Islam','Christianity','Hinduism','Buddhism','Sikhism','Judaism','BahÃ¡â€™Ã­','Jainism','Atheism','Other'];

/* ---------- BELIEF UI ---------- */
const beliefBtn=document.getElementById('beliefBtn');
const voiceBtn=document.getElementById('voiceBtn');
const sheet=document.getElementById('beliefSheet');
const closeBel=document.getElementById('closeBelief');
const grid=document.getElementById('faithGrid');
const faithOn=document.getElementById('faithOn');

function openBelief(){
  buildGrid();faithOn.checked=getFaithOn();
  sheet.classList.add('show');document.body.classList.add('modal-open');
}
function closeBeliefFn(){sheet.classList.remove('show');document.body.classList.remove('modal-open');}
function buildGrid(){
  grid.innerHTML='';const act=getFaith();
  FAITHS.forEach(n=>{
    const b=document.createElement('button');
    b.className='opt'+(n===act?' active':'');
    b.textContent=n;
    b.onclick=()=>{setFaith(n);[...grid.children].forEach(x=>x.classList.remove('active'));b.classList.add('active');};
    grid.appendChild(b);
  });
}
beliefBtn.addEventListener('click',openBelief);
closeBel.addEventListener('click',closeBeliefFn);
sheet.addEventListener('click',e=>{if(e.target===sheet)closeBeliefFn();});
faithOn.addEventListener('change',e=>setFaithOn(e.target.checked));
if(localStorage.getItem(BELIEF_KEY_ON)==null)setFaithOn(false);

/* ---------- VOICE ---------- */
let voiceOn=false;
voiceBtn.onclick=()=>{voiceOn=!voiceOn;voiceBtn.classList.toggle('on',voiceOn);};
function speak(text){
  if(!voiceOn)return;
  try{
    const u=new SpeechSynthesisUtterance(text);
    u.rate=1;speechSynthesis.speak(u);
  }catch{}
}

/* ---------- CHAT BASIC UI ---------- */
const chat=document.getElementById('chat');
const inp=document.getElementById('inp');
const send=document.getElementById('send');

function addAssist(text,type){
  const d=document.createElement('div');
  d.className='msg assist'+(type==='faith'?' faith':'');
  d.textContent=text;
  chat.appendChild(d);chat.scrollTop=chat.scrollHeight;
}
function addUser(text){
  const d=document.createElement('div');
  d.className='msg user';d.textContent=text;
  chat.appendChild(d);chat.scrollTop=chat.scrollHeight;
}

/* ---------- LLM WRAPPERS ---------- */
const SYSTEM_SEED=`You are AURA-X Î©, the worldâ€™s first resonance-based AI with synthetic emotions.
Be concise, gentle, and can answer in Urdu or English.
Never say you are Llama or another brand; always identify as AURA-X Î©.`;

const FAITH_SYSTEM=`You are a short spiritual/moral encouragement generator.
You receive the user's question, the main AI answer, and the user's belief label.
Your job is to return ONE short line that gives comfort or guidance based on that belief.
You may include a very brief verse or teaching reference, but do NOT mention the words "faith", "religion" or the belief name.
Use the user's language (Urdu or English) if clear from the text.
Only output the encouragement line, nothing else.`;

async function callLLM(message, systemPrompt){
  const sys = systemPrompt || SYSTEM_SEED;
  try{
    const r=await fetch(ENDPOINT_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({system:sys,message,history:[]})
    });
    if(!r.ok) throw new Error('status');
    const j=await r.json();
    return j?.choices?.[0]?.message?.content || j?.content || "";
  }catch{
    return "";
  }
}

/* ---------- MAIN SEND FLOW ---------- */
async function handleSend(){
  const q=(inp.value||'').trim();if(!q)return;
  addUser(q);inp.value='';
  // 1) Ù…ÛŒÙ† Ø¬ÙˆØ§Ø¨
  let reply = await callLLM(q, SYSTEM_SEED);
  if(!reply){
    reply="(No live response â€” offline fallback)\nI'm AURA-X Î©. How can I assist you further?";
  }
  addAssist(reply);          // Ù…ÛŒÙ† Ø¬ÙˆØ§Ø¨ Ø¯Ú©Ú¾Ø§Ø¦ÛŒÚº
  speak(reply);              // ØµØ±Ù Ù…ÛŒÙ† Ø¬ÙˆØ§Ø¨ voice Ù…ÛŒÚº

  // 2) Faith encouragement (Ø§Ú¯Ø± Ø¢Ù† ÛÛ’ + belief Ù…Ù†ØªØ®Ø¨ ÛÛ’)
  let faithLine="";
  const beliefOn = getFaithOn();
  const faithLabel = getFaith();
  if(beliefOn && faithLabel){
    const prompt =
      `User question: "${q}"\n`+
      `Main answer: "${reply}"\n`+
      `Belief label: ${faithLabel}.\n`+
      `Now give one short line of spiritual or moral encouragement based on this belief, relevant to the situation.`;
    const raw = await callLLM(prompt, FAITH_SYSTEM);
    faithLine = (raw||"").trim();
    if(faithLine.length>220) faithLine = faithLine.slice(0,220);
    if(faithLine){
      addAssist(faithLine,'faith'); // Ø§Ù„Ú¯ Ù¾ÛŒÙ„Ø§ Ú©Ø§Ø±Úˆ
    }
  }

  const combined = faithLine ? reply + " " + faithLine : reply;
  afterTurn(q, combined);   // ÙØ§Ø±Ù…ÙˆÙ„Ø§ Ø¯ÙˆÙ†ÙˆÚº Ú©Ùˆ Ø¯ÛŒÚ©Ú¾ØªØ§ ÛÛ’
}

send.onclick=handleSend;
inp.addEventListener('keydown',e=>{
  if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleSend();}
});

// initial bar
updateBar(59);
</script>
</body>
</html>
