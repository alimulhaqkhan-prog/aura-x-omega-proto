<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>AURA-X Î© â€” resonance-based AI with synthetic emotions</title>
<link rel="preconnect" href="https://api.open-meteo.com">
<style>
:root{
  --bg:#e9f5ff;                 /* light blue */
  --card:#ffffffcc;
  --ink:#0b1a24;
  --sub:#4b6475;
  --accent:#26e3b6;
  --chip:#e8f1f7;
  --barTrack:#dfe7ee;           /* light gray track */
  --barFill:#b3c7db;            /* soft blue fill */
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:var(--bg);
  color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;
}
.container{max-width:820px;margin:auto;padding:18px 14px 24px}

/* header */
.logo{display:flex;align-items:center;justify-content:center;gap:10px}
.logo img{height:34px;filter:drop-shadow(0 1px 2px #0002)}
.h1{
  margin:14px auto 12px; padding:14px 16px;border-radius:16px;
  max-width:760px;background:var(--card);backdrop-filter:blur(8px);
  text-align:center; font-weight:800; letter-spacing:.2px; line-height:1.25;
}

/* emotion bar */
.mood{position:relative;margin:10px auto 6px; height:16px; width:min(760px,94vw);
  background:var(--barTrack); border-radius:999px; overflow:hidden; box-shadow:inset 0 0 0 1px #00000010}
.mood .fill{position:absolute;left:0;top:0;height:100%;width:50%;background:var(--barFill);
  transition:width .35s ease}

/* heart */
.heart{
  font-size:44px;display:block;margin:10px auto 6px; width:max-content;
  filter:drop-shadow(0 8px 12px rgba(255,105,180,.35));
  animation:pump 1.4s ease-in-out infinite;
}
@keyframes pump{0%,100%{transform:translateY(0) scale(.96)}50%{transform:translateY(-2px) scale(1.08)}}

/* info row */
.info{display:flex;gap:10px;justify-content:center;align-items:center;color:var(--sub);font-weight:600}

/* chat */
.card{
  background:var(--card); border:1px solid #ffffff66; border-radius:18px; padding:14px;
  box-shadow:0 10px 24px rgba(15,23,42,.08);
}
.chat{display:flex;flex-direction:column;gap:10px;max-height:52vh;overflow:auto}
.msg{padding:12px 14px;border-radius:14px;background:#fff;border:1px solid #e7eef3;max-width:85%}
.msg.user{align-self:flex-end;background:#eff8ff;border-color:#cfe6fb}

/* composer */
.composer{display:flex;gap:10px;align-items:center;margin-top:12px}
.inp{
  flex:1;min-height:44px;padding:12px;border-radius:14px;border:1px solid #cfe0ea;background:#fff;
  outline:none;font-size:16px;
}
.btn{
  padding:11px 18px;border:0;border-radius:14px;background:linear-gradient(135deg,#7aa9ff,#ff88c8);
  color:#fff;font-weight:700;box-shadow:0 6px 16px rgba(123, 118, 255,.35);cursor:pointer
}

/* chips */
.bel-voice{display:flex;gap:10px;justify-content:center;margin-top:12px}
.chip{
  background:var(--chip);color:#043a62;border:1px solid #d1e1ec;border-radius:999px;
  padding:8px 14px;font-weight:700;cursor:pointer
}

/* ===== BELIEF SHEET: stable, no jump ===== */
.sheet{
  position:fixed; inset:0; display:flex; align-items:flex-end; justify-content:center;
  background:rgba(3,8,12,.25); backdrop-filter:blur(4px);
  opacity:0; pointer-events:none; transition:opacity .22s ease; z-index:9999;
  will-change:opacity; overscroll-behavior:contain;
}
.sheet.open{ opacity:1; pointer-events:auto }
.sheet-panel{
  width:min(680px,94vw); margin:12px; border-radius:18px;
  background:linear-gradient(180deg,rgba(255,255,255,.28),rgba(255,255,255,.18));
  border:1px solid rgba(255,255,255,.35);
  backdrop-filter:blur(18px) saturate(140%);
  box-shadow:0 10px 40px rgba(0,0,0,.35), 0 0 40px rgba(46,230,184,.2);
  transform:translate3d(0,24px,0) scale(.98); transition:transform .26s ease;
  max-height:calc(100dvh - 24px); overflow:auto; will-change:transform;
}
.sheet.open .sheet-panel{ transform:translate3d(0,0,0) scale(1) }
body.modal-open{ overflow:hidden; touch-action:none; overscroll-behavior:contain }
.sheet input,.sheet button,.sheet label{ font-size:16px }
.row{display:flex;justify-content:space-between;align-items:center;padding:12px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:0 12px 14px}
.grid .chip{justify-content:center}

/* debug */
#dbg{position:fixed;right:10px;bottom:88px;background:#fff;border-radius:12px;padding:8px 10px;
  box-shadow:0 10px 24px rgba(15,23,42,.2);font:12px/1.35 Inter,system-ui;white-space:pre-wrap}
@media (max-width:520px){ .chat{max-height:54vh} }
</style>
</head>
<body>
<div class="container">

  <div class="logo"><img src="https://raw.githubusercontent.com/alimulhaqkhan-prog/aura-x-omega-proto/main/assets/img/aurax.png" alt="AURA-X"></div>
  <div class="h1">AURA-X Î© â€” the worldâ€™s first resonance-based AI with synthetic emotions.</div>

  <div class="mood" id="moodBox"><div class="fill" id="emotionFill" style="width:90%"></div></div>
  <div class="heart">ðŸ’•</div>

  <div class="info">
    <span id="clock">â€”:â€”</span> |
    <span id="weather">Weather â€¦</span>
  </div>

  <div class="card" style="margin-top:12px">
    <div class="chat" id="chat">
      <div class="msg">
        Assalamualaikum! Iâ€™m AURA-X Î© â€” the worldâ€™s first resonance-based AI with synthetic emotions. How can I help you today?
      </div>
    </div>

    <div class="composer">
      <textarea id="inp" class="inp" placeholder="Type your questionâ€¦" rows="2"></textarea>
      <button id="send" class="btn">Send</button>
    </div>
  </div>

  <div class="bel-voice">
    <button id="beliefBtn" class="chip">ðŸ”˜ Belief</button>
    <button id="voiceBtn" class="chip" style="background:var(--accent);color:#053b2f">Voice</button>
  </div>
</div>

<!-- Belief sheet -->
<div class="sheet" id="beliefSheet" aria-hidden="true">
  <div class="sheet-panel">
    <div class="row">
      <strong>Belief settings</strong>
      <button id="closeBelief" class="chip">Close</button>
    </div>
    <div class="row" style="gap:10px">
      <label class="chip" style="display:flex;align-items:center;gap:8px">
        <input type="checkbox" id="faithOn"> <b>Faith ON</b> â€” add short encouragements (optional)
      </label>
    </div>
    <div class="row" style="padding-top:0;color:#123">Pick your faith (used locally only):</div>
    <div class="grid" id="faithGrid">
      <button class="chip">Islam</button><button class="chip">Christianity</button>
      <button class="chip">Hinduism</button><button class="chip">Buddhism</button>
      <button class="chip">Sikhism</button><button class="chip">Judaism</button>
      <button class="chip">BahÃ¡â€™Ã­</button><button class="chip">Jainism</button>
      <button class="chip">Atheism</button><button class="chip">Other</button>
    </div>
  </div>
</div>

<div id="dbg"></div>

<script>
/* ====== CONFIG ====== */
const API_URL = 'https://alimai.online/api/chat.php';  // your PHP/OpenRouter proxy
const DEFAULT_MODEL = 'meta-llama/llama-3-8b-instruct'; // used only for prompt text
/* ==================== */

/* CLOCK */
function tickClock(){
  const now = new Date();
  const s = now.toLocaleString([], {weekday:'short', day:'2-digit', month:'short',
                                    hour:'2-digit', minute:'2-digit', second:'2-digit'});
  document.getElementById('clock').textContent = s;
}
tickClock(); setInterval(tickClock, 1000);

/* WEATHER (Open-Meteo, no key) */
(async function weather(){
  try{
    const pos = await new Promise((res,rej)=>{
      navigator.geolocation ? navigator.geolocation.getCurrentPosition(p=>res(p.coords),()=>res(null),{timeout:6000})
                            : res(null);
    });
    const lat = pos?.latitude ?? 33.7, lon = pos?.longitude ?? 72.98; // PK fallback
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code`;
    const r = await fetch(url); const j = await r.json();
    const t = j?.current?.temperature_2m;
    document.getElementById('weather').textContent =
      (t!=null) ? `${t.toFixed(1)}Â°C` : 'Weather unavailable';
  }catch{ document.getElementById('weather').textContent='Weather unavailable'; }
})();

/* ===== Belief Sheet (stable) ===== */
const sheet = document.getElementById('beliefSheet');
const openBelief = ()=>{ sheet.classList.add('open'); document.body.classList.add('modal-open'); }
const closeBelief = ()=>{ sheet.classList.remove('open'); document.body.classList.remove('modal-open'); }
document.getElementById('beliefBtn').onclick = openBelief;
document.getElementById('closeBelief').onclick = closeBelief;
sheet.addEventListener('click', e=>{ if(e.target===sheet) closeBelief(); });

/* Persist Faith settings */
const faithOnEl = document.getElementById('faithOn');
faithOnEl.checked = localStorage.getItem('aura-faith-on')==='1';
faithOnEl.onchange = ()=> localStorage.setItem('aura-faith-on', faithOnEl.checked?'1':'0');
document.querySelectorAll('#faithGrid .chip').forEach(b=>{
  if(localStorage.getItem('aura-faith')===b.textContent) b.style.background='#c9f8ea';
  b.onclick = ()=>{ localStorage.setItem('aura-faith', b.textContent);
    document.querySelectorAll('#faithGrid .chip').forEach(x=>x.style.background='var(--chip)');
    b.style.background='#c9f8ea';
  };
});

/* Voice */
let voiceOn = localStorage.getItem('aura-voice')==='1';
const voiceBtn = document.getElementById('voiceBtn');
function setVoice(v){ voiceOn=v; localStorage.setItem('aura-voice', v?'1':'0');
  voiceBtn.style.background = v ? 'var(--accent)' : 'var(--chip)';
  voiceBtn.style.color      = v ? '#053b2f'       : '#043a62';
}
setVoice(voiceOn);
voiceBtn.onclick = ()=>setVoice(!voiceOn);
function speak(text){
  try{
    if(!voiceOn) return;
    const u = new SpeechSynthesisUtterance(text);
    u.lang = (localStorage.getItem('aura-faith')==='Islam') ? 'ur-PK' : 'en-US';
    speechSynthesis.cancel(); speechSynthesis.speak(u);
  }catch{}
}

/* ====== CHAT ====== */
const chat = document.getElementById('chat');
const inp  = document.getElementById('inp');
const send = document.getElementById('send');

function addMsg(text, isUser=false){
  const d=document.createElement('div'); d.className='msg'+(isUser?' user':''); d.textContent=text;
  chat.appendChild(d); chat.scrollTop = chat.scrollHeight; return d;
}

/* ---- Eâ‚€ ENGINE (TM,BM,D,Î») ---- */
const AFFECT = {
  joy:[/happy|great|alhamdulillah|shukriya|thanks|ðŸ˜Š|ðŸ˜|ðŸ‘/i, +0.9],
  calm:[/ok|fine|theek|neutral|sabar|ðŸ™‚/i, +0.4],
  sad:[/sad|dukhi|ðŸ˜¢|ðŸ˜­/i, -0.7],
  anger:[/angry|gussa|ðŸ˜ |ðŸ˜¡/i, -0.9],
  fear:[/fear|dar|anxious|ðŸ˜¨|ðŸ˜°/i, -0.6],
  love:[/love|mohabbat|ðŸ’•|â¤ï¸/i, +0.8],
  stress:[/stress|pressure|tension|ðŸ˜£/i, -0.5]
};
const BM_MODEL = {layers:[
  {name:'L1',horizonDays:2,w:1.00},
  {name:'L2',horizonDays:7,w:0.85},
  {name:'L3',horizonWeeks:5,w:0.70},
  {name:'L4',horizonMonths:12,w:0.55},
  {name:'L5',horizonYears:3,w:0.40},
  {name:'L6',horizonYears:10,w:0.30},
  {name:'L7',horizonYears:60,w:0.20},
]};
function pushBM(intensity){
  const now=Date.now();
  BM_MODEL.layers.forEach((_,i)=>{
    const k=`aura-bm-${i}`; const arr=JSON.parse(localStorage.getItem(k)||'[]');
    if(arr.length>60) arr.shift(); arr.push({t:now,v:intensity});
    localStorage.setItem(k,JSON.stringify(arr));
  });
}
function readBM(){
  const now=Date.now(); let s=0, w=0;
  BM_MODEL.layers.forEach(L=>{
    let ms=L.horizonDays?L.horizonDays*864e5:
          L.horizonWeeks?L.horizonWeeks*7*864e5:
          L.horizonMonths?L.horizonMonths*30*864e5:
          L.horizonYears?L.horizonYears*365*864e5:0;
    const arr=JSON.parse(localStorage.getItem(`aura-bm-${BM_MODEL.layers.indexOf(L)}`)||'[]')
      .filter(x=>now-x.t<=ms);
    if(arr.length){ const avg=arr.reduce((a,b)=>a+b.v,0)/arr.length; s+=avg*L.w; w+=L.w; }
  });
  return w? s/w : 0;
}
function tmFromText(t){ let s=0; for(const k in AFFECT){ const [re,val]=AFFECT[k]; if(re.test(t)) s+=val; } return Math.max(-1,Math.min(1,s)); }
function computeD(){
  const last=Number(localStorage.getItem('aura-last-ts')||'0'); if(!last) return 0.1;
  const hours=(Date.now()-last)/36e5; return Math.max(0.05, Math.min(0.6, hours/48));
}
function lambda_faith(){ return localStorage.getItem('aura-faith-on')==='1'?0.15:0 }
function lambda_sys(t){ const caps=/[A-Z]{6,}/.test(t), long=t.length>400; return (caps||long)?-0.05:0.08 }
function lambda_trc(t){ const hasNum=/\d/.test(t), url=/https?:\/\/|www\./i.test(t); return (hasNum||url)?0.07:0 }
function E0(TM,BM,D,lf,ls,lt){ return Math.tanh((TM*BM)-D+lf+ls+lt) }
const bar = document.getElementById('emotionFill');
const dbg = document.getElementById('dbg');

async function afterLLM(userText, assistantText){
  const TM = tmFromText(userText);
  const BM = readBM();
  const D  = computeD();
  const lf = lambda_faith(), ls = lambda_sys(userText), lt = lambda_trc(userText);
  const e0 = E0(TM,BM,D,lf,ls,lt);
  const pct = Math.max(5,Math.min(98,Math.round((e0+1)*50)));   // [-1..1] â†’ [0..100]
  bar.style.width = pct+'%'; bar.title = pct+'%';
  const aff = Math.max(-1,Math.min(1, tmFromText(assistantText||userText)));
  pushBM(aff); localStorage.setItem('aura-last-ts', Date.now().toString());
  dbg.textContent = `TM:${TM.toFixed(2)}  BM:${BM.toFixed(2)}  D:${D.toFixed(2)}
Î»_f:${lf.toFixed(2)}  Î»_s:${ls.toFixed(2)}  Î»_t:${lt.toFixed(2)}
Eâ‚€:${e0.toFixed(3)}  â†’ ${pct}%`;
}

/* SEND */
async function callAPI(message, history=[]){
  try{
    const r = await fetch(API_URL, {
      method:'POST', mode:'cors',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ message, history, model: DEFAULT_MODEL })
    });
    const j = await r.json();
    // support both your PHP {choices:[{message:{content}}]} or plain string
    return j?.choices?.[0]?.message?.content || j?.content || j?.reply || JSON.stringify(j);
  }catch(e){
    return null;
  }
}

send.onclick = async ()=>{
  const q = (inp.value||'').trim(); if(!q) return;
  addMsg(q,true); inp.value='';
  let reply = await callAPI(q, []);     // history optional
  if(!reply){
    reply = "(No live response â€” offline fallback)\nI'm AURA-X Î©. How can I assist you further?";
  }
  addMsg(reply,false);
  speak(reply);
  afterLLM(q, reply);
};
inp.addEventListener('keydown',e=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send.click(); }});
</script>
</body>
</html>
