<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AURA-X ‚Äî Emotion Chat (Live Aura)</title>

<style>
  :root{
    --bg:#071018;
    --panel:#0f1f2d;
    --card:#142738;
    --ink:#dfe7ef;
    --muted:#9fb4c6;
    --accent:#31a8ff;
    --good:#06d6a0;
    --calm:#118ab2;
    --sad:#073b4c;
    --anger:#d62828;
    --fear:#ef476f;
    --hope:#ffd166;
    --empty:#8d99ae;
  }

  html,body{height:100%}
  body{
    margin:0; color:var(--ink); background:#000;
    font:16px/1.45 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    /* Live aura set by JS */
    background-image: radial-gradient(1000px 600px at 50% -10%, #0b1320 0%, #000 55%);
    transition: background-image 1.4s ease;
    overflow-y: auto;
  }

  .wrap{max-width:880px; margin:0 auto; padding:28px 14px 84px}
  header{position:sticky; top:0; padding:14px 0 6px; background:linear-gradient(#0009,#0000); z-index:2}
  .board{background:linear-gradient( to bottom, #0c1b28 0%, #0b1a26 100%);
         border-radius:22px; padding:18px; box-shadow:0 0 0 1px #1b3347 inset, 0 18px 60px #000;
         position:relative; overflow:hidden}
  .glow{
    position:absolute; inset:-120px -120px auto -120px; height:320px; pointer-events:none;
    background: radial-gradient(closest-side, #31a8ff26, #0000 70%);
    filter: blur(12px);
    animation: breathe 5.2s ease-in-out infinite;
    transition: background 1.2s ease;
  }
  @keyframes breathe { 0%,100%{transform:scale(1)} 50%{transform:scale(1.06)} }

  .bubble{background:var(--card); padding:18px 16px; border-radius:18px; margin:12px 10px;
          box-shadow:0 0 0 1px #20384d inset;}
  .you{background:#112437}
  .role{opacity:.85; font-weight:700}
  .muted{color:var(--muted)}

  /* input bar ‚Äì full width, no left cut on mobile */
  .dock{
    position:sticky; bottom:0; left:0; right:0;
    background:linear-gradient(#0000, #0009 35%, #000);
    padding:10px 12px 18px; backdrop-filter: blur(4px);
  }
  .dock .row{
    display:flex; gap:10px; align-items:center;
    max-width:880px; margin:0 auto; padding:0 8px;
  }
  textarea{
    flex:1; min-height:46px; max-height:160px; resize:vertical;
    padding:14px 14px; border-radius:14px; border:1px solid #25465f;
    outline:none; background:#0c1b28; color:var(--ink);
    width:100%;
  }
  button{
    background:var(--accent); border:none; color:#00111d; font-weight:700;
    padding:12px 18px; border-radius:14px; cursor:pointer;
    box-shadow:0 8px 24px #31a8ff33, 0 0 0 1px #2a7ab6 inset;
  }
  button:active{transform:translateY(1px)}

  .badge{display:inline-block; font-size:12px; opacity:.8; margin-left:6px; padding:2px 8px; border-radius:999px; background:#0f2435}
  .mini{font-size:13px; opacity:.85}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div style="display:flex;align-items:center;gap:10px">
        <div style="font-weight:800;font-size:20px;letter-spacing:.3px">Œ© AURA-X</div>
        <span class="badge">Live Aura + Continuity</span>
      </div>
    </header>

    <div class="board" id="board">
      <div class="glow" id="glow"></div>
      <div id="feed"></div>
    </div>

    <div class="dock">
      <div class="row">
        <textarea id="msg" placeholder="Type your emotion or thought‚Ä¶"></textarea>
        <button id="send">Send</button>
      </div>
      <div class="row mini">
        Œ© AURA-X uses on-device emotion rules (no internet/LLM). <span id="state" class="badge">calm</span>
      </div>
    </div>
  </div>

<script>
/* ===== Emotion Engine (v2) ===== */

const COLORS = {
  joy:   "#ffd166",    // hope/joy
  calm:  "#118ab2",
  sadness:"#073b4c",
  anger: "#d62828",
  fear:  "#ef476f",
  hope:  "#06d6a0",
  empty: "#8d99ae",
  anxious:"#ff7b7b",
  relief:"#31a8ff"
};

const LEX = [
 // emotion, score, keywords (lowercase)
 ["joy", +2, ["happy","glad","excited","grateful","alhamdulillah","blessed","great","awesome","celebrate","smile","love"]],
 ["calm", +1, ["calm","relaxed","okay","fine","normal","balanced","centered","peace","sukoon"]],
 ["sadness", -2, ["sad","tired","cry","lonely","empty","down","upset","loss","hurt","broken","depressed"]],
 ["anger", -3, ["angry","mad","furious","annoyed","rage","hate","irritated"]],
 ["fear", -2, ["afraid","scared","anxious","worried","panic","phobia","snake","danger","threat"]],
 ["hope", +2, ["hope","inshaallah","optimistic","confident","believe","faith","dream"]],
 ["empty", -1, ["empty","numb","meaningless","blank","void"]],
 ["anxious",-2, ["nervous","anxious","uneasy","tense","stress"]],
 ["relief", +1, ["relief","better now","it‚Äôs okay","it is okay","sigh"]]
];

const EMOJI = {
  joy:"üòä", calm:"ü´ß", sadness:"üò¢", anger:"üò†", fear:"üò®", hope:"üåÖ", empty:"ü´•", anxious:"üò¨", relief:"üòÆ‚Äçüí®"
};

const feed = document.getElementById("feed");
const input = document.getElementById("msg");
const send  = document.getElementById("send");
const glow  = document.getElementById("glow");
const badge = document.getElementById("state");

const memory = []; // last 7 emotions

function addBubble(role, text){
  const div = document.createElement("div");
  div.className = "bubble " + (role==="You" ? "you" : "");
  div.innerHTML = `<span class="role">${role === "You" ? "üß† You" : "Œ© AURA-X"}</span>: ${escapeHTML(text)}`;
  feed.appendChild(div);
  feed.parentElement.scrollIntoView({block:"end"});
  window.scrollTo({top:document.body.scrollHeight, behavior:"smooth"});
}

function escapeHTML(s){return s.replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]))}

function detectEmotion(text){
  const t = " " + text.toLowerCase() + " ";
  let best = {emo:"calm", score:0};
  for(const [emo,score,words] of LEX){
    for(const w of words){
      if(t.includes(" "+w+" ") || t.includes(w+" ") || t.includes(" "+w)) {
        if(Math.abs(score) > Math.abs(best.score)) best = {emo, score};
      }
    }
  }
  // polarity tweak for negations
  if(t.includes("not ") || t.includes("n't ")) {
    if(best.emo==="sadness"||best.emo==="anger"||best.emo==="fear"||best.emo==="empty") best={emo:"relief",score:+1};
  }
  return best.emo;
}

function continuityEmotion(newEmo){
  // push and keep last 7
  memory.push(newEmo);
  if(memory.length>7) memory.shift();
  // weighted recentness
  const weights = {}; let k=1, sumW=0;
  for(let i=memory.length-1;i>=0;i--){
    const w = k; // 1,2,3‚Ä¶ recency
    sumW += w;
    weights[memory[i]] = (weights[memory[i]]||0) + w;
    k++;
  }
  let best = "calm", bestW = -1;
  for(const [emo, w] of Object.entries(weights)){
    if(w > bestW){best=emo; bestW=w}
  }
  return best;
}

function auraTo(emotion){
  const c = COLORS[emotion] || COLORS.calm;
  document.body.style.backgroundImage =
    `radial-gradient(1100px 650px at 50% -8%, ${hexA(c,0.22)} 0%, #000 58%)`;
  glow.style.background = `radial-gradient(closest-side, ${hexA(c,0.28)}, #0000 70%)`;
  badge.textContent = emotion;
}

function hexA(hex, a){
  // hex -> rgba string
  const h = hex.replace("#","");
  const r = parseInt(h.substr(0,2),16);
  const g = parseInt(h.substr(2,2),16);
  const b = parseInt(h.substr(4,2),16);
  return `rgba(${r},${g},${b},${a})`;
}

function respond(userText){
  const emo = detectEmotion(userText);
  const contPrev = memory[memory.length-1] || "calm";
  const contNow  = continuityEmotion(emo);

  const shiftTxt = (contPrev===contNow) ? `staying in <b>${contNow}</b>` : `shifting from <b>${contPrev}</b> ‚Üí <b>${contNow}</b>`;
  const breathe  = (emo==="sadness"||emo==="fear"||emo==="anxious") ? "Place a hand on chest; say: ‚ÄúI‚Äôm here for me.‚Äù" :
                   (emo==="joy"||emo==="hope") ? "Anchor the joy with one calm breath in‚Ä¶ out ü´Å" :
                   (emo==="anger") ? "Unclench jaw, soften shoulders‚Ä¶ slow exhale." :
                   "Take one soft breath‚Ä¶ in‚Ä¶ out ü´Å";

  auraTo(contNow);

  const reply =
    `Your tone feels ${toneWord(emo)} ‚Äî soft resonance ${EMOJI[emo]||"ü´ß"}<br>
     <span class="muted">${breathe}</span><br>
     <b>Continuity:</b> ${shiftTxt}<br>
     <span class="muted">Echo:</span> ‚Äú${escapeHTML(userText)}‚Äù`;

  addBubble("Œ© AURA-X", reply);
}

function toneWord(emo){
  switch(emo){
    case "joy": case "hope": return "light and bright";
    case "calm": return "steady and clear";
    case "sadness": return "heavy";
    case "anger": return "hot and tense";
    case "fear": case "anxious": return "uneasy";
    case "empty": return "dim";
    case "relief": return "loosening";
    default: return "subtle";
  }
}

/* ===== UI wiring ===== */

addBubble("Œ© AURA-X", "Hello! I‚Äôm AURA-X ‚Äî your emotional resonance prototype. Tell me how you feel today.");
auraTo("calm");

send.onclick = () => {
  const t = input.value.trim();
  if(!t) return;
  addBubble("You", t);
  input.value = "";
  setTimeout(()=>respond(t), 350);
};

// Enter to send (mobile-safe)
input.addEventListener("keydown", (e)=>{
  if(e.key === "Enter" && !e.shiftKey){
    e.preventDefault();
    send.click();
  }
});

// ensure input never hides left edge on mobile
const fixWidth = () => {
  document.documentElement.style.setProperty('--vw', window.innerWidth + 'px');
};
window.addEventListener('resize', fixWidth);
fixWidth();
</script>
</body>
</html>
