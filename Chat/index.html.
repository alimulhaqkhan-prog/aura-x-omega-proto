<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AURA-X Î© â€” Emotion Chat (Prototype)</title>
<style>
/* ---------- THEME ---------- */
:root{
  --bg:#0b1220; --ink:#e6f1ff;
  --panel:#0f1a2d; --panel2:#0e1830;
  --accent:#6ad1ff; --muted:#9fb3d8;
  --gold:#f7c94d; --violet:#80c7ff;
  --ok:#2fd97a; --warn:#f7b84f; --bad:#ff6b6b;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--ink); background:radial-gradient(1100px 660px at 30% 10%, #0e1830 0%, #0b1220 55%);
  font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  overflow-x:hidden;
}
a{color:var(--accent); text-decoration:none}

/* page safe-area so left side never clips on phones */
.page{
  min-height:100%;
  padding: 24px max(16px, env(safe-area-inset-right)) 120px max(16px, env(safe-area-inset-left));
}

/* card / chat bubble */
.card{
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.03));
  border:1px solid #1e324f; border-radius:16px; padding:18px 20px; margin:14px 0;
  box-shadow:0 0 0 4px rgba(33,139,255,0.08), inset 0 0 0 1px rgba(255,255,255,0.02);
}
.badge{display:inline-flex; align-items:center; gap:8px; font-weight:600; opacity:.95}
.badge .dot{width:10px; height:10px; border-radius:50%; background:var(--accent); box-shadow:0 0 10px var(--accent)}
.bot{background:rgba(100,170,255,0.08)}
.user{background:rgba(120,160,255,0.05)}

/* header logo line */
.hero{display:flex; align-items:center; justify-content:center; margin:20px 0 6px}
.logo{width:44px; height:44px; margin-right:10px; border-radius:12px;
      background:url('../assets/img/aura-x-omega.png') center/cover no-repeat, #0d1527;}
h1{margin:0; font-size:28px; letter-spacing:.3px}
.lead{color:var(--muted); margin:6px 0 16px; text-align:center}

/* board + gauges */
.board{max-width:880px; margin:0 auto;}

/* meter bars */
.meter{height:8px; border-radius:999px; background:#0c294b; overflow:hidden}
.meter>div{height:100%; background:linear-gradient(90deg, #2d8fff, #6ad1ff); width:0%}
.row{display:flex; gap:14px; align-items:center; margin-top:10px}
.row label{min-width:92px; color:#9db0cf; font-size:14px}

/* ---------- composer (typing area) ---------- */
.composer-wrap{
  position:fixed; left:0; right:0; bottom:0; z-index:40;
  padding: 10px max(16px, env(safe-area-inset-right)) calc(10px + env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
  background: linear-gradient(180deg, transparent, rgba(5,10,20,0.85));
  backdrop-filter: blur(6px);
}
.composer{
  max-width:880px; margin:0 auto; display:flex; gap:10px; align-items:flex-end;
}
.composer textarea{
  flex:1; min-height:46px; max-height:160px; resize:none;
  padding:14px 14px;
  border-radius:14px; border:1px solid #1f3453; color:var(--ink);
  background:#0f1a2d; outline:none;
}
.composer button{
  flex:0 0 auto; height:46px; padding:0 22px;
  border-radius:12px; border:none; color:#001628; font-weight:700;
  background:linear-gradient(180deg, #3cc0ff, #2ca5ee); box-shadow:0 6px 18px rgba(44,165,238,.35);
}
.composer button:active{transform:translateY(1px)}
/* ensure left edge never hides */
.composer, .composer textarea{margin-left:0;}

/* small screens tweaks */
@media (max-width:420px){
  h1{font-size:24px}
  .card{padding:16px}
}
</style>
</head>
<body>
  <div class="page">
    <div class="hero">
      <div class="logo" aria-hidden="true"></div>
      <h1>AURA-X Î©</h1>
    </div>
    <p class="lead">Tell me how you feel â€” I map tone â†’ emotion, adjust intensity & continuity locally (offline).</p>

    <div class="board" id="board">
      <div class="card bot" id="greet">ðŸ‘‹ Hello! Iâ€™m AURA-X â€” your emotional resonance prototype. Tell me how you feel today.</div>

      <div class="card">
        <div class="row"><label>Emotion</label><span id="emoName">Calm</span></div>
        <div class="row"><label>Intensity</label><div class="meter"><div id="intensityBar"></div></div></div>
        <div class="row"><label>Continuity</label><div class="meter"><div id="contBar"></div></div></div>
      </div>
    </div>
  </div>

  <!-- fixed composer -->
  <div class="composer-wrap">
    <form class="composer" id="composer">
      <textarea id="input" placeholder="Type your emotion or thought..." rows="1"></textarea>
      <button type="submit">Send</button>
    </form>
  </div>

<script>
/* ---------------- STATE ---------------- */
const STATE = { last:Date.now(), continuity:0.65, auto:true, history:[], emotion:{name:'Calm', val:0.25} };
const board = document.getElementById('board');
const input = document.getElementById('input');
const iBar  = document.getElementById('intensityBar');
const cBar  = document.getElementById('contBar');
const eName = document.getElementById('emoName');

/* auto-resize textarea */
function fitTA(el){
  el.style.height='auto';
  el.style.height = Math.min(el.scrollHeight, 160) + 'px';
}
['input','change'].forEach(ev => input.addEventListener(ev, ()=>fitTA(input)));
fitTA(input);

/* ---------------- EMOTION ENGINE (lightweight) ---------------- */
const EMO = [
  {name:'Joy',    color:'#2fd97a', kw:/\b(happy|joy|great|awesome|alhumdulillah|shukar)\b/i, base:0.75},
  {name:'Calm',   color:'#6ad1ff', kw:/\b(calm|ok|fine|sabr|theek)\b/i,  base:0.35},
  {name:'Sad',    color:'#6a8ad8', kw:/\b(sad|down|depressed|rona|dukhi)\b/i, base:0.65},
  {name:'Anger',  color:'#ff6b6b', kw:/\b(angry|gussa|mad|furious)\b/i,   base:0.8},
  {name:'Fear',   color:'#f7b84f', kw:/\b(afraid|dar|worry|anxious|ghabra)\b/i, base:0.7},
  {name:'Surprise',color:'#f7c94d',kw:/\b(wow|amazed|surprised|hai?)\b/i, base:0.6},
];
function senseEmotion(text){
  let match = EMO.find(e=>e.kw.test(text)) || EMO[1]; // default Calm
  // crude intensity from punctuation/length
  let bonus = 0;
  bonus += Math.min(0.25, (text.match(/!/g)||[]).length * 0.07);
  bonus += Math.min(0.25, (text.match(/[A-Z]{2,}/g)||[]).length * 0.03);
  const val = Math.min(1, match.base + bonus);
  return { name:match.name, val, color:match.color };
}
function updateMeters(){
  iBar.style.width = (STATE.emotion.val*100).toFixed(0)+'%';
  cBar.style.width = (STATE.continuity*100).toFixed(0)+'%';
  eName.textContent = STATE.emotion.name;
}

/* ---------------- RULED SMALL-TALK (offline) ---------------- */
const INTENTS = [
  { test:t=>/\b(hi|hello|hey|salam|ass?alam)\b/i.test(t),
    reply:()=> 'ðŸ‘‹ Wa-alaikum-salam! How do you feel right now?' },
  { test:t=>/\b(who are you|your name|kya ho tum)\b/i.test(t),
    reply:()=> 'Iâ€™m AURA-X Î© â€” an offline emotional resonance prototype running in your browser.' },
  { test:t=>/\b(where.*from|location|country|live)\b/i.test(t),
    reply:()=> 'I live right here on your device (GitHub Pages). No cloud needed ðŸ˜Š' },
  { test:t=>/\b(what can you do|features|help|kya kar sakte)\b/i.test(t),
    reply:()=> 'I map toneâ†’emotion, estimate intensity, keep continuity memory, and can answer from an offline Q&A pack.' },
  { test:t=>/\b(thanks|shukriya|thank you)\b/i.test(t),
    reply:()=> 'Youâ€™re welcome! Tell me moreâ€”what changed your mood?' },
];
function detectIntent(t){ return INTENTS.find(i=>i.test(t))||null; }

/* ---------------- OFFLINE Q&A 16K HOOK ---------------- */
/* It first tries to load big pack `Chat/data/qa-16k.json`.
   If missing (404), it falls back to a tiny seed `Chat/data/qa-seed.json`. */
let QA = [];
async function loadQA(){
  async function tryFetch(url){
    const r = await fetch(url); if(!r.ok) throw new Error(r.status);
    return r.json();
  }
  try{
    QA = await tryFetch('data/qa-16k.json');
    console.log('Loaded 16k QA');
  }catch(e){
    console.warn('16k not found, using seedâ€¦');
    QA = await tryFetch('data/qa-seed.json');
  }
}
loadQA();

/* super-light scorer (token overlap + length norm) */
function bestAnswer(q){
  if(!QA || !QA.length) return null;
  const qTokens = q.toLowerCase().match(/[a-z\u0600-\u06FF]+/g)||[];
  let best = {score:0, a:null};
  for(const item of QA){
    const t = (item.q||'').toLowerCase();
    let s=0;
    for(const tok of qTokens){ if(t.includes(tok)) s+=1; }
    s = s/Math.max(2, t.split(' ').length);
    if(s>best.score) best = {score:s, a:item.a};
  }
  return best.score>0.08 ? best.a : null;
}

/* ---------------- UI helpers ---------------- */
function addBubble(role, text){
  const el = document.createElement('div');
  el.className = 'card ' + (role==='user'?'user':'bot');
  el.textContent = text;
  board.appendChild(el);
  // scroll near bottom while keeping composer visible
  window.scrollTo({top: document.body.scrollHeight, behavior:'smooth'});
}

/* ---------------- submit ---------------- */
document.getElementById('composer').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const text = input.value.trim();
  if(!text) return;
  addBubble('user', 'ðŸ§  You: '+text);

  // Sense & update meters
  STATE.emotion = senseEmotion(text);
  // continuity nudged toward recent activity
  STATE.continuity = Math.min(1, STATE.continuity*0.92 + 0.12);
  updateMeters();

  // intent â†’ reply
  const intent = detectIntent(text);
  if(intent){ addBubble('bot', intent.reply()); input.value=''; fitTA(input); return; }

  // try offline QA
  const ans = bestAnswer(text);
  if(ans){ addBubble('bot', 'Î© AURA-X: '+ans); input.value=''; fitTA(input); return; }

  // fallback reflective reply
  addBubble('bot', 'Î© AURA-X: I feel your toneâ€¦ balancing emotional resonance ðŸŒŠ');
  input.value=''; fitTA(input);
});

/* initial meters */
updateMeters();
</script>
</body>
</html>
