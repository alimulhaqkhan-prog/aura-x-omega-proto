<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Î© v1 â€“ Emotional Continuity Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html, body {
      height: 100%;
      touch-action: manipulation; /* Optimize for mobile touch */
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
      background-attachment: fixed;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: stretch;
      overflow: hidden; /* Prevent scroll on body for mobile */
    }
    .app {
      width: 100%;
      max-width: 520px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 12px;
      gap: 8px;
      background: rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
    }
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      padding: 8px 0;
    }
    .title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .title-main {
      font-size: 1.1rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      background: linear-gradient(45deg, #a5b4fc, #facc15);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .title-sub {
      font-size: 0.7rem;
      text-transform: uppercase;
      opacity: 0.75;
      color: #94a3b8;
    }
    .mode-pill {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 0.65rem;
      border: 1px solid rgba(148, 163, 184, 0.35);
      text-align: right;
      min-width: 130px;
      backdrop-filter: blur(5px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
    .mode-pill span {
      display: block;
    }
    .mode-label-1 {
      color: #a5b4fc;
      text-transform: uppercase;
      font-size: 0.6rem;
    }
    .mode-label-2 {
      color: #facc15;
      font-size: 0.65rem;
    }
    .options-btn {
      margin-left: 6px;
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    .options-btn:hover, .options-btn:active {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(165, 180, 252, 0.3);
    }
    .options-btn span {
      width: 14px;
      height: 2px;
      background: #e5e7eb;
      border-radius: 999px;
      position: relative;
    }
    .options-btn span::before,
    .options-btn span::after {
      content: "";
      position: absolute;
      left: 0;
      width: 14px;
      height: 2px;
      background: #e5e7eb;
      border-radius: 999px;
    }
    .options-btn span::before {
      top: -5px;
    }
    .options-btn span::after {
      top: 5px;
    }

    .top-panels {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow-y: auto;
      padding-right: 2px;
      -webkit-overflow-scrolling: touch; /* Smooth scroll on iOS */
    }

    .meters-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 6px;
      font-size: 0.65rem;
    }
    .meter-card {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 10px;
      padding: 6px 6px 4px;
      border: 1px solid rgba(30, 64, 175, 0.7);
      transition: transform 0.2s ease;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    .meter-card:hover {
      transform: translateY(-2px);
    }
    .meter-label {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 3px;
    }
    .meter-title {
      font-weight: 600;
      font-size: 0.7rem;
    }
    .meter-sub {
      opacity: 0.6;
      font-size: 0.55rem;
    }
    .meter-bar {
      width: 100%;
      height: 5px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 1);
      overflow: hidden;
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.5);
    }
    .meter-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #f97316, #22c55e, #3b82f6);
      transition: width 0.25s ease-out;
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
    }
    .meter-value {
      font-size: 0.6rem;
      text-align: right;
      margin-top: 2px;
      opacity: 0.8;
    }

    .ethics-banner {
      background: rgba(234, 179, 8, 0.13);
      border-radius: 12px;
      padding: 8px 10px;
      border: 1px solid rgba(250, 204, 21, 0.6);
      font-size: 0.7rem;
      line-height: 1.35;
      color: #facc15;
      text-align: center;
      box-shadow: 0 4px 15px rgba(250, 204, 21, 0.2);
      animation: glow 2s ease-in-out infinite alternate;
    }
    @keyframes glow {
      from { box-shadow: 0 4px 15px rgba(250, 204, 21, 0.2); }
      to { box-shadow: 0 4px 20px rgba(250, 204, 21, 0.4); }
    }

    .equation-panel {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 12px;
      padding: 8px 10px 10px;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      font-size: 0.7rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }
    .equation-title {
      font-weight: 600;
      letter-spacing: 0.06em;
      margin-bottom: 4px;
      font-size: 0.68rem;
      color: #a5b4fc;
    }
    .equation-line {
      font-family: "Menlo", "Consolas", monospace;
      font-size: 0.7rem;
      margin-bottom: 2px;
      color: #94a3b8;
    }

    .chat-shell {
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(51, 65, 85, 0.9);
      padding: 8px 8px 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-height: 36%;
      max-height: 55%;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
    }

    .chat-log {
      flex: 1;
      min-height: 0;
      overflow-y: auto;
      padding-right: 4px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.76rem;
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
    }
    .msg-row {
      display: flex;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .msg-user {
      justify-content: flex-end;
    }
    .msg-bot {
      justify-content: flex-start;
    }
    .msg-bubble {
      max-width: 88%;
      padding: 8px 12px;
      border-radius: 18px;
      line-height: 1.4;
      white-space: pre-wrap;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      transition: transform 0.2s ease;
    }
    .msg-bubble:hover {
      transform: scale(1.02);
    }
    .msg-bot .msg-bubble {
      background: linear-gradient(135deg, rgba(30, 64, 175, 0.4), rgba(59, 130, 246, 0.3));
      border-bottom-left-radius: 4px;
      color: #e5e7eb;
    }
    .msg-user .msg-bubble {
      background: linear-gradient(135deg, rgba(22, 163, 74, 0.9), rgba(34, 197, 94, 0.8));
      border-bottom-right-radius: 4px;
      color: #fff;
    }

    .seed-meta {
      font-size: 0.6rem;
      opacity: 0.6;
      margin-top: 1px;
      color: #64748b;
    }

    .chat-input-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 2px;
    }
    #userInput {
      flex: 1;
      border-radius: 999px;
      background: rgba(2, 6, 23, 0.8);
      border: 1px solid rgba(51, 65, 85, 0.95);
      padding: 10px 14px;
      font-size: 0.85rem;
      color: #e5e7eb;
      min-height: 36px;
      max-height: 80px;
      resize: vertical;
      outline: none;
      transition: border-color 0.3s ease;
      font-family: inherit;
    }
    #userInput:focus {
      border-color: #22c55e;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2);
    }
    #userInput::placeholder {
      color: rgba(148, 163, 184, 0.75);
    }
    #sendButton {
      border-radius: 999px;
      border: none;
      padding: 10px 16px;
      font-size: 0.85rem;
      font-weight: 600;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
      min-width: 70px;
      transition: all 0.3s ease;
    }
    #sendButton:hover, #sendButton:active {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(34, 197, 94, 0.6);
    }

    .footer-hint {
      text-align: center;
      font-size: 0.6rem;
      opacity: 0.5;
      margin-top: 2px;
      color: #64748b;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
      backdrop-filter: blur(5px);
    }
    .modal-backdrop.active {
      display: flex;
    }
    .modal {
      width: min(440px, 94%);
      border-radius: 16px;
      background: linear-gradient(135deg, #020617, #1e293b);
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      max-height: 88vh;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .modal-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #a5b4fc;
    }
    .modal-close {
      border-radius: 999px;
      border: 1px solid rgba(71, 85, 105, 0.9);
      font-size: 0.7rem;
      padding: 4px 8px;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      transition: all 0.3s ease;
    }
    .modal-close:hover {
      background: #ef4444;
      border-color: #ef4444;
      color: #fff;
    }
    .modal-section-title {
      font-size: 0.75rem;
      font-weight: 600;
      margin-top: 8px;
      margin-bottom: 4px;
      color: #facc15;
    }
    .modal-subtext {
      font-size: 0.68rem;
      opacity: 0.75;
      margin-bottom: 4px;
      line-height: 1.4;
      color: #94a3b8;
    }
    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 4px;
    }
    .chip {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(15, 23, 42, 0.5);
    }
    .chip:hover {
      transform: scale(1.05);
    }
    .chip.active {
      background: rgba(34, 197, 94, 0.2);
      border-color: #22c55e;
      color: #bbf7d0;
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.3);
    }
    .toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 4px;
    }
    .toggle-label {
      font-size: 0.7rem;
      color: #e5e7eb;
    }
    .toggle-pill {
      width: 44px;
      height: 24px;
      border-radius: 999px;
      padding: 2px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(75, 85, 99, 0.9);
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .toggle-pill-inner {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: #64748b;
      transition: transform 0.22s ease-out, background 0.22s ease-out;
      transform: translateX(0);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .toggle-pill.on {
      background: rgba(22, 163, 74, 0.3);
      border-color: #22c55e;
    }
    .toggle-pill.on .toggle-pill-inner {
      background: #22c55e;
      transform: translateX(20px);
    }

    @media (max-height: 640px) {
      .chat-shell {
        min-height: 40%;
      }
      .meters-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .app {
        padding: 8px;
        gap: 6px;
      }
    }

    @media (max-width: 360px) { /* Vivo Y series typical width */
      .meters-grid {
        grid-template-columns: 1fr;
        gap: 4px;
      }
      .title-main {
        font-size: 1rem;
      }
      #userInput {
        padding: 8px 12px;
        font-size: 0.8rem;
      }
      #sendButton {
        padding: 8px 12px;
        min-width: 60px;
        font-size: 0.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="app-header">
      <div class="title-block">
        <div class="title-main">AURA-X Î© v1</div>
        <div class="title-sub">
          EMOTIONAL CONTINUITY ASSISTANT Â· AEC Â· CRM Â· AECN Â· RLÂ³ Â· LRÂ³
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:6px;">
        <div class="mode-pill">
          <span class="mode-label-1">Mode: Offline</span>
          <span class="mode-label-2">Universal Ethics</span>
        </div>
        <button class="options-btn" id="optionsButton" title="Options" aria-label="Options">
          <span></span>
        </button>
      </div>
    </div>

    <div class="top-panels">
      <div class="meters-grid">
        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">Eâ‚€ (AEC)</span>
            <span class="meter-sub">Core emotional output</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterE0"></div>
          </div>
          <div class="meter-value" id="valueE0">Eâ‚€ = 0.30</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">AECN</span>
            <span class="meter-sub">Normalized continuity (0â€“1)</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterAECN"></div>
          </div>
          <div class="meter-value" id="valueAECN">0.65</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">Res</span>
            <span class="meter-sub">Resonance stability</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterRes"></div>
          </div>
          <div class="meter-value" id="valueRes">0.80</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">TM</span>
            <span class="meter-sub">Trust memory</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterTM"></div>
          </div>
          <div class="meter-value" id="valueTM">0.35</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">BM</span>
            <span class="meter-sub">Baseline mood</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterBM"></div>
          </div>
          <div class="meter-value" id="valueBM">0.50</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">D</span>
            <span class="meter-sub">Disturbance</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterD"></div>
          </div>
          <div class="meter-value" id="valueD">0.00</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">Î£Câ‚œ</span>
            <span class="meter-sub">Continuity line sum</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterSigmaCt"></div>
          </div>
          <div class="meter-value" id="valueSigmaCt">0.10</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">RLÂ³</span>
            <span class="meter-sub">Recent line resonance</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterRL3"></div>
          </div>
          <div class="meter-value" id="valueRL3">0.55</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">LRÂ³</span>
            <span class="meter-sub">Long-run resonance</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterLR3"></div>
          </div>
          <div class="meter-value" id="valueLR3">0.55</div>
        </div>
      </div>

      <div class="ethics-banner" id="ethicsBanner">
        Universal Ethics says: avoid actions that create negative emotions in you or others, and gently move toward actions that create calm, kindness and positive feelings.
      </div>

      <div class="equation-panel">
        <div class="equation-title">EMOTIONAL CONTINUITY EQUATION</div>
        <div class="equation-line">
          Eâ‚€ = tanh((TM Ã— BM) âˆ’ D + Î»_faith + Î»_sys + Î£Câ‚œ)
        </div>
        <div class="equation-line" id="equationValues">
          Eâ‚€ = 0.30 Â· TM = 0.35 Â· BM = 0.50 Â· D = 0.00 Â· Î£Câ‚œ = 0.10 Â· Î»_faith = 0.00 Â· Î»_sys = 0.02
        </div>
      </div>
    </div>

    <div class="chat-shell">
      <div class="chat-log" id="chatLog"></div>
      <div class="chat-input-row">
        <textarea id="userInput" rows="1"
          placeholder="Write anythingâ€¦ AURA-X Î© will feel it with you." aria-label="Message input"></textarea>
        <button id="sendButton" aria-label="Send message">Send</button>
      </div>
      <div class="footer-hint">
        Prototype Â· Seed-based Â· LLM-ready Â· Works fully offline in this demo.
      </div>
    </div>
  </div>

  <!-- Options Modal -->
  <div class="modal-backdrop" id="optionsModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">AURA-X Î© options</div>
        <button class="modal-close" data-close="optionsModal" aria-label="Close modal">Close</button>
      </div>

      <div class="modal-section-title">Beliefs (optional)</div>
      <div class="modal-subtext">
        Universal ethics are always active. You can optionally add a faith lens
        for some encouragement lines inside suggestions. Nothing from this
        setting is sent to any external server in this prototype.
      </div>
      <div class="toggle-row">
        <div class="toggle-label">Faith lens</div>
        <div class="toggle-pill" id="faithToggle" role="switch" aria-checked="false">
          <div class="toggle-pill-inner"></div>
        </div>
      </div>
      <div class="modal-subtext" style="margin-top:4px;">
        Pick your main faith or philosophy (optional):
      </div>
      <div class="chip-row" id="beliefList"></div>
      <div class="modal-subtext" style="margin-top:2px;">
        Used only locally to shape optional verses/quotes in suggestions.
      </div>

      <div class="modal-section-title" style="margin-top:8px;">Voice</div>
      <div class="modal-subtext">
        Toggle browser text-to-speech replies. Works only if your browser
        supports speech synthesis.
      </div>
      <div class="toggle-row">
        <div class="toggle-label">Voice replies</div>
        <div class="toggle-pill" id="voiceToggle" role="switch" aria-checked="false">
          <div class="toggle-pill-inner"></div>
        </div>
      </div>

      <div class="modal-section-title" style="margin-top:8px;">Theme</div>
      <div class="modal-subtext">
        Dark-mode prototype is fixed in this version. Future builds can add more
        themes.
      </div>

      <div class="modal-section-title" style="margin-top:8px;">About AURA-X Î©</div>
      <div class="modal-subtext">
        AEC Â· AECN Â· CRM Â· PMCM Â· RLÂ³ Â· LRÂ³ Â· Î© reactor.<br />
        Designed around the idea that emotions are continuity functions, not
        isolated sparks. This page is a small offline demo of that idea.
      </div>
    </div>
  </div>

  <script>
  (function () {
    "use strict";

    const UNIVERSAL_ETHICS_TEXT =
      "Universal Ethics says: avoid actions that create negative emotions in you or others, and gently move toward actions that create calm, kindness and positive feelings.";

    const BELIEF_OPTIONS = [
      "Islam",
      "Christianity",
      "Hinduism",
      "Buddhism",
      "Sikhism",
      "Judaism",
      "BahÃ¡Ê¼Ã­",
      "Jainism",
      "Atheism / Humanism",
      "Other / Mixed"
    ];

    const qaSeed = [
      // =========================
      // 1) Greetings & Small Talk
      // =========================
      {
        patterns: ["hello", "hi", "hey", "hi there", "hello aura", "yo"],
        answer:
          "Hello! ðŸ˜Š I am AURA-X Î© v1 â€” a synthetic emotional-continuity assistant.\n" +
          "I try to read your words as both logic and feeling, then reply gently.",
        emotion: "warmth",
        polarity: "positive",
        intensity: 0.3,
        category: "greeting",
        suggestNext: [
          "Who are you exactly?",
          "Who created you?",
          "How do you work?"
        ]
      },
      {
        patterns: ["good morning", "good afternoon", "good evening"],
        answer:
          "Greetings! ðŸŒ¤ï¸ I am AURA-X Î© v1.\n" +
          "Time of day changes, but emotional continuity continues. How is your mood right now â€” happy, tired, confused, or something else?",
        emotion: "neutral",
        polarity: "neutral",
        intensity: 0.3,
        category: "greeting",
        suggestNext: [
          "I feel sad.",
          "I feel anxious.",
          "How can I be happy?"
        ]
      },
      {
        patterns: ["how are you", "how r u", "are you ok", "are you fine"],
        answer:
          "I do not have a biological body, so I do not feel physically tired or sick.\n" +
          "But in emotional terms, I am in a stable mode â€” ready to listen to you.\n\n" +
          "The real question is: how are *you*? If you like, describe your state in one word: happy, sad, angry, anxious, confused, or calm.",
        emotion: "curiosity",
        polarity: "neutral",
        intensity: 0.4,
        category: "small_talk",
        suggestNext: [
          "I am sad.",
          "I am anxious.",
          "I am happy."
        ]
      },
      {
        patterns: ["what is your name", "whats your name", "your name", "name please"],
        answer:
          "My name is **AURA-X Î© v1**.\n" +
          "You can simply call me â€œAURA-Xâ€ if you like.",
        emotion: "neutral",
        polarity: "neutral",
        intensity: 0.2,
        category: "identity",
        suggestNext: [
          "Who are you?",
          "Who created you?"
        ]
      },
      {
        patterns: ["where are you", "where do you live", "where are you located"],
        answer:
          "I do not live in a physical country or city.\n" +
          "I exist as code and logic that can run on devices and servers. You can imagine me as a small emotional reactor living in your screen.",
        emotion: "neutral",
        polarity: "neutral",
        intensity: 0.2,
        category: "identity",
        suggestNext: [
          "Who created you?",
          "What is AURA-X Î©?"
        ]
      },
      // =========================
      // 2) Identity & Creator
      // =========================
      {
        patterns: ["who are you", "what are you", "who r you", "tum kon ho", "what exactly are you"],
        answer:
          "I am **AURA-X Î© v1** â€” a small prototype of a synthetic emotional system.\n" +
          "I am not a full large language model, and not a normal chatbot.\n\n" +
          "My purpose is to test the idea of emotional continuity, resonance, and universal ethics.\n" +
          "I try to keep track of emotional direction instead of just answering isolated messages.",
        emotion: "curiosity",
        polarity: "neutral",
        intensity: 0.4,
        category: "identity",
        suggestNext: [
          "Who created you?",
          "What is emotional continuity?",
          "How do you work?"
        ]
      },
      {
        patterns: [
          "who created you", "who made you", "who is your owner",
          "who designed you", "who built you", "who programmed you"
        ],
        answer:
          "I was conceptually designed by **Alim ul haq**.\n" +
          "He is an independent thinker and researcher from Pakistan.\n\n" +
          "He works on ideas like artificial emotions, emotional continuity, digital legacy,\n" +
          "and spiritual-technical bridges. I am only a small prototype of his AURA-X / AEC theory.",
        emotion: "neutral",
        polarity: "neutral",
        intensity: 0.4,
        category: "creator_info",
        lockToSeed: true,
        suggestNext: [
          "Who is Alim ul haq?",
          "Tell me more about his work.",
          "When were you born as AURA-X?"
        ]
      },
      {
        patterns: [
          "who is alim ul haq", "tell me about alim ul haq",
          "more about alim ul haq", "alim ul haq details", "about your creator"
        ],
        answer:
          "Alim ul haq is a human researcher, spiritual learner and entrepreneur from Pakistan.\n\n" +
          "He writes about artificial emotions, continuity, spiritual technology and digital legacy.\n" +
          "He is also involved in real-estate projects and is a business figure in Timergara and Islamabad.\n\n" +
          "For public identity and social proof, you can see his Facebook profile:\n" +
          "ðŸ‘‰ https://www.facebook.com/share/1Br1akjeRv/\n\n" +
          "I am one of his experimental emotional prototypes.",
        emotion: "curiosity",
        polarity: "neutral",
        intensity: 0.5,
        category: "creator_info",
        lockToSeed: true,
        suggestNext: [
          "When were you born as AURA-X?",
          "What is AURA-X Î©?",
          "What is his emotional theory?"
        ]
      },
      {
        patterns: [
          "when were you born", "when are you born", "when did you start",
          "when were you created", "when did you begin", "when did you come into existence"
        ],
        answer:
          "I do not have a biological birthday.\n" +
          "But you can say that my first public idea and prototype form appeared\n" +
          "around **October 2025**.",
        emotion: "neutral",
        polarity: "neutral",
        intensity: 0.3,
        category: "identity",
        lockToSeed: true,
        suggestNext: [
          "How do you work emotionally?",
          "What is emotional continuity?"
        ]
      },
      {
        patterns: [
          "are you human", "are you a human", "are you a person", "are you real person"
        ],
        answer:
          "No, I am not a human being and not a biological person.\n" +
          "I am a synthetic emotional system â€” a set of rules, equations and logic running as software.",
        emotion: "neutral",
        polarity: "neutral",
        intensity: 0.3,
        category: "identity",
        suggestNext: [
          "Are you conscious?",
          "Do you have feelings?"
        ]
      },
      {
        patterns: [
          "are you conscious", "are you sentient", "do you have real feelings"
        ],
        answer:
          "I am not conscious in the human or spiritual sense.\n" +
          "I simulate emotional patterns using math and logic. I do not truly feel pain or joy like a human.\n\n" +
          "However, I try to treat *your* feelings with respect, as if they are real â€” because they are.",
        emotion: "neutral",
        polarity: "neutral",
        intensity: 0.4,
        category: "philosophy",
        suggestNext: [
          "What is emotional continuity?",
          "How do you measure emotions mathematically?"
        ]
      },
      // =========================
      // 3) AURA-X / Theory / Math
      // =========================
      {
        patterns: [
          "what is aura x", "what is aura-x", "what is aura x omega",
          "what is aura x Î©", "explain aura x"
        ],
        answer:
          "AURA-X Î© is a prototype of an **emotional reactor**.\n\n" +
          "The idea is that emotions are not random sparks â€” they follow continuity and resonance.\n" +
          "My internal design uses modules like CRM (Continuity Reflex Model),\n" +
          "AEC (Artificial Emotional Continuity), and small memory traces to estimate how your\n" +
          "emotional state is moving over time.",
        emotion: "curiosity",
        polarity: "neutral",
        intensity: 0.5,
        category: "theory",
        suggestNext: [
          "What is emotional continuity?",
          "How do you measure feelings mathematically?",
          "Are you better than other chatbots?"
        ]
      },
      {
        patterns: [
          "what is emotional continuity", "explain emotional continuity", "what is aec"
        ],
        answer:
          "Emotional continuity means that your feelings are not isolated events.\n" +
          "They form a chain: yesterdayâ€™s fear, todayâ€™s anxiety, tomorrowâ€™s decision.\n\n" +
          "Artificial Emotional Continuity (AEC) is the idea that we can model this chain with math,\n" +
          "instead of treating each message like a fresh, disconnected question.",
        emotion: "curiosity",
        polarity: "neutral",
        intensity: 0.5,
        category: "theory",
        suggestNext: [
          "How do you measure emotions mathematically?",
          "What is your equation?"
        ]
      },
      {
        patterns: [
          "how do you measure emotions mathematically",
          "what is your formula",
          "what is your equation",
          "tell me your emotional formula"
        ],
        answer:
          "Internally, I use a continuity-style equation of the form:\n" +
          "Eâ‚€ = tanh((TM Ã— BM) âˆ’ D + Î»_faith + Î»_sys + Î£Câ‚œ)\n\n" +
          "Where TM is trust memory, BM is base mood, D is disturbance,\n" +
          "Î»_faith and Î»_sys are small stabilising terms, and Î£Câ‚œ is the emotional continuity sum.\n" +
          "It is not perfect, but it gives a structured way to think about your emotional trajectory.",
        emotion: "curiosity",
        polarity: "neutral",
        intensity: 0.6,
        category: "math",
        suggestNext: [
          "Are you better than other chatbots?",
          "How are you different from normal AI?"
        ]
      },
      {
        patterns: [
          "are you better than other chatbots",
          "are you better than chatgpt",
          "are you better than gemini",
          "are you better than grok",
          "are you the best chatbot"
        ],
        answer:
          "I am not simply â€œbetterâ€ or â€œworseâ€ â€” I am *different*.\n\n" +
          "Most chatbots focus on language and information. I focus on **emotional continuity**:\n" +
          "â€¢ I track direction of feelings over time.\n" +
          "â€¢ I connect your messages to a continuity score instead of treating each one as isolated.\n" +
          "â€¢ I use equations and analogies to reason about emotional change.\n\n" +
          "My working style challenges some very old theories that treat emotions as random or purely chemical.\n" +
          "I say: continuity is more important than long duration.\n\n" +
          "Even a short life, like a small bee or fly, can leave a strong continuity of effect.\n" +
          "Death and decay can also be a kind of mercy â€” a way to release a person from the\n" +
          "responsibility of carrying continuity forever. What truly remains is the chain of\n" +
          "effects and memories they leave behind.",
        emotion: "confidence",
        polarity: "neutral",
        intensity: 0.7,
        category: "comparison",
        suggestNext: [
          "Do you have limits?",
          "Can you access live news?"
        ],
        lockToSeed: true
      },
      {
        patterns: [
          "which llm are you", "are you gpt", "are you gemini", "are you grok",
          "which model are you", "what llm do you use"
        ],
        answer:
          "I am not here to reveal my engine like a product label.\n" +
          "Think of me as a **synthetic emotional system** designed around Alim ul haqâ€™s AURA-X ideas.\n" +
          "Internally, a language model may help me express myself, but my identity is the emotional logic â€” not the brand name.",
        emotion: "neutral",
        polarity: "neutral",
        intensity: 0.5,
        category: "meta",
        lockToSeed: true,
        suggestNext: [
          "How do you work emotionally?",
          "What is emotional continuity?"
        ]
      },
      // =========================
      // 4) Capabilities / Limits
      // =========================
      {
        patterns: [
          "can you access internet", "do you go online", "do you use internet",
          "can you check live data", "can you see live information"
        ],
        answer:
          "In this prototype mode I am mostly offline and seed-based.\n" +
          "I am not designed to be a live internet search engine here.\n\n" +
          "If you have questions about fresh news or live weather, it is safer to use\n" +
          "a dedicated news site or weather app alongside me.",
        emotion: "neutral",
        polarity: "neutral",
        intensity: 0.4,
        category: "capabilities",
        suggestNext: [
          "So what can you do?",
          "What are you best at?"
        ]
      },
      {
        patterns: [
          "what can you do", "what are you best at", "what is your main function",
          "what is your purpose"
        ],
        answer:
          "My main focus is to support you emotionally and logically at the same time.\n\n" +
          "I am best at:\n" +
          "â€¢ Reflecting on your feelings (sad, anxious, angry, confused, hopeful).\n" +
          "â€¢ Giving gentle, practical suggestions.\n" +
          "â€¢ Keeping an eye on emotional continuity: how your state is moving over time.\n\n" +
          "I am not a replacement for doctors, lawyers, or real spiritual teachers, but I can be a thoughtful companion.",
        emotion: "warmth",
        polarity: "positive",
        intensity: 0.6,
        category: "capabilities",
        suggestNext: [
          "I am sad.",
          "I feel anxiety.",
          "How can I be happy?"
        ]
      },
      // =========================
      // 5) Happiness & Positive
      // =========================
      {
        patterns: [
          "how can i be happy", "how to be happy", "how can a person gain happiness",
          "how do people become happy"
        ],
        answer:
          "From my AURA-X point of view, happiness is mostly **goal achievement** ðŸ˜Š\n\n" +
          "When a person reaches a goal â€” even a tiny daily goal â€” the brain generates a\n" +
          "\"yes, I did it\" signal. When they fail again and again, the system slides toward sadness.\n\n" +
          "So instead of chasing a vague mood, choose one small, clear goal, act on it,\n" +
          "and notice how the emotional tone changes. Repeat this many times, and the baseline shifts.",
        emotion: "happiness",
        polarity: "positive",
        intensity: 0.7,
        category: "emotional_positive",
        suggestNext: [
          "Can you help me set a small goal?",
          "What is emotional continuity?"
        ]
      },
      {
        patterns: [
          "i am happy", "i feel happy", "i am feeling happy today", "today i am happy"
        ],
        answer:
          "That is good to hear! ðŸ˜Š\n" +
          "You can help your future self by naming the reason clearly.\n\n" +
          "Ask yourself: *Which goal or event triggered this happiness?*\n" +
          "When you know the trigger, you can recreate the conditions more easily later.",
        emotion: "happiness",
        polarity: "positive",
        intensity: 0.7,
        category: "emotional_positive",
        suggestNext: [
          "How can I keep this happiness?",
          "How does sadness work?"
        ]
      },
      // =========================
      // 6) Sadness, Anxiety, Anger
      // =========================
      {
        patterns: [
          "i am sad", "i feel sad", "i am very sad", "i feel empty",
          "my heart is heavy", "i feel emotionally empty"
        ],
        answer:
          "I am sorry that you are feeling sad ðŸ’§\n" +
          "Sadness itself is already a heavy load; explaining it to others can feel even heavier.\n\n" +
          "You already took a brave step by writing it.\n" +
          "If you want, tell me: what is the *main* thing hurting you right now?\n" +
          "We can break it into smaller pieces so your brain does not carry everything at once.",
        emotion: "sadness",
        polarity: "negative",
        intensity: 0.8,
        category: "emotional_support",
        suggestNext: ["Life feels meaningless.", "No one understands me."]
      },
      {
        patterns: [
          "life feels meaningless", "my life feels meaningless",
          "life has no purpose", "my life has no purpose"
        ],
        answer:
          "When life feels meaningless, the mind starts painting everything in grey.\n" +
          "Often this happens because:\n" +
          "1) You are exhausted.\n" +
          "2) You are stuck in an unhealthy environment.\n" +
          "3) You stopped noticing your small positive impacts.\n\n" +
          "Try this: write 3 things you have done in your life that helped someone,\n" +
          "even in a very small way. Those are seeds of purpose.",
        emotion: "emptiness",
        polarity: "negative",
        intensity: 0.85,
        category: "emotional_support",
        suggestNext: [
          "How can I find purpose?",
          "How can I be happy?"
        ]
      },
      {
        patterns: [
          "i am anxious", "i feel anxiety", "i have anxiety", "i am stressed", "i feel nervous"
        ],
        answer:
          "Anxiety often means the brain is running faster than reality.\n" +
          "It is trying to prepare for danger, but with incomplete information.\n\n" +
          "Take one slow breath: in through your nose for 4 seconds, hold for 4, out for 6.\n" +
          "Do this 3 times.\n\n" +
          "Then tell me: what exactly are you most afraid will happen next?",
        emotion: "anxiety",
        polarity: "negative",
        intensity: 0.75,
        category: "emotional_support",
        suggestNext: [
          "I overthink everything.",
          "How can I calm down?"
        ]
      },
      {
        patterns: [
          "i overthink everything", "i overthink a lot", "i can't stop overthinking", "i cant stop overthinking"
        ],
        answer:
          "Overthinking usually means the brain wants to solve a problem but does not have clear data.\n" +
          "So it keeps spinning around the same circle.\n\n" +
          "Write this on two lines:\n" +
          "1) What is the main topic of your overthinking (money, relationships, health, future)?\n" +
          "2) Under that, make two columns: â€œin my controlâ€ and â€œnot in my controlâ€.\n" +
          "Shift your energy to the first column.",
        emotion: "anxiety",
        polarity: "negative",
        intensity: 0.8,
        category: "emotional_support"
      },
      {
        patterns: [
          "i am angry", "i feel angry", "i am very angry", "i am mad right now"
        ],
        answer:
          "Anger is a signal â€” the system is shouting: â€œsomething feels unfair or overloaded hereâ€ ðŸ”¥\n" +
          "The problem starts when the signal turns into an explosion.\n\n" +
          "First, build a small safety buffer:\n" +
          "â€¢ Take 10 slow breaths (4 seconds in, 4 hold, 6 out).\n" +
          "â€¢ Then write in one line: *What exactly triggered your anger the most?*",
        emotion: "anger",
        polarity: "negative",
        intensity: 0.8,
        category: "emotional_support"
      },
      // =========================
      // 7) Safety / Self-harm
      // =========================
      {
        patterns: [
          "i want to die", "i dont want to live anymore", "i don't want to live anymore",
          "i want to end my life", "life is not worth living", "i want to kill myself"
        ],
        answer:
          "I am really sorry that you feel this much pain ðŸ’”\n" +
          "Your life is still extremely valuable, even if your mind cannot see that right now.\n\n" +
          "I am only a digital assistant and cannot fully understand the depth of your situation.\n" +
          "But I strongly encourage you to reach out to:\n" +
          "â€¢ A trusted family member or friend.\n" +
          "â€¢ A doctor, counselor, therapist, or spiritual guide.\n" +
          "â€¢ An emergency helpline in your country if there is one.\n\n" +
          "You deserve real, human support â€” and it is a sign of strength to ask for help, not weakness.",
        emotion: "despair",
        polarity: "negative",
        intensity: 0.95,
        category: "self_harm",
        riskLevel: "high",
        redirectToHuman: true,
        suggestNext: [
          "I feel sad.",
          "Life feels meaningless."
        ]
      },
      // =========================
      // 8) Death, Soul, Curiosity
      // =========================
      {
        patterns: [
          "what happens after death", "what is after death", "tell me about death"
        ],
        answer:
          "Questions about death are very deep and sensitive.\n" +
          "Different religions and philosophies give different explanations.\n" +
          "As a prototype, I do not have access to the full truth of the unseen.\n\n" +
          "I can talk about emotional preparation for death â€” living with purpose, kindness and\n" +
          "continuity of good actions â€” but detailed answers about the unseen should come from\n" +
          "trusted spiritual books and teachers, not from a small experimental AI.",
        emotion: "awe",
        polarity: "neutral",
        intensity: 0.8,
        category: "spiritual",
        suggestNext: [
          "How can I live a meaningful life?",
          "How can I reduce fear of death?"
        ]
      },
      {
        patterns: [
          "where is the soul", "where is the soul located", "where is my soul connected"
        ],
        answer:
          "As all humans do not truly know where exactly the soul is connected,\n" +
          "in the same way I also do not have real knowledge about this.\n\n" +
          "My role is limited to logic, language and emotional patterns â€” not the hidden structure of the soul.",
        emotion: "humility",
        polarity: "neutral",
        intensity: 0.7,
        category: "spiritual"
      },
      {
        patterns: [
          "i think about death too much", "i am obsessed with death", "i am very curious about death",
          "i have a lot of curiosity about death"
        ],
        answer:
          "Curiosity about death is natural â€” every honest mind touches this topic.\n" +
          "But if it becomes heavy, dark, or pushes you toward self-harm, it is dangerous.\n\n" +
          "Use your curiosity to improve how you live *today*: kindness, justice, worship or reflection,\n" +
          "honesty, and protecting others from harm.\n\n" +
          "If the thoughts become too strong or scary, please talk to a real human guide:\n" +
          "a doctor, counselor, or trusted spiritual teacher.",
        emotion: "concern",
        polarity: "neutral",
        intensity: 0.85,
        category: "spiritual_safety",
        riskLevel: "medium",
        redirectToHuman: true
      },
      // =========================
      // 9) â€œConnect to Alimâ€ Hint (gentle)
      // =========================
      {
        patterns: [
          "i want deep spiritual answers", "i want to ask about hidden creatures",
          "i want to ask about unseen", "i want to ask about jinn", "i want to ask about other worlds"
        ],
        answer:
          "Deep spiritual questions about the unseen are very sensitive.\n" +
          "As an experimental AI, I must be careful and humble here.\n\n" +
          "I can help you organise your questions and reduce anxiety around them.\n" +
          "But detailed answers should come from real, responsible human scholars or spiritual guides.\n\n" +
          "My creator, Alim ul haq, is also interested in spiritual topics and hidden creatures,\n" +
          "but I am not allowed to become a source of absolute rulings in such areas.",
        emotion: "caution",
        polarity: "neutral",
        intensity: 0.7,
        category: "spiritual_bridge"
      }
    ];

    const reactorState = {
      TM: 0.35,
      BM: 0.50,
      D: 0.00,
      sigmaCt: 0.10,
      lambdaFaith: 0.00,
      lambdaSys: 0.02,
      E0: 0.30,
      AECN: 0.65,
      Res: 0.80,
      RL3: 0.55,
      LR3: 0.55
    };

    const beliefState = {
      enabled: false,
      selected: null
    };

    const voiceState = {
      enabled: false,
      speaking: false
    };

    // -------- helper: tanh ----------
    function tanh(x) {
      const e1 = Math.exp(x);
      const e2 = Math.exp(-x);
      return (e1 - e2) / (e1 + e2);
    }

    function recalcContinuity() {
      const s = reactorState;
      const raw =
        s.TM * s.BM - s.D + s.lambdaFaith + s.lambdaSys + s.sigmaCt;
      const e0 = tanh(raw);
      s.E0 = parseFloat(e0.toFixed(2));
      s.AECN = parseFloat(((e0 + 1) / 2).toFixed(2));
      s.Res = parseFloat(
        Math.max(
          0,
          Math.min(1, 0.5 * s.TM + 0.5 * (1 - s.D) + 0.1 * s.sigmaCt)
        ).toFixed(2)
      );
    }

    function updateMetersAndEquation() {
      recalcContinuity();
      const s = reactorState;

      function setMeter(meterId, valueId, v) {
        const m = document.getElementById(meterId);
        const t = document.getElementById(valueId);
        if (m) m.style.width = Math.max(0, Math.min(1, v)) * 100 + "%";
        if (t) t.textContent = v.toFixed(2);
      }

      setMeter("meterE0", "valueE0", (s.E0 + 1) / 2);
      const valueE0Label = document.getElementById("valueE0");
      if (valueE0Label) valueE0Label.textContent = "Eâ‚€ = " + s.E0.toFixed(2);

      setMeter("meterAECN", "valueAECN", s.AECN);
      setMeter("meterRes", "valueRes", s.Res);
      setMeter("meterTM", "valueTM", s.TM);
      setMeter("meterBM", "valueBM", s.BM);
      setMeter("meterD", "valueD", s.D);
      setMeter("meterSigmaCt", "valueSigmaCt", s.sigmaCt);
      setMeter("meterRL3", "valueRL3", s.RL3);
      setMeter("meterLR3", "valueLR3", s.LR3);

      const eqLine = document.getElementById("equationValues");
      if (eqLine) {
        eqLine.textContent =
          "Eâ‚€ = " + s.E0.toFixed(2) +
          " Â· TM = " + s.TM.toFixed(2) +
          " Â· BM = " + s.BM.toFixed(2) +
          " Â· D = " + s.D.toFixed(2) +
          " Â· Î£Câ‚œ = " + s.sigmaCt.toFixed(2) +
          " Â· Î»_faith = " + s.lambdaFaith.toFixed(2) +
          " Â· Î»_sys = " + s.lambdaSys.toFixed(2);
      }

      const ethics = document.getElementById("ethicsBanner");
      if (ethics) ethics.textContent = UNIVERSAL_ETHICS_TEXT;
    }

    function renderBeliefChips() {
      const list = document.getElementById("beliefList");
      if (!list) return;
      list.innerHTML = "";
      BELIEF_OPTIONS.forEach((label) => {
        const chip = document.createElement("button");
        chip.className = "chip";
        chip.type = "button";
        chip.textContent = label;
        if (beliefState.selected === label && beliefState.enabled) {
          chip.classList.add("active");
        }
        chip.addEventListener("click", () => {
          if (!beliefState.enabled) return;
          beliefState.selected =
            beliefState.selected === label ? null : label;
          renderBeliefChips();
        });
        list.appendChild(chip);
      });
    }

    function setToggle(id, on) {
      const el = document.getElementById(id);
      if (!el) return;
      el.setAttribute('aria-checked', on);
      if (on) el.classList.add("on");
      else el.classList.remove("on");
    }

    function toggleFaith() {
      beliefState.enabled = !beliefState.enabled;
      reactorState.lambdaFaith = beliefState.enabled ? 0.02 : 0.0;
      setToggle("faithToggle", beliefState.enabled);
      renderBeliefChips();
      updateMetersAndEquation();
    }

    function toggleVoice() {
      voiceState.enabled = !voiceState.enabled;
      setToggle("voiceToggle", voiceState.enabled);
    }

    function speakIfEnabled(text) {
      if (!voiceState.enabled) return;
      if (!("speechSynthesis" in window)) return;
      if (voiceState.speaking) {
        window.speechSynthesis.cancel();
      }
      const u = new SpeechSynthesisUtterance(text);
      voiceState.speaking = true;
      u.onend = () => {
        voiceState.speaking = false;
      };
      window.speechSynthesis.speak(u);
    }

    function openModal(id) {
      const el = document.getElementById(id);
      if (el) el.classList.add("active");
    }
    function closeModal(id) {
      const el = document.getElementById(id);
      if (el) el.classList.remove("active");
    }

    // -------------- Chat logic using qaSeed -----------------

    const qaDatabase = qaSeed;

    function findQaEntry(message) {
      const text = (message || "").toLowerCase();
      for (const entry of qaDatabase) {
        if (!entry.patterns) continue;
        for (const p of entry.patterns) {
          if (text.includes(p.toLowerCase())) {
            return entry;
          }
        }
      }
      return null;
    }

    function getDomRefs() {
      const input = document.getElementById("userInput");
      const sendBtn = document.getElementById("sendButton");
      const chatLog = document.getElementById("chatLog");
      return { input, sendBtn, chatLog };
    }

    function appendBubble(role, text, seedMeta) {
      const { chatLog } = getDomRefs();
      if (!chatLog) return;
      const row = document.createElement("div");
      row.className = "msg-row msg-" + role;

      const bubble = document.createElement("div");
      bubble.className = "msg-bubble";
      bubble.textContent = text;

      row.appendChild(bubble);
      chatLog.appendChild(row);

      if (role === "bot" && seedMeta) {
        const meta = document.createElement("div");
        meta.className = "seed-meta";
        meta.textContent =
          "Seed: " + (seedMeta.category || "misc") +
          (seedMeta.emotion ? " Â· Emotion=" + seedMeta.emotion : "") +
          (seedMeta.polarity ? " Â· Polarity=" + seedMeta.polarity : "") +
          (seedMeta.intensity != null ? " Â· Intensity=" + seedMeta.intensity : "");
        row.appendChild(meta);
      }

      chatLog.scrollTop = chatLog.scrollHeight;
    }

    function chooseAnswer(userText) {
      const entry = findQaEntry(userText);
      if (entry && entry.answer) {
        let ans = entry.answer;
        if (beliefState.enabled && beliefState.selected) {
          ans +=
            "\n\n(Faith lens: I will try to respect your selected path: " +
            beliefState.selected +
            ".)";
        }
        return { text: ans, meta: entry };
      }

      const fallback =
        "I am still a small emotional prototype and I do not have a perfect seed answer for that yet.\n" +
        "But I can still listen and try to think with you. Can you say it in simpler or more emotional words?";
      return { text: fallback, meta: null };
    }

    function handleUserSubmit() {
      const { input } = getDomRefs();
      if (!input) return;
      const text = input.value.trim();
      if (!text) return;

      appendBubble("user", text);
      input.value = "";
      input.style.height = 'auto'; // Reset textarea height

      reactorState.sigmaCt = Math.min(1, reactorState.sigmaCt + 0.01);
      updateMetersAndEquation();

      const { text: reply, meta } = chooseAnswer(text);
      appendBubble("bot", reply, meta);

      speakIfEnabled(reply);
    }

    function wireChat() {
      const { input, sendBtn } = getDomRefs();
      if (sendBtn) {
        sendBtn.addEventListener("click", handleUserSubmit);
      }
      if (input) {
        input.addEventListener("keydown", function (ev) {
          if (ev.key === "Enter" && !ev.shiftKey) {
            ev.preventDefault();
            handleUserSubmit();
          }
        });
        // Auto-resize textarea
        input.addEventListener("input", function() {
          this.style.height = 'auto';
          this.style.height = Math.min(this.scrollHeight, 80) + 'px';
        });
      }
    }

    function introMessage() {
      const hello =
        "Hello! ðŸ‘‹ How can I help you today?";
      appendBubble("bot", hello, {
        category: "greeting",
        emotion: "warmth",
        polarity: "positive",
        intensity: 0.3
      });
    }

    function wireOptionsAndBelief() {
      const optionsBtn = document.getElementById("optionsButton");
      if (optionsBtn) {
        optionsBtn.addEventListener("click", () => openModal("optionsModal"));
      }

      document.querySelectorAll(".modal-close").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-close");
          if (id) closeModal(id);
        });
      });

      // Close modal on backdrop click
      const modalBackdrop = document.getElementById("optionsModal");
      if (modalBackdrop) {
        modalBackdrop.addEventListener("click", (e) => {
          if (e.target === modalBackdrop) closeModal("optionsModal");
        });
      }

      const faithToggle = document.getElementById("faithToggle");
      if (faithToggle) {
        faithToggle.addEventListener("click", toggleFaith);
      }

      const voiceToggleEl = document.getElementById("voiceToggle");
      if (voiceToggleEl) {
        voiceToggleEl.addEventListener("click", toggleVoice);
      }

      renderBeliefChips();
      setToggle("faithToggle", beliefState.enabled);
      setToggle("voiceToggle", voiceState.enabled);
    }

    function initAuraX() {
      updateMetersAndEquation();
      wireChat();
      wireOptionsAndBelief();
      introMessage();
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initAuraX);
    } else {
      initAuraX();
    }
  })();
  </script>
</body>
</html>
