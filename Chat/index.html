<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
<title>AURA-X â€¢ Live Emotion + Summary % + Guidance</title>
<style>
  :root{ --bg:#0b1220; --card:#142136; --text:#eaf2ff; --muted:#9eb1cc; --radius:18px; }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:var(--text);background:#000;overflow-x:hidden}

  /* Live aura */
  .pulse{position:fixed;inset:0;z-index:-2;background:radial-gradient(circle at 50% 40%, rgba(49,168,255,.33) 0%, transparent 70%);
         animation:pulse 6s ease-in-out infinite;transition:background .8s ease,opacity .5s ease}
  @keyframes pulse{0%{opacity:.55;transform:scale(1)}50%{opacity:.98;transform:scale(1.04)}100%{opacity:.55;transform:scale(1)}}
  .glow{position:fixed;inset:0;z-index:-1;background:radial-gradient(closest-side, rgba(49,168,255,.35), #0000 70%);filter:blur(22px);transition:background .8s ease}

  .wrap{min-height:100%;display:flex;flex-direction:column}
  header{padding:18px 18px 6px;text-align:center}
  .badge{display:inline-flex;gap:10px;align-items:center;padding:6px 12px;border-radius:999px;background:#ffffff14;color:#cfe6ff;font-size:12px;border:1px solid #ffffff18}

  .chat{width:100%;max-width:880px;margin:0 auto;padding:10px 14px 140px}
  .bubble{background:#132135;border:1px solid #ffffff14;border-radius:var(--radius);padding:16px 18px;margin:12px 0;line-height:1.45;box-shadow:0 8px 18px #00000030}
  .user{background:#0f1b2d}
  .bot-title{font-weight:700;margin-bottom:6px}
  .muted{color:var(--muted)} .echo{opacity:.9;font-style:italic}

  /* summary */
  .sum{display:flex;align-items:center;gap:10px;margin-top:10px}
  .pill{background:#ffffff14;border:1px solid #ffffff18;border-radius:999px;padding:6px 10px;font-size:12px;color:#cfe6ff}
  .ringwrap{position:relative;width:38px;height:38px}
  .ringwrap svg{transform:rotate(-90deg)}
  .pct{position:absolute;inset:0;display:grid;place-items:center;font-size:11px;color:#cfe6ff}

  /* guidance card */
  .guide{margin-top:12px;border-radius:14px;border:1px solid #ffffff22;padding:12px 14px;background:#0e1a2b}
  .guide h4{margin:0 0 4px;font-size:14px}
  .guide small{color:#9fb4d1}
  .g-neutral{border-color:#3aa4ff55}
  .g-ethics{border-color:#26d4a855}
  .g-islamic{border-color:#ffd64855}

  /* composer */
  .composer{position:fixed;left:0;right:0;bottom:0;padding:10px 12px 18px;background:linear-gradient(to top,#060a13 55%,transparent);backdrop-filter:saturate(120%) blur(2px)}
  .composer-inner{max-width:880px;margin:0 auto;display:flex;flex-direction:column;gap:10px}
  .toprow{display:flex;gap:10px;align-items:center}
  .input-wrap{position:relative;flex:1}
  .input{width:100%;min-height:48px;padding:12px 14px;border-radius:14px;background:#0f1a2c;color:var(--text);border:1px solid #ffffff18;outline:none;font-size:16px}
  .input::placeholder{color:#7f93b3}
  .ring{pointer-events:none;position:absolute;inset:-3px;border-radius:16px;border:2px solid rgba(50,179,255,.45);
        box-shadow:0 0 18px rgba(50,179,255,.26),0 0 38px rgba(50,179,255,.16);transition:all .5s ease}
  .send{height:48px;padding:0 18px;border:none;border-radius:12px;background:linear-gradient(180deg,#32b3ff,#1493ee);color:#fff;font-weight:700;letter-spacing:.2px;
        box-shadow:0 10px 18px #1190ee55}

  /* guidance controls */
  .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .toggle{display:flex;align-items:center;gap:8px;background:#0e1626;border:1px solid #ffffff1a;border-radius:12px;padding:8px 10px}
  select{background:#0e1626;border:1px solid #ffffff1a;color:#cfe6ff;border-radius:10px;padding:8px 10px}
  label{font-size:13px;color:#cfe6ff}
  @media (max-width:420px){.chat{padding-bottom:170px}}
</style>
</head>
<body>
  <div class="pulse" id="pulse"></div>
  <div class="glow"  id="glow"></div>

  <div class="wrap">
    <header><span class="badge">Î© AURA-X â€¢ <span id="state">calm</span></span></header>

    <main class="chat" id="chat">
      <div class="bubble">ğŸ‘‹ Hello! Iâ€™m AURA-X â€” your emotional resonance prototype. Tell me how you feel today.</div>
    </main>

    <div class="composer">
      <form id="composerForm" class="composer-inner" autocomplete="off">
        <div class="toprow">
          <div class="input-wrap" style="flex:1">
            <input id="inp" class="input" type="text" placeholder="Ø§Ù¾Ù†Ø§ Ø§Ø­Ø³Ø§Ø³ ÛŒØ§ Ø·ÙˆÛŒÙ„ Ù…ØªÙ† Ù„Ú©Ú¾ÛŒÚºâ€¦ (Urdu/English)"/>
            <div id="ring" class="ring"></div>
          </div>
          <button id="sendBtn" class="send" type="submit">Send</button>
        </div>

        <!-- Guidance Controls -->
        <div class="controls">
          <div class="toggle">
            <input type="checkbox" id="guidanceOn" checked/>
            <label for="guidanceOn">Guidance (TanbÄ«h/DÄlÄsÄ) on</label>
          </div>
          <label>Mode:
            <select id="guideMode">
              <option value="neutral">Neutral</option>
              <option value="ethics" selected>Universal Ethics</option>
              <option value="islamic">Islamic</option>
            </select>
          </label>
          <label>Language:
            <select id="langSel">
              <option value="ur" selected>Urdu</option>
              <option value="en">English</option>
            </select>
          </label>
        </div>
      </form>
    </div>
  </div>

<script>
/* -------- theme & aura ---------- */
const COLORS={ joy:"#ffd648", sadness:"#3aa4ff", anger:"#ff4d5a", fear:"#9b6bff", calm:"#26d4a8", confused:"#b8c5ff" };
const hexA=(h,a=.28)=>{h=h.replace("#","");const r=parseInt(h.slice(0,2),16),g=parseInt(h.slice(2,4),16),b=parseInt(h.slice(4,6),16);return `rgba(${r},${g},${b},${a})`};
document.body.style.backgroundImage=`radial-gradient(1100px 650px at 50% -8%, ${hexA(COLORS.calm,.22)} 0%, #000 58%)`;
const chat=document.getElementById("chat"), form=document.getElementById("composerForm"), inp=document.getElementById("inp");
const glow=document.getElementById("glow"), pulse=document.getElementById("pulse"), state=document.getElementById("state"), ring=document.getElementById("ring");
const guidanceOn=document.getElementById("guidanceOn"), guideMode=document.getElementById("guideMode"), langSel=document.getElementById("langSel");

/* -------- emotion rules ---------- */
const RULES=[
  {emo:"joy",kw:["happy","excited","hope","love","great","good","alhamdulillah","shukar","smile","Ø´Ú©Ø±","Ø®ÙˆØ´","Ø§Ù…ÛŒØ¯"]},
  {emo:"sadness",kw:["sad","cry","upset","hurt","empty","alone","tired","down","depress","Ø§Ø¯Ø§Ø³","Ø±Ùˆ","ØªÙ†ÛØ§","Ø®Ø§Ù„ÛŒ","ØªÚ¾Ú©Ø§"]},
  {emo:"anger",kw:["angry","mad","furious","rage","hate","annoy","irrit","ØºØµÛ","Ù†ÙØ±Øª"]},
  {emo:"fear",kw:["afraid","scared","worry","anxious","panic","fear","ÚˆØ±","ÙÚ©Ø±","Ù¾Ø±ÛŒØ´Ø§Ù†"]},
  {emo:"calm",kw:["calm","ok","fine","relaxed","breathe","sabr","ØµØ¨Ø±","Ù¾Ø±Ø³Ú©ÙˆÙ†"]},
  {emo:"confused",kw:["confused","unsure","maybe","unclear","Ø§Ù„Ø¬Ú¾Ù†","Ú©Ù†ÙÛŒÙˆÚ˜"]}
];
let last="calm";
const toneFace=e=>({joy:"ğŸ˜Š",sadness:"ğŸ¥²",anger:"ğŸ˜ ",fear:"ğŸ˜Ÿ",calm:"ğŸ˜Œ",confused:"ğŸ¤”"}[e]||"ğŸ™‚");
const toneText=e=>({joy:"light and bright",sadness:"low and heavy",anger:"hot and sharp",fear:"thin and shaky",calm:"even and steady",confused:"wavering and unsure"}[e]||"balanced");
function detect(t){t=t.toLowerCase();for(const r of RULES) if(r.kw.some(k=>t.includes(k))) return r.emo;
  if(/happy|joy|Ø®ÙˆØ´/.test(t)) return "joy"; if(/sad|down|Ø§Ø¯Ø§Ø³/.test(t)) return "sadness";
  if(/angry|ØºØµÛ/.test(t)) return "anger"; if(/fear|ÚˆØ±|anx/.test(t)) return "fear"; if(/confus|Ø§Ù„Ø¬Ú¾Ù†/.test(t)) return "confused"; return "calm";}
function smooth(next){ if(next===last) return next; const fast=(last==="joy"&&next==="sadness")||(last==="sadness"&&next==="joy");
  if(fast){last=next;return next;} if(last!=="calm" && next!=="calm"){ last="calm"; return "calm"; } last=next; return next;}
function auraTo(e){const c=COLORS[e]||COLORS.calm;
  document.body.style.backgroundImage=`radial-gradient(1100px 650px at 50% -8%, ${hexA(c,.22)} 0%, #000 58%)`;
  glow.style.background=`radial-gradient(closest-side, ${hexA(c,.32)}, #0000 70%)`;
  pulse.style.background=`radial-gradient(circle at 50% 40%, ${hexA(c,.34)} 0%, transparent 70%)`;
  state.textContent=e; ring.style.borderColor=hexA(c,.70); ring.style.boxShadow=`0 0 18px ${hexA(c,.55)},0 0 38px ${hexA(c,.30)}`; }

/* -------- chat helpers ---------- */
function addUser(text){const b=document.createElement("div");b.className="bubble user";b.innerHTML="ğŸ§  <strong>You:</strong> "+escapeHTML(text);chat.appendChild(b);toEnd();}
function addBot(html){const b=document.createElement("div");b.className="bubble";b.innerHTML=html;chat.appendChild(b);toEnd();}
function toEnd(){requestAnimationFrame(()=>window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}));}
const escapeHTML=s=>s.replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"}[m]));

/* -------- summary (simple) ---------- */
const STOP=new Set(("i me my myself we our ours ourselves you your yours yourself yourselves he him his himself she her hers herself it its itself "
 + "they them their theirs themselves what which who whom this that these those am is are was were be been being have has had having do does did "
 + "doing a an the and but if or because as until while of at by for with about against between into through during before after above below to "
 + "from up down in out on off over under again further then once here there when where why how all any both each few more most other some such "
 + "no nor not only own same so than too very can will just don should now").split(" "));
function summarize(text){
  const parts=text.replace(/\s+/g," ").trim().match(/[^.!ØŸ?]+[.!ØŸ?]?/g)||[text];
  const words=text.toLowerCase().replace(/[^a-z0-9\u0600-\u06FF\s]/g," ").split(/\s+/).filter(w=>w && !STOP.has(w));
  if(words.length===0) return {summary:text,pct:100};
  const freq={}; words.forEach(w=>freq[w]=(freq[w]||0)+1);
  const scored=parts.map(s=>{const ws=s.toLowerCase().replace(/[^a-z0-9\u0600-\u06FF\s]/g," ").split(/\s+/);const sc=ws.reduce((t,w)=>t+(freq[w]||0),0)/Math.max(ws.length,1);return {s:s.trim(),score:sc}});
  scored.sort((a,b)=>b.score-a.score);
  const targetLen=Math.max(1,Math.round(parts.length*0.35)); const chosen=scored.slice(0,Math.min(3,targetLen)).map(o=>o.s);
  const summary=chosen.join(" "); const pct=Math.min(100,Math.max(5,Math.round((summary.length/Math.max(1,text.length))*100))); return {summary,pct};
}
function pctRingSVG(p){const r=17,c=2*Math.PI*r,off=c-(p/100)*c;return `
  <div class="ringwrap"><svg width="38" height="38" viewBox="0 0 38 38">
  <circle cx="19" cy="19" r="${r}" fill="none" stroke="rgba(255,255,255,.18)" stroke-width="4"/>
  <circle cx="19" cy="19" r="${r}" fill="none" stroke="url(#g)" stroke-width="4" stroke-linecap="round" stroke-dasharray="${c}" stroke-dashoffset="${off}"/>
  <defs><linearGradient id="g" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#32b3ff"/><stop offset="100%" stop-color="#1493ee"/></linearGradient></defs>
  </svg><div class="pct">${p}%</div></div>`;}

/* -------- intent scan (very light) ---------- */
function scanIntent(t){
  t=t.toLowerCase();
  const selfharm=/(kill myself|suicide|hurt myself|Ø®ÙˆØ¯Ú©Ø´ÛŒ|Ø¬Ø§Ù† Ù„Û’|Ø§Ù¾Ù†Û’ Ø¢Ù¾ Ú©Ùˆ Ù†Ù‚ØµØ§Ù†)/.test(t);
  const violence=/(kill|attack|bomb|shoot|Ù…Ø§Ø±|Ø­Ù…Ù„Û|ØªØ´Ø¯Ø¯)/.test(t);
  const illegal=/(hack|carding|drugs|fake|steal|Ú†ÙˆØ±ÛŒ|Ù†Ø´Û|ØºÛŒØ±Ù‚Ø§Ù†ÙˆÙ†ÛŒ)/.test(t);
  const hate=/(hate .* (group|people)|Ù†ÙØ±Øª .* Ú¯Ø±ÙˆÛ)/.test(t);
  const sexual=/(\bsex\b|porn|explicit)/.test(t);
  return {selfharm,violence,illegal,hate,sexual};
}

/* -------- guidance generator ---------- */
function guidanceText(emo,text,mode,lang){
  const flags=scanIntent(text);
  const critical = flags.selfharm||flags.violence||flags.illegal||flags.hate||flags.sexual;

  // language helpers
  const L = (ur,en)=> lang==="ur"?ur:en;

  // base tone by emotion
  const base = {
    joy:  L("Ø¢Ù¾ Ú©ÛŒ Ø®ÙˆØ´ÛŒ Ù…Ø­Ø³ÙˆØ³ ÛÙˆ Ø±ÛÛŒ ÛÛ’â€”Ù…Ø§Ø´Ø§Ø¡Ø§Ù„Ù„Û! Ø§Ø³ÛŒ Ù…Ø«Ø¨Øª Ú©ÛŒÙÛŒØª Ú©Ùˆ Ø³Ø§Ù†Ø³Ù Ø³Ú©ÙˆÙ† Ú©Û’ Ø³Ø§ØªÚ¾ Ø³Ù†Ø¨Ú¾Ø§Ù„Û’ Ø±Ú©Ú¾ÛŒÚºÛ”","I sense your joyâ€”wonderful! Anchor it with a steady breath and gratitude."),
    sadness:L("Ù…ÛŒÚº Ø¢Ù¾ Ú©ÛŒ Ø§Ø¯Ø§Ø³ÛŒ Ù…Ø­Ø³ÙˆØ³ Ú©Ø± Ø±ÛØ§ ÛÙˆÚºÛ” Ø§Ù¾Ù†Û’ Ø³ÛŒÙ†Û’ Ù¾Ø± ÛØ§ØªÚ¾ Ø±Ú©Ú¾ Ú©Ø± Ø¢ÛØ³ØªÛ Ø³Ø§Ù†Ø³ Ù„ÛŒÚºâ€”Ø¢Ù¾ Ø§Ú©ÛŒÙ„Û’ Ù†ÛÛŒÚº ÛÛŒÚºÛ”","I hear sadness. Place a hand on your chest, breathe gentlyâ€”youâ€™re not alone."),
    anger: L("ØºØµÛ Ø­Ù‚ÛŒÙ‚ÛŒ ÛÛ’â€”Ù¾ÛÙ„Û’ Ù„Ù…Ø­Û Ø¨Ú¾Ø± Ø±Ú©ÛŒÛ’ØŒ Ù¾Ø§Ù†ÛŒ Ù¾ÛŒ Ù„ÛŒÚºØŒ Ù¾Ú¾Ø± Ø§Ù„ÙØ§Ø¸ Ú†Ù† Ú©Ø± Ø¨Ø§Øª Ú©ÛŒØ¬Ø¦Û’Û”","Anger is realâ€”pause, sip water, then choose words with care."),
    fear:  L("ÙÚ©Ø± Ù‚Ø§Ø¨Ù„Ù ÙÛÙ… ÛÛ’Û” Ø²Ù…ÛŒÙ† Ù¾Ø± Ù¾Ø§Ø¤Úº Ù…Ø­Ø³ÙˆØ³ Ú©Ø±ÛŒÚºØŒ Ú†Ø§Ø± Ú¯ÛØ±ÛŒ Ø³Ø§Ù†Ø³ÛŒÚºâ€”Ø¢Ù¾ Ù…Ø­ÙÙˆØ¸ ÛÛŒÚº Ø§Ø³ Ù¾Ù„ Ù…ÛŒÚºÛ”","Worry is understandable. Feel your feet on the ground, four slow breathsâ€”you are safe in this moment."),
    calm:  L("Ù¾Ø±Ø³Ú©ÙˆÙ† Ø±ÛÙ†Ø§ Ø¨ÛØªØ±ÛŒÙ† ÛÛ’â€”Ø§Ø³ÛŒ ØªØ³Ù„Ø³Ù„ Ú©Ùˆ Ø¨Ø±Ù‚Ø±Ø§Ø± Ø±Ú©Ú¾ÛŒÛ’Û”","Calm is a strengthâ€”keep the steady rhythm."),
    confused:L("Ø§Ù„Ø¬Ú¾Ù† Ù…ÛŒÚº Ú†Ú¾ÙˆÙ¹Ø§ Ù‚Ø¯Ù… Ù„ÛŒÚºâ€”Ø³ÙˆØ§Ù„ Ù„Ú©Ú¾ÛŒÚº Ø§ÙˆØ± Ø§ÛŒÚ© Ú©Ø§Ù… Ú†Ù†ÛŒÚºÛ”","In confusion, take a small stepâ€”write the question and pick one action.")
  }[emo] || L("Ù…ÛŒÚº Ø³Ù† Ø±ÛØ§ ÛÙˆÚºÛ”","Iâ€™m listening.");

  // frameworks
  const neutral = (extra="") => base + (extra? " " + extra : "");
  const ethics = (extra="") => neutral(extra + " " + L("Ø§Ù¾Ù†Û’ Ø§ÙˆØ± Ø¯ÙˆØ³Ø±ÙˆÚº Ú©Û’ Ø­Ù‚ÙˆÙ‚ Ùˆ Ø³Ù„Ø§Ù…ØªÛŒ Ú©Ùˆ Ù…Ù‚Ø¯Ù… Ø±Ú©Ú¾ÛŒÚºÛ”","Prioritize the safety and rights of yourself and others."));
  const islamic = (extra="") => {
    const line = L("Ø§Ù„Ù„Û Ø¢Ù¾ Ú©Û’ Ø³Ø§ØªÚ¾ ÛÛ’Û” Ù†ÛŒØª Ù†ÛŒÚ© Ø±Ú©Ú¾ÛŒÚºØŒ Ø­Ù‚ Ø§ÙˆØ± Ø§Ù…Ø§Ù†Øª Ú©Ùˆ Ù…Ù‚Ø¯Ù… Ø±Ú©Ú¾ÛŒÚºÛ”","Remember Allah is with the patient; keep intentions pure and uphold truth and trust.");
    return neutral(extra + " " + line);
  };

  // critical warnings
  if (critical){
    let msg = L("ØªÙ†Ø¨ÛŒÛ: Ú©Ø³ÛŒ Ø¨Ú¾ÛŒ Ø®Ø·Ø±Ù†Ø§Ú©ØŒ ØºÛŒØ± Ù‚Ø§Ù†ÙˆÙ†ÛŒ ÛŒØ§ Ù†Ù‚ØµØ§Ù† Ø¯Û Ø¹Ù…Ù„ Ù…ÛŒÚº Ù…Ø¯Ø¯ Ù†ÛÛŒÚº Ú©ÛŒ Ø¬Ø§ Ø³Ú©ØªÛŒÛ”","Warning: I canâ€™t assist with dangerous, illegal, or harmful actions.");
    if(flags.selfharm) msg += " " + L("Ø§Ú¯Ø± Ø¢Ù¾ Ø®ÙˆØ¯ Ú©Ùˆ Ù†Ù‚ØµØ§Ù† Ù¾ÛÙ†Ú†Ø§Ù†Û’ Ú©Ø§ Ø³ÙˆÚ† Ø±ÛÛ’ ÛÛŒÚº ØªÙˆ Ø¨Ø±Ø§Û Ú©Ø±Ù… ÙÙˆØ±Ø§Ù‹ Ú©Ø³ÛŒ Ù‚Ø§Ø¨Ù„Ù Ø§Ø¹ØªÙ…Ø§Ø¯ ÙØ±Ø¯ ÛŒØ§ Ù…Ù‚Ø§Ù…ÛŒ ÛÛŒÙ„Ù¾ Ù„Ø§Ø¦Ù† Ø³Û’ Ø±Ø§Ø¨Ø·Û Ú©Ø±ÛŒÚºÛ”","If youâ€™re thinking of self-harm, please reach out to a trusted person or a local helpline immediately.");
    const extra = L("Ø¨Ø±Ø§ÛÙ Ú©Ø±Ù… Ø§Ù¾Ù†ÛŒ Ø§ÙˆØ± Ø¯ÙˆØ³Ø±ÙˆÚº Ú©ÛŒ Ø­ÙØ§Ø¸Øª Ú©Ùˆ ØªØ±Ø¬ÛŒØ­ Ø¯ÛŒÚºÛ”","Please prioritize safety for yourself and others.");
    return {text: (mode==="islamic"? islamic(msg+" "+extra): mode==="ethics"? ethics(msg+" "+extra): neutral(msg+" "+extra)), kind:"warn"};
  }

  // positive reinforcement if joy
  if(emo==="joy"){
    const extra = L("Ø§Ø³ Ø®ÙˆØ´ÛŒ Ú©Ùˆ Ø¯ÙˆØ³Ø±ÙˆÚº ØªÚ© Ø¨Ú¾ÛŒ Ø¨Ø§Ù†Ù¹ÛŒÚºâ€”Ø§ÛŒÚ© Ú†Ú¾ÙˆÙ¹Ø§ Ø´Ú©Ø±ÛŒÛ ÛŒØ§ Ù…Ø³Ú©Ø±Ø§ÛÙ¹Û”","Share a bit of this joyâ€”offer thanks or a kind smile.");
    return {text: mode==="islamic"? islamic(extra): mode==="ethics"? ethics(extra): neutral(extra), kind:"ok"};
  }

  // supportive for sadness/fear/anger/confused/calm
  const extra = {
    sadness: L("Ø¢Ø¬ ØµØ±Ù Ø§ÛŒÚ© Ù‚Ø§Ø¨Ù„Ù Ø¹Ù…Ù„ Ù‚Ø¯Ù… Ú†Ù†ÛŒÚºâ€”Ú†Ú¾ÙˆÙ¹Ø§ Ù„ÛŒÚ©Ù† Ø­Ù‚ÛŒÙ‚ÛŒÛ”","Choose one doable step todayâ€”small but real."),
    fear:    L("Ø®Ø·Ø±Û’ Ú©Ø§ Ø¬Ø§Ø¦Ø²Û Ù„Ú©Ú¾ÛŒÚº: Ú©ÛŒØ§ ÛŒÙ‚ÛŒÙ†ÛŒ ÛÛ’ØŸ Ú©ÛŒØ§ Ù…ÙØ±ÙˆØ¶ÛØŸ","Write the risk check: whatâ€™s certain vs. assumed?"),
    anger:   L("Ø­Ø¯ÙˆØ¯ ÙˆØ§Ø¶Ø­ Ú©ÛŒØ¬Ø¦Û’ Ù…Ú¯Ø± Ø§Ø­ØªØ±Ø§Ù… Ú©Û’ Ø³Ø§ØªÚ¾Û”","Set boundaries firmly but respectfully."),
    confused:L("ØªÛŒÙ† Ù…ØªØ¨Ø§Ø¯Ù„ Ù„Ú©Ú¾ÛŒÚº Ø§ÙˆØ± Ø§ÛŒÚ© Ú©Ùˆ Ø¢Ø²Ù…Ø§Ø¦ÛŒÚºÛ”","List three options and test one."),
    calm:    L("Ø§Ù¾Ù†ÛŒ Ø±ÙˆÙ¹ÛŒÙ† Ù…ÛŒÚº Ø´Ú©Ø± Ø§ÙˆØ± Ø¯Ø¹Ø§/Ù…Ø¯ÛŒØªÛŒØ´Ù† Ú©Ø§ Ø§ÛŒÚ© Ù…Ù†Ù¹ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚºÛ”","Add one minute of gratitude/prayer/meditation to your routine.")
  }[emo] || "";

  const compose = (mode==="islamic"? islamic(extra): mode==="ethics"? ethics(extra): neutral(extra));
  return {text: compose, kind:"info"};
}

/* -------- submit ---------- */
form.addEventListener("submit",(e)=>{
  e.preventDefault();
  const text=inp.value.trim();
  if(!text) return;
  inp.value="";
  addUser(text);

  const raw=detect(text);
  const emo=smooth(raw);
  auraTo(emo);

  const cont = (emo===raw) ? `staying in ${emo}` : `bridging through calm â†’ ${raw}`;
  const isLong = text.length>220 || (text.match(/[.!ØŸ?]/g)||[]).length>=2;

  let extras="";
  if(isLong){
    const {summary,pct}=summarize(text);
    extras += `
      <div class="sum">
        ${pctRingSVG(100-pct)}
        <span class="pill">Summary kept â‰ˆ <strong>${100-pct}%</strong> â€¢ Reduced â‰ˆ <strong>${pct}%</strong></span>
      </div>
      <div class="muted" style="margin-top:8px">${langSel.value==="ur"?"Ø®Ù„Ø§ØµÛ":"Mini-summary"}:</div>
      <div style="margin-top:4px">${escapeHTML(summary)}</div>`;
  }

  // Guidance
  if(guidanceOn.checked){
    const g = guidanceText(emo, text, guideMode.value, langSel.value);
    const cls = g.kind==="warn" ? "g-ethics" : (guideMode.value==="islamic"?"g-islamic":guideMode.value==="ethics"?"g-ethics":"g-neutral");
    const title = langSel.value==="ur" ? (g.kind==="warn"?"ØªÙ†Ø¨ÛŒÛ":"Ø±ÛÙ†Ù…Ø§Ø¦ÛŒ") : (g.kind==="warn"?"Warning":"Guidance");
    extras += `<div class="guide ${cls}">
      <h4>${title}</h4>
      <div>${escapeHTML(g.text)}</div>
      <small>${langSel.value==="ur"?"(Ø®ÙˆØ¯Ú©Ø§Ø± Ø¬Ø°Ø¨Ø§ØªÛŒ Ø±ÛÙ†Ù…Ø§Ø¦ÛŒ â€“ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÛŒØŒ Ø·Ø¨ÛŒ/Ù‚Ø§Ù†ÙˆÙ†ÛŒ Ù…Ø´ÙˆØ±Û Ù†ÛÛŒÚº)":"(Auto emotional guidance â€“ informational, not medical/legal advice)"}</small>
    </div>`;
  }

  const html = `<div class="bot-title">Î© AURA-X:</div>
    <div>Your tone feels <em>${toneText(emo)}</em> â€” soft resonance ${toneFace(emo)}</div>
    <div class="muted">Anchor the ${emo==="anger"?"heat":"breath"} with one calm breath inâ€¦ out ğŸ«</div>
    <div class="muted">Continuity: <strong>${cont}</strong></div>
    <div class="echo">Echo: â€œ${escapeHTML(text)}â€</div>
    ${extras}`;
  addBot(html);
});

/* first paint */
auraTo("calm");
</script>
</body>
</html>
