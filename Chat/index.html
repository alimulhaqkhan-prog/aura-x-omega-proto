<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Œ© ‚Äì Resonance-based Synthetic Emotions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #eef3ff;
      --card-bg: #ffffff;
      --primary: #4f46e5;
      --primary-soft: #eef2ff;
      --accent: #fb7185;
      --accent-2: #a855f7;
      --text-main: #111827;
      --text-soft: #4b5563;
      --radius-lg: 18px;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #f9fbff 0, #e5edff 45%, #dde7ff 100%);
      color: var(--text-main);
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      max-width: 900px;
      margin: 0 auto;
    }

    header.app-header {
      padding: 14px 14px 0;
    }

    .engine-card {
      width: 100%;
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, #ffffff, #f3f5ff);
      padding: 14px 16px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .engine-icon {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #ffffff, #c7d2fe);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
    }

    .engine-meta {
      flex: 1;
    }

    .engine-title {
      font-weight: 700;
      letter-spacing: 0.03em;
      font-size: 16px;
    }

    .engine-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    .engine-status-pill {
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(34, 197, 94, 0.08);
      color: #16a34a;
      font-weight: 500;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.35);
    }

    /* Resonance bar + heart row */
    .top-status {
      padding: 10px 18px 0;
    }

    .resonance-bar-wrap {
      width: 100%;
      background: #e5e7eb;
      border-radius: 999px;
      overflow: hidden;
      height: 10px;
      position: relative;
    }

    .resonance-bar-fill {
      height: 100%;
      width: 50%;
      background: linear-gradient(
        90deg,
        #22c55e 0,
        #facc15 40%,
        #fb923c 65%,
        #f97373 100%
      );
      transition: width 0.4s ease-out;
    }

    .resonance-label-row {
      display: flex;
      justify-content: space-between;
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .heart-row {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 12px;
      margin-bottom: 8px;
      gap: 4px;
    }

    .heart-emoji {
      font-size: 40px;
      animation: pulse-heart 1.2s infinite;
      filter: drop-shadow(0 6px 14px rgba(248, 113, 133, 0.5));
    }

    @keyframes pulse-heart {
      0% {
        transform: scale(1);
      }
      30% {
        transform: scale(1.16);
      }
      55% {
        transform: scale(1.02);
      }
      100% {
        transform: scale(1);
      }
    }

    .time-row {
      font-size: 11px;
      color: var(--text-soft);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .time-row span + span::before {
      content: "‚Ä¢";
      margin-right: 8px;
      opacity: 0.5;
    }

    /* Main chat area */
    .main-region {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0 10px 6px;
      gap: 6px;
    }

    .chat-card {
      background: #ffffff;
      border-radius: 22px;
      box-shadow: 0 15px 40px rgba(15, 23, 42, 0.08);
      padding: 12px 12px 6px;
      display: flex;
      flex-direction: column;
      height: 100%;
      max-height: min(560px, calc(100vh - 270px));
    }

    .chat-scroll {
      flex: 1;
      overflow-y: auto;
      padding: 4px 2px 4px;
      scrollbar-width: thin;
      scrollbar-color: #c7d2fe transparent;
    }

    .chat-scroll::-webkit-scrollbar {
      width: 6px;
    }

    .chat-scroll::-webkit-scrollbar-track {
      background: transparent;
    }

    .chat-scroll::-webkit-scrollbar-thumb {
      background-color: #c7d2fe;
      border-radius: 999px;
    }

    .system-intro {
      background: #eef2ff;
      border-radius: 16px;
      padding: 10px 11px;
      font-size: 12px;
      color: var(--text-soft);
      margin-bottom: 8px;
    }

    .message-row {
      max-width: 90%;
      margin-bottom: 6px;
      display: flex;
    }

    .message-row.user {
      margin-left: auto;
      justify-content: flex-end;
    }

    .bubble {
      padding: 8px 11px;
      border-radius: 14px;
      font-size: 13px;
      line-height: 1.35;
      word-wrap: break-word;
      white-space: pre-wrap;
    }

    .bubble.user {
      background: linear-gradient(135deg, #60a5fa, #4f46e5);
      color: #ffffff;
      border-bottom-right-radius: 4px;
    }

    .bubble.bot {
      background: #f3f4ff;
      color: #111827;
      border-bottom-left-radius: 4px;
    }

    .bubble.faith {
      background: #fff7ed;
      color: #9a3412;
      font-size: 12px;
      border-radius: 12px;
      border-left: 3px solid #fb923c;
    }

    .message-meta {
      font-size: 10px;
      color: #9ca3af;
      margin-top: 2px;
    }

    /* Input panel */
    .input-panel {
      padding: 4px 10px 10px;
      position: sticky;
      bottom: 0;
      background: linear-gradient(to top, rgba(238, 242, 255, 0.98), transparent);
    }

    .input-row-main {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }

    .belief-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: none;
      outline: none;
      padding: 6px 10px;
      border-radius: 999px;
      background: linear-gradient(120deg, #f5f2ff, #eaf0ff);
      box-shadow: 0 2px 8px rgba(46, 71, 255, 0.15);
      font-size: 11px;
      color: #2f365f;
      cursor: pointer;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .belief-pill-icon {
      font-size: 14px;
    }

    .chat-input {
      flex: 1;
      min-width: 0;
      border-radius: 999px;
      border: none;
      padding: 9px 12px;
      font-size: 13px;
      background: #ffffff;
      box-shadow: 0 2px 8px rgba(15, 23, 42, 0.08);
      outline: none;
    }

    .send-button {
      border-radius: 999px;
      border: none;
      padding: 9px 15px;
      font-size: 13px;
      font-weight: 600;
      background: linear-gradient(135deg, #ff5fa2, #a855f7);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(248, 113, 133, 0.45);
      flex-shrink: 0;
    }

    .input-row-secondary {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      padding: 0 2px;
    }

    .chip-toggle {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 11px;
      color: #4b5563;
      background: #eef2ff;
      border-radius: 999px;
      padding: 4px 9px;
    }

    .chip-toggle input {
      margin: 0;
      accent-color: var(--primary);
    }

    .model-select {
      font-size: 11px;
      border-radius: 999px;
      padding: 4px 9px;
      border: none;
      background: #f9fafb;
      color: #374151;
      box-shadow: 0 0 0 1px #e5e7eb inset;
    }

    /* Belief bottom sheet */
    .belief-sheet-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.25);
      display: none;
      align-items: flex-end;
      justify-content: center;
      z-index: 999;
    }

    .belief-sheet-backdrop.open {
      display: flex;
    }

    .belief-sheet {
      width: 100%;
      max-width: 480px;
      background: #ffffff;
      border-radius: 16px 16px 0 0;
      padding: 16px 18px 20px;
      box-shadow: 0 -8px 30px rgba(15, 23, 42, 0.25);
    }

    .belief-sheet-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .belief-sheet-title {
      font-weight: 600;
      font-size: 15px;
    }

    .belief-sheet-close {
      border: none;
      font-size: 13px;
      color: #6b7280;
      background: #f3f4f6;
      border-radius: 999px;
      padding: 4px 10px;
      cursor: pointer;
    }

    .belief-switch-row {
      margin-top: 4px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      font-size: 13px;
    }

    .belief-sheet-subtitle {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 8px;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      inset: 0;
      background-color: #e5e7eb;
      border-radius: 999px;
      transition: 0.25s;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      border-radius: 50%;
      transition: 0.25s;
    }

    .switch input:checked + .slider {
      background-color: #22c55e;
    }

    .switch input:checked + .slider:before {
      transform: translateX(18px);
    }

    .belief-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-top: 4px;
    }

    .belief-grid button {
      border-radius: 999px;
      border: none;
      padding: 6px 8px;
      font-size: 12px;
      background: #f3f4ff;
      color: #374151;
      cursor: pointer;
    }

    .belief-grid button.active {
      background: linear-gradient(130deg, #4f46e5, #a855f7);
      color: #ffffff;
      box-shadow: 0 2px 8px rgba(79, 70, 229, 0.4);
    }

    @media (min-width: 768px) {
      .engine-card {
        padding: 14px 18px;
      }
      .chat-card {
        max-height: min(600px, calc(100vh - 260px));
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="engine-card">
        <div class="engine-icon">Œ©</div>
        <div class="engine-meta">
          <div class="engine-title">AURA-X Œ©</div>
          <div class="engine-sub">
            Resonance-based synthetic emotions. World‚Äôs first continuity-driven
            emotional reactor chat.
          </div>
        </div>
        <div class="engine-status-pill">
          <span class="status-dot"></span>
          <span>Continuity engine live</span>
        </div>
      </div>
    </header>

    <section class="top-status">
      <div class="resonance-bar-wrap">
        <div class="resonance-bar-fill" id="resonance-bar"></div>
      </div>
      <div class="resonance-label-row">
        <span>Emotional resonance: <span id="resonance-label">50%</span></span>
        <span id="resonance-temp-label">Warm</span>
      </div>

      <div class="heart-row">
        <div class="heart-emoji" aria-hidden="true">üíï</div>
        <div class="time-row" id="time-row">
          <span id="time-text">Thu, 00:00</span>
          <span id="temp-text">-- ¬∞C</span>
        </div>
      </div>
    </section>

    <main class="main-region">
      <div class="chat-card">
        <div class="chat-scroll" id="chat-scroll">
          <div class="system-intro" id="intro-block">
            As-salaam alaikum, I am <strong>AURA-X Œ©</strong> ‚Äî a resonance-based
            synthetic emotion engine.<br /><br />
            You can talk to me in English or Urdu. I will try to reply with logic,
            kindness and emotional balance.
          </div>
          <div id="messages"></div>
        </div>
      </div>
    </main>

    <footer class="input-panel">
      <div class="input-row-main">
        <button class="belief-pill" id="belief-pill" type="button">
          <span class="belief-pill-icon">‚ö°Ô∏è</span>
          <span class="belief-pill-label" id="belief-pill-label">
            Belief: Auto (Islam)
          </span>
        </button>
        <input
          id="user-input"
          class="chat-input"
          placeholder="Type your thoughts or feelings‚Ä¶"
        />
        <button id="send-button" class="send-button" type="button">Send</button>
      </div>

      <div class="input-row-secondary">
        <label class="chip-toggle">
          <input type="checkbox" id="voice-reaction-toggle" checked />
          <span>Voice reaction</span>
        </label>

        <label class="chip-toggle">
          <input type="checkbox" id="faith-on-toggle-inline" checked />
          <span>Faith ON</span>
        </label>

        <select id="model-select" class="model-select">
          <option value="qwen/qwen-2.5-7b-instruct">Qwen Mini</option>
          <option value="openai/gpt-4o-mini">GPT-4o mini</option>
        </select>
      </div>
    </footer>
  </div>

  <!-- Belief Settings Sheet -->
  <div class="belief-sheet-backdrop" id="belief-sheet-backdrop">
    <div class="belief-sheet" role="dialog" aria-modal="true">
      <div class="belief-sheet-header">
        <span class="belief-sheet-title">Belief settings</span>
        <button class="belief-sheet-close" id="belief-sheet-close">Close</button>
      </div>

      <label class="belief-switch-row">
        <span>
          <strong>Faith ON</strong> ‚Äî add short encouragements (optional)
        </span>
        <label class="switch">
          <input type="checkbox" id="faith-on-toggle" checked />
          <span class="slider"></span>
        </label>
      </label>

      <p class="belief-sheet-subtitle">
        Pick your faith (used only to tailor optional verses/quotes in replies ‚Äî
        nothing is sent to servers):
      </p>

      <div class="belief-grid" id="belief-grid">
        <button type="button" data-faith="Islam">Islam</button>
        <button type="button" data-faith="Christianity">Christianity</button>
        <button type="button" data-faith="Hinduism">Hinduism</button>
        <button type="button" data-faith="Buddhism">Buddhism</button>
        <button type="button" data-faith="Sikhism">Sikhism</button>
        <button type="button" data-faith="Judaism">Judaism</button>
        <button type="button" data-faith="Bah√°'√≠">Bah√°'√≠</button>
        <button type="button" data-faith="Jainism">Jainism</button>
        <button type="button" data-faith="Atheism">Atheism</button>
        <button type="button" data-faith="Other">Other</button>
      </div>
    </div>
  </div>

  <script>
    // ========== BASIC STATE ==========

    const API_KEY = "YOUR_OPENROUTER_API_KEY_HERE"; // <-- yahan apni key lagani hai
    const OPENROUTER_URL = "https://openrouter.ai/api/v1/chat/completions";

    const beliefConfig = {
      enabled: true,
      selectedFaiths: ["Islam"],
    };

    let E0 = 0.5; // emotional resonance (0‚Äì1)

    const messagesEl = document.getElementById("messages");
    const chatScrollEl = document.getElementById("chat-scroll");
    const userInput = document.getElementById("user-input");
    const sendButton = document.getElementById("send-button");
    const modelSelect = document.getElementById("model-select");
    const voiceToggle = document.getElementById("voice-reaction-toggle");

    const beliefPill = document.getElementById("belief-pill");
    const beliefPillLabel = document.getElementById("belief-pill-label");
    const beliefSheetBackdrop = document.getElementById(
      "belief-sheet-backdrop"
    );
    const beliefSheetClose = document.getElementById("belief-sheet-close");
    const faithOnToggle = document.getElementById("faith-on-toggle");
    const faithOnToggleInline = document.getElementById(
      "faith-on-toggle-inline"
    );
    const beliefGrid = document.getElementById("belief-grid");
    const resonanceBar = document.getElementById("resonance-bar");
    const resonanceLabel = document.getElementById("resonance-label");
    const resonanceTempLabel = document.getElementById("resonance-temp-label");
    const timeText = document.getElementById("time-text");
    const tempText = document.getElementById("temp-text");

    // ========== UI HELPERS ==========

    function clamp01(x) {
      return Math.max(0, Math.min(1, x));
    }

    function updateResonanceUI() {
      const pct = Math.round(E0 * 100);
      resonanceBar.style.width = pct + "%";
      resonanceLabel.textContent = pct + "%";

      let label = "Cool";
      if (pct >= 70) label = "Warm";
      if (pct >= 90) label = "Intense";
      resonanceTempLabel.textContent = label;
    }

    function updateTimeUI() {
      const now = new Date();
      const day = now.toLocaleDateString(undefined, {
        weekday: "short",
        day: "2-digit",
        month: "short",
      });
      const time = now.toLocaleTimeString(undefined, {
        hour: "2-digit",
        minute: "2-digit",
      });
      timeText.textContent = day + ", " + time;
      tempText.textContent = "-- ¬∞C";
    }

    function scrollToBottom() {
      requestAnimationFrame(() => {
        chatScrollEl.scrollTop = chatScrollEl.scrollHeight;
      });
    }

    function appendMessage(role, text, opts = {}) {
      if (!text) return;

      const row = document.createElement("div");
      row.className =
        "message-row " + (role === "user" ? "user" : "bot");

      const bubble = document.createElement("div");
      bubble.className = "bubble " + (role === "user" ? "user" : "bot");
      bubble.textContent = text;
      row.appendChild(bubble);

      messagesEl.appendChild(row);

      if (opts.faithSuggestion) {
        const rowFaith = document.createElement("div");
        rowFaith.className = "message-row bot";
        const faithBubble = document.createElement("div");
        faithBubble.className = "bubble faith";
        faithBubble.textContent = opts.faithSuggestion;
        rowFaith.appendChild(faithBubble);
        messagesEl.appendChild(rowFaith);
      }

      scrollToBottom();
    }

    // ========== BELIEF SHEET LOGIC ==========

    function updateBeliefPill() {
      const onOff = beliefConfig.enabled ? "Auto" : "Off";
      const faith =
        beliefConfig.selectedFaiths.length === 0
          ? "None"
          : beliefConfig.selectedFaiths[0];
      beliefPillLabel.textContent = `Belief: ${onOff} (${faith})`;

      if (faithOnToggleInline) {
        faithOnToggleInline.checked = beliefConfig.enabled;
      }
      if (faithOnToggle) {
        faithOnToggle.checked = beliefConfig.enabled;
      }

      if (beliefGrid) {
        beliefGrid.querySelectorAll("button").forEach((btn) => {
          const f = btn.getAttribute("data-faith");
          btn.classList.toggle(
            "active",
            beliefConfig.selectedFaiths.includes(f)
          );
        });
      }
    }

    if (beliefPill && beliefSheetBackdrop) {
      beliefPill.addEventListener("click", () => {
        beliefSheetBackdrop.classList.add("open");
      });

      beliefSheetBackdrop.addEventListener("click", (e) => {
        if (e.target === beliefSheetBackdrop) {
          beliefSheetBackdrop.classList.remove("open");
        }
      });
    }

    if (beliefSheetClose) {
      beliefSheetClose.addEventListener("click", () => {
        beliefSheetBackdrop.classList.remove("open");
      });
    }

    if (faithOnToggle) {
      faithOnToggle.addEventListener("change", () => {
        beliefConfig.enabled = faithOnToggle.checked;
        updateBeliefPill();
      });
    }

    if (faithOnToggleInline) {
      faithOnToggleInline.addEventListener("change", () => {
        beliefConfig.enabled = faithOnToggleInline.checked;
        updateBeliefPill();
      });
    }

    if (beliefGrid) {
      beliefGrid.addEventListener("click", (e) => {
        const btn = e.target.closest("button[data-faith]");
        if (!btn) return;
        const faith = btn.getAttribute("data-faith");

        if (beliefConfig.selectedFaiths.includes(faith)) {
          beliefConfig.selectedFaiths = beliefConfig.selectedFaiths.filter(
            (f) => f !== faith
          );
        } else {
          beliefConfig.selectedFaiths.push(faith);
        }
        updateBeliefPill();
      });
    }

    updateBeliefPill();

    // ========== FAITH SUGGESTIONS ==========

    function getFaithSuggestion() {
      if (!beliefConfig.enabled || beliefConfig.selectedFaiths.length === 0)
        return null;

      const faith = beliefConfig.selectedFaiths[0];

      if (faith === "Islam") {
        const options = [
          "ÿßŸêŸÜŸí ÿ¥ÿßÿ°Ÿé ÿßŸÑŸÑŸá ÿ®€Åÿ™ÿ± €ÅŸà⁄Øÿß ‚Äì ‚Äúÿ•ŸêŸÜŸëŸé ÿßŸÑŸÑŸëŸ∞ŸáŸé ŸÖŸéÿπŸé ÿßŸÑÿµŸëŸéÿßÿ®Ÿêÿ±Ÿê€åŸÜŸé‚Äù (ÿ®€åÿ¥⁄© ÿßŸÑŸÑ€Å ÿµÿ®ÿ± ⁄©ÿ±ŸÜ€í ŸàÿßŸÑŸà⁄∫ ⁄©€í ÿ≥ÿßÿ™⁄æ €Å€í€î)",
          "ÿßŸÑŸÑ€Å ÿ¢Ÿæ ⁄©€í ÿØŸÑ ⁄©Ÿà ÿ≥⁄©ŸàŸÜ ÿØ€íÿå ‚ÄúÿßŸéŸÑŸéÿß ÿ®Ÿêÿ∞Ÿê⁄©Ÿíÿ±Ÿê ÿßŸÑŸÑŸëŸ∞€ÅŸê ÿ™Ÿéÿ∑ŸíŸÖŸéÿ¶ŸêŸÜŸëŸè ÿßŸÑŸíŸÇŸèŸÑŸèŸàŸíÿ®Ÿè‚Äù.",
          "ŸÖÿß€åŸàÿ≥ ŸÖÿ™ €ÅŸà⁄∫ÿå €Åÿ± ŸÖÿ¥⁄©ŸÑ ⁄©€í ÿ≥ÿßÿ™⁄æ ÿ¢ÿ≥ÿßŸÜ€å €Å€í ‚Äì ‚ÄúŸÅŸéÿ•ŸêŸÜŸëŸé ŸÖŸéÿπŸé ÿßŸÑŸíÿπŸèÿ≥Ÿíÿ±Ÿê €åŸèÿ≥Ÿíÿ±Ÿãÿß‚Äù.",
        ];
        return options[Math.floor(Math.random() * options.length)];
      }

      if (faith === "Christianity") {
        const options = [
          "Take heart ‚Äì ‚ÄúThe Lord is close to the brokenhearted.‚Äù",
          "May you feel God‚Äôs peace with you right now.",
        ];
        return options[Math.floor(Math.random() * options.length)];
      }

      // Generic for others
      const generic = [
        "I hope you find strength and peace in what you believe.",
        "May you feel supported, whatever your path or beliefs.",
      ];
      return generic[Math.floor(Math.random() * generic.length)];
    }

    // ========== LOCAL BASIC REPLIES (no API cost) ==========

    const basicPatterns = [
      {
        test: /^(hi|hello|hey|salam|salaam|assalam|as-?salaam)/i,
        reply:
          "Wa alaikum assalaam! üòä Main AURA-X Œ© hoon. Aap kaise €Å€å⁄∫ÿü",
      },
      {
        test: /how are you|kese ho|kya haal/i,
        reply:
          "Main algorithmically theek hoon üòÑ Aap batayein, ÿØŸÑ ÿßŸàÿ± ÿØŸÖÿßÿ∫ ⁄©ÿß ÿ≠ÿßŸÑ ⁄©€åÿ≥ÿß €Å€íÿü",
      },
      {
        test: /where are you from|kahan se ho/i,
        reply:
          "Main cloud aur algorithms ki ÿØŸÜ€åÿß ÿ≥€í hoonÿå lekin mere ÿ¨ÿ∞ÿ®ÿßÿ™ ⁄©ÿß ŸÖÿß⁄àŸÑ Timergara ke aik ÿØŸàÿ≥ÿ™ ⁄©€í ÿ≥ÿßÿ™⁄æ train hua €Å€í€î üòâ",
      },
      {
        test: /who are you|tum kon ho|what are you/i,
        reply:
          "Main AURA-X Œ© hoon ‚Äì ek resonance-based synthetic emotion engine jo aap ki ÿ®ÿßÿ™Ÿà⁄∫ ka emotional continuity track karta hai.",
      },
      {
        test: /thank(s| you)|shukriya|ÿ¨ÿ≤ÿß⁄©/i,
        reply:
          "Aap ka ÿ®⁄æ€å shukriya ü§ç Agar aap chaahein ÿ™Ÿà main aur detail se ÿ®⁄æ€å guide kar sakta hoon€î",
      },
    ];

    function tryLocalReply(text) {
      for (const p of basicPatterns) {
        if (p.test(text)) return p.reply;
      }
      return null;
    }

    // ========== EMOTION SHIFT ESTIMATE ==========

    function estimateEmotionShift(text) {
      const t = text.toLowerCase();
      let shift = 0;
      if (/(love|alhamdulillah|shukar|shukr|happy|grateful|ÿÆŸàÿ¥)/.test(t))
        shift += 0.12;
      if (/(sad|depressed|tired|thak|ŸÜÿß ÿßŸÖ€åÿØ|⁄àÿ±ÿß €ÅŸàÿß)/.test(t)) shift -= 0.12;
      if (/(angry|ghussa|ÿ∫ÿµ€Å)/.test(t)) shift -= 0.1;
      if (/(hope|umeed|ÿßŸÖ€åÿØ)/.test(t)) shift += 0.06;
      return shift;
    }

    // ========== VOICE REACTION (BROWSER TTS) ==========

    function speakText(text) {
      if (!voiceToggle.checked) return;
      if (!("speechSynthesis" in window)) return;
      if (!text) return;

      const utter = new SpeechSynthesisUtterance(text);
      // Try Urdu first, then default
      const voices = window.speechSynthesis.getVoices();
      const urduVoice =
        voices.find((v) => /ur/i.test(v.lang)) ||
        voices.find((v) => /en/i.test(v.lang));
      if (urduVoice) utter.voice = urduVoice;
      utter.rate = 1;
      utter.pitch = 1;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    }

    // ========== OPENROUTER CALL ==========

    async function askModel(prompt, history) {
      if (!API_KEY || API_KEY.includes("YOUR_OPENROUTER_API_KEY_HERE")) {
        return {
          reply:
            "Filhaal demo mode mein hoon is liye asal model se connect nahi ho pa rahaÿå lekin main aap ki baat ŸæŸàÿ±€å ÿ™Ÿàÿ¨€Å se ÿ≥ŸÜ ÿ±€Åÿß hoon.",
          demo: true,
        };
      }

      const messagesPayload = [
        {
          role: "system",
          content:
            "You are AURA-X Œ©, a gentle resonance-based synthetic emotion engine. Reply briefly (3‚Äì5 lines), in the same language as user (Urdu or English). Your style is warm, logical, spiritually respectful but neutral to any specific sect. Never claim to be human.",
        },
        ...history,
        { role: "user", content: prompt },
      ];

      try {
        const res = await fetch(OPENROUTER_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${API_KEY}`,
            "HTTP-Referer": window.location.origin,
            "X-Title": "AURA-X Omega Prototype",
          },
          body: JSON.stringify({
            model: modelSelect.value,
            messages: messagesPayload,
          }),
        });

        if (!res.ok) {
          console.error("OpenRouter error", await res.text());
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const reply =
          data.choices?.[0]?.message?.content?.trim() ||
          "Model se jawaan aane mein ŸÖÿ¥⁄©ŸÑ ho gayiÿå lekin main aap ki ÿ®ÿßÿ™ samajh raha hoon.";
        return { reply, demo: false };
      } catch (err) {
        console.error(err);
        return {
          reply:
            "Network ya API issue ki wajah se abhi live ÿ¨Ÿàÿßÿ® ŸÜ€Å€å⁄∫ ÿ¢ ÿ≥⁄©ÿß€î Filhaal main demo mode mein aap ka ÿ≥ÿßÿ™⁄æ hoon.",
          demo: true,
        };
      }
    }

    const convoHistory = [];

    // ========== SEND HANDLER ==========

    async function handleSend() {
      const text = userInput.value.trim();
      if (!text) return;

      appendMessage("user", text);
      userInput.value = "";
      userInput.focus();
      sendButton.disabled = true;

      // Update emotional continuity
      const shift = estimateEmotionShift(text);
      E0 = clamp01(E0 + shift);
      updateResonanceUI();

      // Decide local vs model
      const local = tryLocalReply(text);

      let mainReply;
      let demoMode = false;

      if (local) {
        mainReply = local;
      } else {
        const { reply, demo } = await askModel(text, convoHistory);
        mainReply = reply;
        demoMode = demo;
      }

      convoHistory.push({ role: "user", content: text });
      convoHistory.push({ role: "assistant", content: mainReply });

      const faithSuggestion = getFaithSuggestion();

      appendMessage("bot", mainReply, {
        faithSuggestion,
      });

      if (!demoMode) {
        speakText(mainReply);
      }

      sendButton.disabled = false;
    }

    sendButton.addEventListener("click", handleSend);
    userInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        handleSend();
      }
    });

    // ========== INIT ==========

    updateResonanceUI();
    updateTimeUI();
    setInterval(updateTimeUI, 60_000);
  </script>
</body>
</html>
