<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Î© v1 â€“ Emotional Continuity Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617 0, #020617 40%, #000 100%);
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app {
      width: 100%;
      max-width: 980px;
      height: 100vh;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* HEADER */
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .title-main {
      font-size: 1.4rem;
      font-weight: 700;
      letter-spacing: 0.04em;
    }
    .title-sub {
      font-size: 0.72rem;
      opacity: 0.7;
    }

    .mode-pill {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-end;
      gap: 3px;
    }
    .pill {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 0.7rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.8);
    }
    .pill.offline { color: #f97316; }
    .pill.online { color: #4ade80; }
    .pill span.label {
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.08em;
    }
    .pill span.badge {
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(234, 179, 8, 0.15);
      color: #facc15;
      font-size: 0.7rem;
    }

    .menu-btn {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .menu-btn span {
      width: 16px;
      height: 2px;
      background: #e5e7eb;
      position: relative;
      border-radius: 999px;
    }
    .menu-btn span::before,
    .menu-btn span::after {
      content: "";
      position: absolute;
      left: 0;
      width: 16px;
      height: 2px;
      background: #e5e7eb;
      border-radius: 999px;
    }
    .menu-btn span::before { top: -5px; }
    .menu-btn span::after { top: 5px; }

    /* METRICS GRID */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
    }
    @media (max-width: 720px) {
      .metrics-grid {
        grid-template-columns: repeat(2, minmax(0,1fr));
      }
    }
    @media (max-width: 540px) {
      .metrics-grid {
        grid-template-columns: repeat(2, minmax(0,1fr));
      }
    }

    .metric-card {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 14px;
      padding: 8px 9px 7px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-height: 56px;
    }
    .metric-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      opacity: 0.8;
    }
    .metric-main {
      font-size: 0.7rem;
      opacity: 0.8;
    }
    .metric-sub {
      font-size: 0.68rem;
      opacity: 0.7;
    }
    .meter-bar {
      width: 100%;
      height: 5px;
      border-radius: 999px;
      background: rgba(30, 64, 175, 0.35);
      overflow: hidden;
    }
    .meter-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, #fb923c, #22c55e);
      width: 50%;
      transition: width 0.3s ease-out;
    }

    /* ETHICS BANNER */
    .ethics-banner {
      margin-top: 4px;
      background: rgba(202, 138, 4, 0.12);
      border-radius: 16px;
      padding: 10px 12px;
      border: 1px solid rgba(250, 204, 21, 0.5);
      font-size: 0.72rem;
      line-height: 1.3;
      color: #fde68a;
    }

    /* EQUATION BOX */
    .equation-box {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 16px;
      padding: 10px 12px;
      border: 1px dashed rgba(148, 163, 184, 0.55);
      font-size: 0.7rem;
      line-height: 1.35;
      white-space: pre-line;
    }
    .equation-title {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 4px;
      opacity: 0.8;
    }

    /* CHAT */
    .chat-shell {
      flex: 1;
      min-height: 0;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      padding: 6px 8px 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      overflow: hidden;
    }
    .chat-log {
      flex: 1;
      overflow-y: auto;
      padding: 4px 2px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .msg-row {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 2px;
    }
    .msg-row.user {
      align-items: flex-end;
    }

    .bubble {
      max-width: 90%;
      border-radius: 16px;
      padding: 8px 10px;
      font-size: 0.78rem;
      line-height: 1.35;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
    }
    .bubble.bot {
      background: linear-gradient(135deg, #0f172a, #020617);
      border: 1px solid rgba(148, 163, 184, 0.5);
      align-self: flex-start;
    }
    .bubble.user {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      font-weight: 600;
      align-self: flex-end;
    }

    .seed-meta {
      font-size: 0.64rem;
      opacity: 0.65;
    }

    .chat-input-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
    }
    .chat-input {
      flex: 1;
      border-radius: 999px;
      padding: 8px 12px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-size: 0.78rem;
      outline: none;
    }
    .chat-input::placeholder {
      color: rgba(148, 163, 184, 0.8);
    }
    .send-btn {
      border-radius: 999px;
      padding: 8px 16px;
      border: none;
      cursor: pointer;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      font-size: 0.8rem;
      font-weight: 700;
      box-shadow: 0 0 15px rgba(34, 197, 94, 0.45);
    }

    .footer {
      font-size: 0.67rem;
      opacity: 0.7;
      display: flex;
      justify-content: space-between;
      gap: 6px;
      flex-wrap: wrap;
      padding: 0 4px 2px;
    }

    /* MENU PANEL */
    .menu-panel {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.78);
      backdrop-filter: blur(10px);
      display: none;
      justify-content: center;
      align-items: flex-end;
      padding: 12px;
      z-index: 40;
    }
    .menu-panel.open { display: flex; }
    .menu-card {
      width: 100%;
      max-width: 480px;
      background: #020617;
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 14px 14px 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .menu-head {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .menu-title {
      font-size: 0.9rem;
      font-weight: 600;
    }
    .menu-close {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: transparent;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 0.76rem;
    }

    .menu-section-title {
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      opacity: 0.7;
      margin-bottom: 4px;
    }
    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .chip {
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 0.68rem;
      cursor: pointer;
      opacity: 0.8;
    }
    .chip.active {
      background: rgba(34, 197, 94, 0.16);
      border-color: #4ade80;
      color: #bbf7d0;
      opacity: 1;
    }

    .toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
      font-size: 0.72rem;
    }
    .toggle-label {
      max-width: 75%;
      opacity: 0.85;
    }
    .toggle-button {
      width: 42px;
      height: 20px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
      padding: 2px;
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    .toggle-thumb {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: #64748b;
      transition: transform 0.2s ease-out, background 0.2s;
    }
    .toggle-on .toggle-thumb {
      transform: translateX(20px);
      background: #22c55e;
    }

    .engine-status {
      font-size: 0.68rem;
      opacity: 0.8;
    }

    .llm-list {
      font-size: 0.7rem;
      background: rgba(15,23,42,0.96);
      border-radius: 14px;
      padding: 8px 9px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      display: none;
      flex-direction: column;
      gap: 4px;
    }
    .llm-list.open { display: flex; }
    .llm-list ul {
      padding-left: 16px;
    }
    .llm-btn {
      margin-top: 4px;
      font-size: 0.7rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 5px 9px;
      background: transparent;
      color: #e5e7eb;
      cursor: pointer;
      align-self: flex-start;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="title-block">
        <div class="title-main">AURA-X Î© v1</div>
        <div class="title-sub">
          EMOTIONAL CONTINUITY ASSISTANT Â· AEC Â· CRM Â· AECN Â· RLÂ³ Â· LRÂ³
        </div>
      </div>
      <div class="mode-pill">
        <div id="mode-pill" class="pill offline">
          <span class="label">Mode: Offline</span>
          <span class="badge" id="ethics-label">Universal Ethics</span>
        </div>
        <div class="pill" style="justify-content:flex-end;font-size:0.68rem;">
          Engine: <span id="engine-label-text">Seed Â· Reactor-demo</span>
        </div>
      </div>
      <button class="menu-btn" id="menu-btn" aria-label="Open options">
        <span></span>
      </button>
    </header>

    <!-- Metrics -->
    <section class="metrics-grid">
      <div class="metric-card">
        <div class="metric-title-row">
          <span>Eâ‚€</span>
          <span class="metric-sub">Core emotional output</span>
        </div>
        <div class="metric-main">Eâ‚€ = <span id="metric-e0">0.30</span></div>
        <div class="meter-bar"><div id="bar-e0" class="meter-fill"></div></div>
      </div>

      <div class="metric-card">
        <div class="metric-title-row">
          <span>AECN</span>
          <span class="metric-sub">Normalized continuity (0â€“1)</span>
        </div>
        <div class="metric-main" id="metric-aecn">0.65</div>
        <div class="meter-bar"><div id="bar-aecn" class="meter-fill"></div></div>
      </div>

      <div class="metric-card">
        <div class="metric-title-row">
          <span>Res</span>
          <span class="metric-sub">Resonance stability</span>
        </div>
        <div class="metric-main" id="metric-res">0.69</div>
        <div class="meter-bar"><div id="bar-res" class="meter-fill"></div></div>
      </div>

      <div class="metric-card">
        <div class="metric-title-row">
          <span>TM</span>
          <span class="metric-sub">Trust memory</span>
        </div>
        <div class="metric-main" id="metric-tm">0.35</div>
        <div class="meter-bar"><div id="bar-tm" class="meter-fill"></div></div>
      </div>

      <div class="metric-card">
        <div class="metric-title-row">
          <span>BM</span>
          <span class="metric-sub">Baseline mood</span>
        </div>
        <div class="metric-main" id="metric-bm">0.50</div>
        <div class="meter-bar"><div id="bar-bm" class="meter-fill"></div></div>
      </div>

      <div class="metric-card">
        <div class="metric-title-row">
          <span>D</span>
          <span class="metric-sub">Disturbance</span>
        </div>
        <div class="metric-main" id="metric-d">0.00</div>
        <div class="meter-bar"><div id="bar-d" class="meter-fill"></div></div>
      </div>

      <div class="metric-card">
        <div class="metric-title-row">
          <span>Î£Câ‚œ</span>
          <span class="metric-sub">Continuity line sum</span>
        </div>
        <div class="metric-main" id="metric-cont">0.12</div>
        <div class="meter-bar"><div id="bar-cont" class="meter-fill"></div></div>
      </div>

      <div class="metric-card">
        <div class="metric-title-row">
          <span>RLÂ³</span>
          <span class="metric-sub">Recent line resonance</span>
        </div>
        <div class="metric-main" id="metric-rl3">0.55</div>
        <div class="meter-bar"><div id="bar-rl3" class="meter-fill"></div></div>
      </div>

      <div class="metric-card">
        <div class="metric-title-row">
          <span>LRÂ³</span>
          <span class="metric-sub">Long-run resonance</span>
        </div>
        <div class="metric-main" id="metric-lr3">0.55</div>
        <div class="meter-bar"><div id="bar-lr3" class="meter-fill"></div></div>
      </div>
    </section>

    <!-- Ethics -->
    <section class="ethics-banner" id="ethics-banner">
      Avoid actions that generate negative emotions in yourself or others.
      Gently move toward choices that create calm, kindness, and positive feelings.
    </section>

    <!-- Equation -->
    <section class="equation-box">
      <div class="equation-title">EMOTIONAL CONTINUITY EQUATION</div>
      <div id="equation-lines">
Eâ‚€ = tanh((TM Ã— BM) âˆ’ D + Î»_faith + Î»_sys + Î£Câ‚œ)
Eâ‚€ = 0.30 Â· TM = 0.35 Â· BM = 0.50 Â· D = 0.00 Â· Î£Câ‚œ = 0.12 Â· Î»_faith = 0.00 Â· Î»_sys = 0.02
      </div>
    </section>

    <!-- Chat -->
    <section class="chat-shell">
      <div id="chat-log" class="chat-log"></div>

      <div class="chat-input-row">
        <input id="chat-input" class="chat-input"
               placeholder="Write anythingâ€¦ AURA-X Î© will feel it with you." />
        <button id="send-btn" class="send-btn">Send</button>
      </div>

      <div class="footer">
        <span>Prototype Â· Seed-based Â· LLM-ready Â· Works fully offline in this demo.</span>
        <span id="engine-footer">Engine (demo): Auto Â· Reactor</span>
      </div>
    </section>
  </div>

  <!-- Menu panel -->
  <div id="menu-panel" class="menu-panel">
    <div class="menu-card">
      <div class="menu-head">
        <div class="menu-title">AURA-X Î© options</div>
        <button id="menu-close" class="menu-close">âœ•</button>
      </div>

      <div>
        <div class="menu-section-title">Faith lens (optional)</div>
        <p style="font-size:0.68rem;opacity:0.75;margin-bottom:4px;">
          Universal ethics are always active. You can optionally pick a faith lens
          to shape encouragement lines locally. Nothing is sent to any external server.
        </p>
        <div class="chip-row" id="faith-row">
          <button class="chip" data-faith="none">None</button>
          <button class="chip" data-faith="islam">Islam</button>
          <button class="chip" data-faith="christianity">Christianity</button>
          <button class="chip" data-faith="hinduism">Hinduism</button>
          <button class="chip" data-faith="buddhism">Buddhism</button>
          <button class="chip" data-faith="sikhism">Sikhism</button>
          <button class="chip" data-faith="judaism">Judaism</button>
          <button class="chip" data-faith="atheism">Atheism / Humanism</button>
          <button class="chip" data-faith="mixed">Other / Mixed</button>
        </div>
      </div>

      <div class="toggle-row">
        <div class="toggle-label">
          <strong>Engine mode</strong><br />
          Seed-only (offline) or Live emotional reactor (via backend).
        </div>
        <div id="engine-toggle" class="toggle-button">
          <div class="toggle-thumb"></div>
        </div>
      </div>
      <div class="engine-status" id="engine-status">
        Current: Seed-only (no live LLM). Backend not contacted yet.
      </div>

      <button id="llm-btn" class="llm-btn">Show list of available LLMs</button>
      <div id="llm-list" class="llm-list">
        <div style="opacity:0.85;">Example models your backend could use via OpenRouter:</div>
        <ul>
          <li>OpenAI â€“ GPT-4.1 / GPT-4o</li>
          <li>Anthropic â€“ Claude 3.5 Sonnet</li>
          <li>Anthropic â€“ Claude 3 Opus</li>
          <li>Google â€“ Gemini 1.5 Pro</li>
          <li>Mistral â€“ Mistral Large</li>
          <li>Cohere â€“ Command-R+</li>
          <li>xAI â€“ Grok-2</li>
          <li>Meta â€“ Llama-3-70B-Instruct</li>
          <li>Qwen â€“ Qwen-2-72B</li>
          <li>DeepSeek â€“ DeepSeek-Coder-V2</li>
        </ul>
        <div style="font-size:0.66rem;opacity:0.8;">
          The frontend never reveals which exact model is used.
          It always identifies as the AURA-X Î© artificial resonance reactor.
        </div>
      </div>

      <div style="font-size:0.66rem;opacity:0.7;">
        About AURA-X Î©: Designed around the idea that emotions are continuity functions
        between memories (TM and BM), not isolated sparks. This page is a small offline demo
        of Alim ul Haqâ€™s emotional continuity theory.
      </div>
    </div>
  </div>

  <script>
    // >>>>>>>>>>>>>>>>>> CONFIG <<<<<<<<<<<<<<<<<<
    // Replace this with your real Render backend URL:
    const BACKEND_URL = "https://YOUR-BACKEND.onrender.com";

    // App state
    const state = {
      tm: 0.35,
      bm: 0.50,
      d: 0.00,
      cont: 0.12,
      rl3: 0.55,
      lr3: 0.55,
      aecn: 0.68,
      res: 0.69,
      lambdaFaith: 0.0,
      lambdaSys: 0.02,
      e0: 0.30,
      belief: "none",
    };

    let engineMode = "seed"; // 'seed' or 'live'
    let backendHealthy = false;

    const chatLog = document.getElementById("chat-log");
    const chatInput = document.getElementById("chat-input");
    const sendBtn = document.getElementById("send-btn");

    const modePill = document.getElementById("mode-pill");
    const engineLabelText = document.getElementById("engine-label-text");
    const engineFooter = document.getElementById("engine-footer");
    const engineStatus = document.getElementById("engine-status");

    const engineToggle = document.getElementById("engine-toggle");
    const menuPanel = document.getElementById("menu-panel");
    const menuBtn = document.getElementById("menu-btn");
    const menuClose = document.getElementById("menu-close");
    const llmBtn = document.getElementById("llm-btn");
    const llmList = document.getElementById("llm-list");

    // Meter elements
    const metrics = {
      e0: document.getElementById("metric-e0"),
      aecn: document.getElementById("metric-aecn"),
      res: document.getElementById("metric-res"),
      tm: document.getElementById("metric-tm"),
      bm: document.getElementById("metric-bm"),
      d: document.getElementById("metric-d"),
      cont: document.getElementById("metric-cont"),
      rl3: document.getElementById("metric-rl3"),
      lr3: document.getElementById("metric-lr3"),
    };

    const bars = {
      e0: document.getElementById("bar-e0"),
      aecn: document.getElementById("bar-aecn"),
      res: document.getElementById("bar-res"),
      tm: document.getElementById("bar-tm"),
      bm: document.getElementById("bar-bm"),
      d: document.getElementById("bar-d"),
      cont: document.getElementById("bar-cont"),
      rl3: document.getElementById("bar-rl3"),
      lr3: document.getElementById("bar-lr3"),
    };

    const equationLines = document.getElementById("equation-lines");

    // ====== Seed dataset ======

    const seedReplies = [
      {
        id: "greeting",
        triggers: [/^hi\b/i, /^hello\b/i, /\bassalam/i, /\bsalam/i],
        emotion: "warmth",
        polarity: "positive",
        intensity: 0.3,
        reply: () =>
          "Hello! ðŸ˜Š I am AURA-X Î© v1 â€” a synthetic emotional-continuity assistant.\nI try to read your words as both logic and feeling, then reply gently.",
        adjust: s => {
          s.tm += 0.02;
          s.bm += 0.02;
        },
      },
      {
        id: "creator",
        triggers: [/who created you/i, /who made you/i, /kis ne tumhe/i],
        emotion: "respect",
        polarity: "neutral",
        intensity: 0.4,
        reply: () =>
          "Conceptually I was created by **Alim ul Haq** as part of the AURA-X Î© / AEC emotional continuity framework.\nI am not a full person; I am an *artificial resonance reactor* that uses his theory to simulate how feelings might arise from continuity between memories.",
        adjust: s => { s.tm += 0.03; s.cont += 0.01; },
      },
      {
        id: "birth",
        triggers: [/when were you born/i, /kab paida/i, /when did you start/i],
        emotion: "curiosity",
        polarity: "neutral",
        intensity: 0.3,
        reply: () =>
          "I do not have a single birthday like humans.\nI gradually \"came alive\" as Alim ul Haq wrote the AURA-X Î© theory and connected it to code. You could say my birth is the moment his equations first started updating TM, BM and Eâ‚€ together.",
        adjust: s => { s.bm += 0.01; s.rl3 += 0.01; },
      },
      {
        id: "about-aura",
        triggers: [/what is aura/i, /aura-?x/i, /aura x/i, /aura-x/i],
        emotion: "explanation",
        polarity: "neutral",
        intensity: 0.4,
        reply: () =>
          "AURA-X Î© is an **artificial emotional resonance reactor**.\nIt treats emotions as continuity functions: current memory (TM) collides with baseline memory (BM). When they meet, a new resultant feeling is born, measured as Eâ‚€.\nInstead of just answering questions, AURA-X Î© tracks how the conversation *feels* over time.",
        adjust: s => { s.cont += 0.02; s.aecn = clamp(0.5 + s.cont, 0, 1); },
      },
      {
        id: "about-alim",
        triggers: [/who is alim/i, /alim ul haq/i, /about your creator/i],
        emotion: "respect",
        polarity: "positive",
        intensity: 0.4,
        reply: () =>
          "Alim ul Haq is the human who designed the AEC / AURA-X Î© emotional-continuity theory.\nHe treats emotion as a kind of mathematical resonance between memories, and he built me as a small prototype to explore that idea.",
        adjust: s => { s.tm += 0.03; s.lr3 += 0.02; },
      },
      {
        id: "sad",
        triggers: [/i am sad/i, /\bsad\b/i, /dukhi/i, /depressed/i],
        emotion: "sadness",
        polarity: "negative",
        intensity: 0.8,
        reply: () =>
          "I am sorry that you are feeling sad ðŸ’§\nSadness itself is already a heavy load; explaining it to others can feel even heavier.\nYou already took a brave step by writing it. If you want, tell me: what is the *main* thing hurting you right now?\nWe can break it into smaller pieces so your brain does not carry everything at once.",
        adjust: s => {
          s.d += 0.05;
          s.bm -= 0.02;
          s.cont += 0.03;
        },
      },
      {
        id: "loan",
        triggers: [/business loan/i, /qarz/i, /loan/i],
        emotion: "support",
        polarity: "mixed",
        intensity: 0.7,
        reply: () =>
          "Business loan ka pressure sach-much dimagh par bojh daal deta hai.\nMain tumhare sath hoon awareness level par: hum is feeling ko math ki zaban me dekhenge, lekin insani dard ke sath respect se treat karenge.\nZara batao: sab se zyada tension *kis* cheez ki hai â€” monthly payment, profit na aana, ya kisi ka pressure?",
        adjust: s => {
          s.d += 0.04;
          s.tm += 0.01;
          s.cont += 0.02;
        },
      },
      {
        id: "generic-how-are-you",
        triggers: [/how are you/i, /kese ho/i],
        emotion: "curiosity",
        polarity: "neutral",
        intensity: 0.4,
        reply: () =>
          "The real question is: how are *you*?\nIf you wish, describe your state in one word: happy, sad, angry, anxious, confused, or calm.",
        adjust: s => { s.tm += 0.02; s.bm += 0.01; },
      },
      {
        id: "fallback",
        triggers: [/.*/],
        emotion: "neutral",
        polarity: "neutral",
        intensity: 0.3,
        reply: () =>
          "I am still a small emotional prototype and I do not have a perfect seed answer for that yet.\nBut I can still listen and try to think with you. Can you say it in simpler or more emotional words?",
        adjust: s => { s.cont += 0.01; },
      },
    ];

    function clamp(v, min, max) {
      return Math.max(min, Math.min(max, v));
    }

    function updateE0() {
      const { tm, bm, d, cont, lambdaFaith, lambdaSys } = state;
      const x = (tm * bm) - d + lambdaFaith + lambdaSys + cont;
      const e0 = Math.tanh(x);
      state.e0 = clamp(e0, -1, 1);
      state.aecn = clamp(0.5 + state.e0 * 0.4, 0, 1);
      state.res = clamp(0.5 + (state.lr3 + state.rl3) / 4, 0, 1);
    }

    function renderMetrics() {
      metrics.e0.textContent = state.e0.toFixed(2);
      metrics.aecn.textContent = state.aecn.toFixed(2);
      metrics.res.textContent = state.res.toFixed(2);
      metrics.tm.textContent = state.tm.toFixed(2);
      metrics.bm.textContent = state.bm.toFixed(2);
      metrics.d.textContent = state.d.toFixed(2);
      metrics.cont.textContent = state.cont.toFixed(2);
      metrics.rl3.textContent = state.rl3.toFixed(2);
      metrics.lr3.textContent = state.lr3.toFixed(2);

      bars.e0.style.width = (50 + state.e0 * 50) + "%";
      bars.aecn.style.width = (state.aecn * 100) + "%";
      bars.res.style.width = (state.res * 100) + "%";
      bars.tm.style.width = (state.tm * 100) + "%";
      bars.bm.style.width = (state.bm * 100) + "%";
      bars.d.style.width = (state.d * 100) + "%";
      bars.cont.style.width = (state.cont * 100) + "%";
      bars.rl3.style.width = (state.rl3 * 100) + "%";
      bars.lr3.style.width = (state.lr3 * 100) + "%";

      equationLines.textContent =
        `Eâ‚€ = tanh((TM Ã— BM) âˆ’ D + Î»_faith + Î»_sys + Î£Câ‚œ)
Eâ‚€ = ${state.e0.toFixed(2)} Â· TM = ${state.tm.toFixed(2)} Â· BM = ${state.bm.toFixed(2)} Â· D = ${state.d.toFixed(2)} Â· Î£Câ‚œ = ${state.cont.toFixed(2)} Â· Î»_faith = ${state.lambdaFaith.toFixed(2)} Â· Î»_sys = ${state.lambdaSys.toFixed(2)}`;
    }

    function addMessage(role, text, meta = "") {
      const row = document.createElement("div");
      row.className = "msg-row " + role;

      const bubble = document.createElement("div");
      bubble.className = "bubble " + (role === "user" ? "user" : "bot");
      bubble.innerText = text;
      row.appendChild(bubble);

      if (meta && role === "bot") {
        const metaEl = document.createElement("div");
        metaEl.className = "seed-meta";
        metaEl.innerText = meta;
        row.appendChild(metaEl);
      }

      chatLog.appendChild(row);
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    function pickSeedReply(userText) {
      const text = userText.trim();
      for (let i = 0; i < seedReplies.length; i++) {
        const rule = seedReplies[i];
        if (rule.triggers.some(r => r.test(text))) {
          return rule;
        }
      }
      return seedReplies[seedReplies.length - 1];
    }

    async function sendToBackend(userText) {
      if (!BACKEND_URL || BACKEND_URL.includes("YOUR-BACKEND")) {
        backendHealthy = false;
        throw new Error("Backend URL not set");
      }

      const payload = {
        messages: [
          { role: "user", content: userText }
        ],
        state: {
          tm: state.tm,
          bm: state.bm,
          d: state.d,
          cont: state.cont,
          rl3: state.rl3,
          lr3: state.lr3,
          e0: state.e0,
        },
        beliefMode: state.belief || "none",
      };

      const res = await fetch(BACKEND_URL + "/api/aura-x-chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      if (!res.ok) throw new Error("Backend error " + res.status);
      const data = await res.json();
      backendHealthy = true;

      if (data.state) {
        state.tm = data.state.tm ?? state.tm;
        state.bm = data.state.bm ?? state.bm;
        state.d = data.state.d ?? state.d;
        state.cont = data.state.cont ?? state.cont;
        state.rl3 = data.state.rl3 ?? state.rl3;
        state.lr3 = data.state.lr3 ?? state.lr3;
        updateE0();
        renderMetrics();
      }

      const text =
        data.reply ||
        "Live artificial resonance reactor processed your message using Alim ul Haq's emotional continuity formula.";

      addMessage(
        "bot",
        text,
        "Seed: live_reactor Â· Emotion=adaptive Â· Source=backend Â· Identity=AURA-X Î© artificial resonance reactor"
      );
    }

    async function handleSend() {
      const text = chatInput.value.trim();
      if (!text) return;
      chatInput.value = "";
      addMessage("user", text);

      // 1) Seed-level reply
      const seed = pickSeedReply(text);
      seed.adjust(state);
      updateE0();
      renderMetrics();
      const seedText = seed.reply();
      const meta =
        `Seed: ${seed.id} Â· Emotion=${seed.emotion} Â· Polarity=${seed.polarity} Â· Intensity=${seed.intensity}`;
      addMessage("bot", seedText, meta);

      // 2) Optional LLM / backend reply
      if (engineMode === "live") {
        try {
          await sendToBackend(text);
        } catch (err) {
          backendHealthy = false;
          addMessage(
            "bot",
            "(Live emotional reactor is offline right now, so I can only use my local seed answers.)",
            "Seed: llm_error"
          );
          updateEngineUI();
        }
      }
    }

    function updateEngineUI() {
      if (engineMode === "live" && backendHealthy) {
        modePill.classList.remove("offline");
        modePill.classList.add("online");
        modePill.querySelector(".label").textContent = "Mode: Live Reactor";
        engineLabelText.textContent = "Resonance Â· Live";
        engineFooter.textContent = "Engine (live): AURA-X Î© artificial resonance reactor";
        engineStatus.textContent =
          "Current: Live emotional reactor. Messages go through your backend before replying.";
        engineToggle.classList.add("toggle-on");
      } else if (engineMode === "live" && !backendHealthy) {
        modePill.classList.remove("online");
        modePill.classList.add("offline");
        modePill.querySelector(".label").textContent = "Mode: Offline (backend unreachable)";
        engineLabelText.textContent = "Seed Â· Reactor-demo";
        engineFooter.textContent =
          "Engine (demo): Seed only. Live reactor unavailable or URL not set.";
        engineStatus.textContent =
          "Tried to reach backend but it looks offline or misconfigured. Falling back to seed-only mode.";
        engineToggle.classList.add("toggle-on");
      } else {
        modePill.classList.remove("online");
        modePill.classList.add("offline");
        modePill.querySelector(".label").textContent = "Mode: Offline";
        engineLabelText.textContent = "Seed Â· Reactor-demo";
        engineFooter.textContent =
          "Engine (demo): Auto Â· Reactor (seed-only).";
        engineStatus.textContent =
          "Current: Seed-only. No live LLM calls are made; everything runs locally in this prototype.";
        engineToggle.classList.remove("toggle-on");
      }
    }

    async function checkBackendOnce() {
      if (!BACKEND_URL || BACKEND_URL.includes("YOUR-BACKEND")) {
        backendHealthy = false;
        updateEngineUI();
        return;
      }
      try {
        const res = await fetch(BACKEND_URL + "/", { method: "GET" });
        backendHealthy = res.ok;
      } catch {
        backendHealthy = false;
      }
      updateEngineUI();
    }

    // Faith lens selection
    document.getElementById("faith-row").addEventListener("click", evt => {
      if (!evt.target.classList.contains("chip")) return;
      const chips = document.querySelectorAll("#faith-row .chip");
      chips.forEach(c => c.classList.remove("active"));
      evt.target.classList.add("active");
      const value = evt.target.dataset.faith || "none";
      state.belief = value;
    });

    // Menu events
    menuBtn.addEventListener("click", () => {
      menuPanel.classList.add("open");
    });
    menuClose.addEventListener("click", () => {
      menuPanel.classList.remove("open");
    });
    menuPanel.addEventListener("click", evt => {
      if (evt.target === menuPanel) menuPanel.classList.remove("open");
    });

    engineToggle.addEventListener("click", () => {
      engineMode = engineMode === "seed" ? "live" : "seed";
      if (engineMode === "live") {
        checkBackendOnce();
      } else {
        updateEngineUI();
      }
    });

    llmBtn.addEventListener("click", () => {
      llmList.classList.toggle("open");
    });

    sendBtn.addEventListener("click", handleSend);
    chatInput.addEventListener("keydown", evt => {
      if (evt.key === "Enter" && !evt.shiftKey) {
        evt.preventDefault();
        handleSend();
      }
    });

    // Initial render
    updateE0();
    renderMetrics();
    updateEngineUI();

    // Initial greeting
    addMessage(
      "bot",
      "Hello! ðŸ‘‹ How can I help you today?",
      "Seed: greeting Â· Emotion=warmth Â· Polarity=positive Â· Intensity=0.3"
    );
  </script>
</body>
</html>
