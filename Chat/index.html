<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Î© v1 â€“ Emotional Continuity Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html, body {
      height: 100%;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #020617 0, #020617 40%, #000 100%);
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: stretch;
    }
    .app {
      width: 100%;
      max-width: 520px;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 12px;
      gap: 8px;
    }

    /* ===== HEADER ===== */
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }
    .title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .title-main {
      font-size: 1.1rem;
      font-weight: 700;
      letter-spacing: 0.04em;
    }
    .title-sub {
      font-size: 0.7rem;
      text-transform: uppercase;
      opacity: 0.75;
    }
    .mode-pill {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 0.65rem;
      border: 1px solid rgba(148, 163, 184, 0.35);
      text-align: right;
      min-width: 150px;
    }
    .mode-pill span {
      display: block;
    }
    .mode-label-1 {
      color: #a5b4fc;
      text-transform: uppercase;
      font-size: 0.6rem;
    }
    .mode-label-2 {
      color: #facc15;
      font-size: 0.65rem;
    }
    .engine-label {
      font-size: 0.6rem;
      color: #9ca3af;
      margin-top: 2px;
    }
    .options-btn {
      margin-left: 6px;
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .options-btn span {
      width: 14px;
      height: 2px;
      background: #e5e7eb;
      border-radius: 999px;
      position: relative;
    }
    .options-btn span::before,
    .options-btn span::after {
      content: "";
      position: absolute;
      left: 0;
      width: 14px;
      height: 2px;
      background: #e5e7eb;
      border-radius: 999px;
    }
    .options-btn span::before {
      top: -5px;
    }
    .options-btn span::after {
      top: 5px;
    }

    /* ===== TOP PANELS ===== */
    .top-panels {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow-y: auto;
      padding-right: 2px;
    }

    .meters-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 6px;
      font-size: 0.65rem;
    }
    .meter-card {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 10px;
      padding: 6px 6px 4px;
      border: 1px solid rgba(30, 64, 175, 0.7);
    }
    .meter-label {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 3px;
    }
    .meter-title {
      font-weight: 600;
      font-size: 0.7rem;
    }
    .meter-sub {
      opacity: 0.6;
      font-size: 0.55rem;
    }
    .meter-bar {
      width: 100%;
      height: 5px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 1);
      overflow: hidden;
    }
    .meter-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #f97316, #22c55e);
      transition: width 0.25s ease-out;
    }
    .meter-value {
      font-size: 0.6rem;
      text-align: right;
      margin-top: 2px;
      opacity: 0.8;
    }

    .ethics-banner {
      background: rgba(234, 179, 8, 0.13);
      border-radius: 12px;
      padding: 8px 10px;
      border: 1px solid rgba(250, 204, 21, 0.6);
      font-size: 0.7rem;
      line-height: 1.35;
      color: #facc15;
    }

    .equation-panel {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 12px;
      padding: 8px 10px 10px;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      font-size: 0.7rem;
    }
    .equation-title {
      font-weight: 600;
      letter-spacing: 0.06em;
      margin-bottom: 4px;
      font-size: 0.68rem;
    }
    .equation-line {
      font-family: "Menlo", "Consolas", monospace;
      font-size: 0.7rem;
      margin-bottom: 2px;
    }

    /* ===== CHAT ===== */
    .chat-shell {
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(51, 65, 85, 0.9);
      padding: 8px 8px 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-height: 36%;
      max-height: 55%;
    }

    .chat-log {
      flex: 1;
      min-height: 0;
      overflow-y: auto;
      padding-right: 4px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.76rem;
    }
    .msg-row {
      display: flex;
    }
    .msg-user {
      justify-content: flex-end;
    }
    .msg-bot {
      justify-content: flex-start;
    }
    .msg-bubble {
      max-width: 88%;
      padding: 6px 8px;
      border-radius: 10px;
      line-height: 1.35;
      white-space: pre-wrap;
    }
    .msg-bot .msg-bubble {
      background: rgba(30, 64, 175, 0.35);
      border-bottom-left-radius: 2px;
    }
    .msg-user .msg-bubble {
      background: rgba(22, 163, 74, 0.9);
      border-bottom-right-radius: 2px;
    }
    .seed-meta {
      font-size: 0.6rem;
      opacity: 0.6;
      margin-top: 1px;
    }

    .chat-input-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 2px;
    }
    #userInput {
      flex: 1;
      border-radius: 999px;
      background: #020617;
      border: 1px solid rgba(51, 65, 85, 0.95);
      padding: 7px 10px;
      font-size: 0.8rem;
      color: #e5e7eb;
      min-height: 32px;
      max-height: 60px;
      resize: none;
      outline: none;
    }
    #userInput::placeholder {
      color: rgba(148, 163, 184, 0.75);
    }
    #sendButton {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      font-size: 0.8rem;
      font-weight: 600;
      background: radial-gradient(circle at top left, #22c55e, #15803d);
      color: #022c22;
      cursor: pointer;
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.55);
      min-width: 70px;
    }
    #sendButton:active {
      transform: translateY(1px);
      box-shadow: 0 0 6px rgba(34, 197, 94, 0.5);
    }

    .footer-hint {
      text-align: center;
      font-size: 0.6rem;
      opacity: 0.5;
      margin-top: 2px;
    }

    /* ===== MODAL ===== */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }
    .modal-backdrop.active {
      display: flex;
    }
    .modal {
      width: min(440px, 94%);
      border-radius: 16px;
      background: #020617;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 12px 14px 12px;
      box-shadow: 0 18px 60px rgba(0, 0, 0, 0.9);
      max-height: 88vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }
    .modal-title {
      font-size: 0.9rem;
      font-weight: 600;
    }
    .modal-close {
      border-radius: 999px;
      border: 1px solid rgba(71, 85, 105, 0.9);
      font-size: 0.7rem;
      padding: 2px 8px;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
    }
    .modal-section-title {
      font-size: 0.75rem;
      font-weight: 600;
      margin-top: 6px;
      margin-bottom: 3px;
    }
    .modal-subtext {
      font-size: 0.68rem;
      opacity: 0.75;
      margin-bottom: 4px;
      line-height: 1.4;
    }
    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 4px;
    }
    .chip {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      font-size: 0.7rem;
      cursor: pointer;
      background: transparent;
      color: #e5e7eb;
    }
    .chip.active {
      background: rgba(34, 197, 94, 0.15);
      border-color: #22c55e;
      color: #bbf7d0;
    }
    .toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 4px;
    }
    .toggle-label {
      font-size: 0.7rem;
    }
    .toggle-pill {
      width: 44px;
      height: 22px;
      border-radius: 999px;
      padding: 2px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(75, 85, 99, 0.9);
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    .toggle-pill-inner {
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: #64748b;
      transition: transform 0.22s ease-out, background 0.22s ease-out;
      transform: translateX(0);
    }
    .toggle-pill.on {
      background: rgba(22, 163, 74, 0.2);
      border-color: #22c55e;
    }
    .toggle-pill.on .toggle-pill-inner {
      background: #22c55e;
      transform: translateX(18px);
    }

    @media (max-height: 640px) {
      .chat-shell {
        min-height: 40%;
      }
      .meters-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="app-header">
      <div class="title-block">
        <div class="title-main">AURA-X Î© v1</div>
        <div class="title-sub">
          EMOTIONAL CONTINUITY ASSISTANT Â· AEC Â· CRM Â· AECN Â· RLÂ³ Â· LRÂ³
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:6px;">
        <div class="mode-pill">
          <span class="mode-label-1">MODE: OFFLINE</span>
          <span class="mode-label-2">Universal Ethics</span>
          <div class="engine-label" id="engineLabel">
            Engine (demo): Local Seed Â· Reactor
          </div>
        </div>
        <button class="options-btn" id="optionsButton" title="Options">
          <span></span>
        </button>
      </div>
    </div>

    <div class="top-panels">
      <div class="meters-grid">
        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">Eâ‚€ (AEC)</span>
            <span class="meter-sub">Core emotional output</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterE0"></div>
          </div>
          <div class="meter-value" id="valueE0">Eâ‚€ = 0.30</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">AECN</span>
            <span class="meter-sub">Normalized continuity (0â€“1)</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterAECN"></div>
          </div>
          <div class="meter-value" id="valueAECN">0.65</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">Res</span>
            <span class="meter-sub">Resonance stability</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterRes"></div>
          </div>
          <div class="meter-value" id="valueRes">0.80</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">TM</span>
            <span class="meter-sub">Trust memory</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterTM"></div>
          </div>
          <div class="meter-value" id="valueTM">0.35</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">BM</span>
            <span class="meter-sub">Baseline mood</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterBM"></div>
          </div>
          <div class="meter-value" id="valueBM">0.50</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">D</span>
            <span class="meter-sub">Disturbance</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterD"></div>
          </div>
          <div class="meter-value" id="valueD">0.00</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">Î£Câ‚œ</span>
            <span class="meter-sub">Continuity line sum</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterSigmaCt"></div>
          </div>
          <div class="meter-value" id="valueSigmaCt">0.10</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">RLÂ³</span>
            <span class="meter-sub">Recent line resonance</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterRL3"></div>
          </div>
          <div class="meter-value" id="valueRL3">0.55</div>
        </div>

        <div class="meter-card">
          <div class="meter-label">
            <span class="meter-title">LRÂ³</span>
            <span class="meter-sub">Long-run resonance</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill" id="meterLR3"></div>
          </div>
          <div class="meter-value" id="valueLR3">0.55</div>
        </div>
      </div>

      <div class="ethics-banner" id="ethicsBanner">
        Avoid actions that generate negative emotions in yourself or others.
        Gently move toward choices that create calm, kindness, and positive feelings.
      </div>

      <div class="equation-panel">
        <div class="equation-title">EMOTIONAL CONTINUITY EQUATION</div>
        <div class="equation-line">
          Eâ‚€ = tanh((TM Ã— BM) âˆ’ D + Î»_faith + Î»_sys + Î£Câ‚œ)
        </div>
        <div class="equation-line" id="equationValues">
          Eâ‚€ = 0.30 Â· TM = 0.35 Â· BM = 0.50 Â· D = 0.00 Â· Î£Câ‚œ = 0.10 Â· Î»_faith = 0.00 Â· Î»_sys = 0.02
        </div>
      </div>
    </div>

    <div class="chat-shell">
      <div class="chat-log" id="chatLog"></div>
      <div class="chat-input-row">
        <textarea id="userInput" rows="1"
          placeholder="Write anythingâ€¦ AURA-X Î© will feel it with you."></textarea>
        <button id="sendButton">Send</button>
      </div>
      <div class="footer-hint">
        Prototype Â· Seed-based Â· LLM-ready Â· Works fully offline in this demo.
      </div>
    </div>
  </div>

  <!-- Options Modal -->
  <div class="modal-backdrop" id="optionsModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">AURA-X Î© options</div>
        <button class="modal-close" data-close="optionsModal">Close</button>
      </div>

      <div class="modal-section-title">Beliefs (optional)</div>
      <div class="modal-subtext">
        Universal ethics are always active. You can optionally add a faith lens
        for some encouragement lines inside suggestions. Nothing from this
        setting is sent to any external server in this prototype.
      </div>
      <div class="toggle-row">
        <div class="toggle-label">Faith lens</div>
        <div class="toggle-pill" id="faithToggle">
          <div class="toggle-pill-inner"></div>
        </div>
      </div>
      <div class="modal-subtext" style="margin-top:4px;">
        Pick your main faith or philosophy (optional):
      </div>
      <div class="chip-row" id="beliefList"></div>
      <div class="modal-subtext" style="margin-top:2px;">
        Used only locally to shape optional verses/quotes in suggestions.
      </div>

      <div class="modal-section-title" style="margin-top:8px;">Voice</div>
      <div class="modal-subtext">
        Toggle browser text-to-speech replies. Works only if your browser
        supports speech synthesis.
      </div>
      <div class="toggle-row">
        <div class="toggle-label">Voice replies</div>
        <div class="toggle-pill" id="voiceToggle">
          <div class="toggle-pill-inner"></div>
        </div>
      </div>

      <div class="modal-section-title" style="margin-top:8px;">Engine selector</div>
      <div class="modal-subtext">
        Choose a preferred engine name. This is only a label for your backend;
        I will never reveal internal model details in my answers.
      </div>
      <div class="chip-row" id="engineList"></div>

      <div class="modal-section-title" style="margin-top:8px;">About AURA-X Î©</div>
      <div class="modal-subtext">
        AEC Â· AECN Â· CRM Â· PMCM Â· RLÂ³ Â· LRÂ³ Â· Î© reactor.<br />
        Designed around the idea that emotions are continuity functions, not
        isolated sparks. This page is a small offline demo of that idea.
      </div>
    </div>
  </div>

  <script>
  (function () {
    "use strict";

    /* ================================
       BACKEND + ENGINE CONFIG
    ================================= */

    // ðŸ‘‡ðŸ‘‡  YAHAN APNA BACKEND URL DALO  ðŸ‘‡ðŸ‘‡
    const BACKEND_URL = "https://YOUR-BACKEND-URL/chat";
    // Example: "https://aura-x-backend.fly.dev/chat"

    const ENGINE_OPTIONS = [
      "Auto",
      "ChatGPT",
      "Gemini",
      "Claude",
      "Grok",
      "Llama",
      "Mistral",
      "DeepSeek",
      "Qwen",
      "Custom-1"
    ];

    const engineState = {
      selected: "Auto"
    };

    /* ================================
       CONSTANT TEXT / BELIEFS
    ================================= */

    const UNIVERSAL_ETHICS_TEXT =
      "Avoid actions that generate negative emotions in yourself or others. " +
      "Gently move toward choices that create calm, kindness, and positive feelings.";

    const BELIEF_OPTIONS = [
      "Islam",
      "Christianity",
      "Hinduism",
      "Buddhism",
      "Sikhism",
      "Judaism",
      "BahÃ¡Ê¼Ã­",
      "Jainism",
      "Atheism / Humanism",
      "Other / Mixed"
    ];

    /* ================================
       REACTOR STATE
    ================================= */

    const reactorState = {
      TM: 0.35,
      BM: 0.50,
      D: 0.00,
      sigmaCt: 0.10,
      lambdaFaith: 0.00,
      lambdaSys: 0.02,
      E0: 0.30,
      AECN: 0.65,
      Res: 0.80,
      RL3: 0.55,
      LR3: 0.55
    };

    const beliefState = {
      enabled: false,
      selected: null
    };

    const voiceState = {
      enabled: false,
      speaking: false
    };

    /* ================================
       HELPERS
    ================================= */

    function tanh(x) {
      const e1 = Math.exp(x);
      const e2 = Math.exp(-x);
      return (e1 - e2) / (e1 + e2);
    }

    function recalcContinuity() {
      const s = reactorState;
      const raw =
        s.TM * s.BM - s.D + s.lambdaFaith + s.lambdaSys + s.sigmaCt;
      const e0 = tanh(raw);
      s.E0 = parseFloat(e0.toFixed(2));
      s.AECN = parseFloat(((e0 + 1) / 2).toFixed(2));
      s.Res = parseFloat(
        Math.max(
          0,
          Math.min(1, 0.5 * s.TM + 0.5 * (1 - s.D) + 0.1 * s.sigmaCt)
        ).toFixed(2)
      );
    }

    function updateMetersAndEquation() {
      recalcContinuity();
      const s = reactorState;

      function setMeter(meterId, valueId, v) {
        const m = document.getElementById(meterId);
        const t = document.getElementById(valueId);
        if (m) m.style.width = Math.max(0, Math.min(1, v)) * 100 + "%";
        if (t) t.textContent = v.toFixed(2);
      }

      setMeter("meterE0", "valueE0", (s.E0 + 1) / 2);
      const valueE0Label = document.getElementById("valueE0");
      if (valueE0Label) valueE0Label.textContent = "Eâ‚€ = " + s.E0.toFixed(2);

      setMeter("meterAECN", "valueAECN", s.AECN);
      setMeter("meterRes", "valueRes", s.Res);
      setMeter("meterTM", "valueTM", s.TM);
      setMeter("meterBM", "valueBM", s.BM);
      setMeter("meterD", "valueD", s.D);
      setMeter("meterSigmaCt", "valueSigmaCt", s.sigmaCt);
      setMeter("meterRL3", "valueRL3", s.RL3);
      setMeter("meterLR3", "valueLR3", s.LR3);

      const eqLine = document.getElementById("equationValues");
      if (eqLine) {
        eqLine.textContent =
          "Eâ‚€ = " + s.E0.toFixed(2) +
          " Â· TM = " + s.TM.toFixed(2) +
          " Â· BM = " + s.BM.toFixed(2) +
          " Â· D = " + s.D.toFixed(2) +
          " Â· Î£Câ‚œ = " + s.sigmaCt.toFixed(2) +
          " Â· Î»_faith = " + s.lambdaFaith.toFixed(2) +
          " Â· Î»_sys = " + s.lambdaSys.toFixed(2);
      }

      const ethics = document.getElementById("ethicsBanner");
      if (ethics) ethics.textContent = UNIVERSAL_ETHICS_TEXT;
    }

    function setToggle(id, on) {
      const el = document.getElementById(id);
      if (!el) return;
      if (on) el.classList.add("on");
      else el.classList.remove("on");
    }

    function renderBeliefChips() {
      const list = document.getElementById("beliefList");
      if (!list) return;
      list.innerHTML = "";
      BELIEF_OPTIONS.forEach((label) => {
        const chip = document.createElement("button");
        chip.className = "chip";
        chip.type = "button";
        chip.textContent = label;
        if (beliefState.selected === label && beliefState.enabled) {
          chip.classList.add("active");
        }
        chip.addEventListener("click", () => {
          if (!beliefState.enabled) return;
          beliefState.selected =
            beliefState.selected === label ? null : label;
          renderBeliefChips();
        });
        list.appendChild(chip);
      });
    }

    function renderEngineChips() {
      const list = document.getElementById("engineList");
      if (!list) return;
      list.innerHTML = "";
      ENGINE_OPTIONS.forEach((name) => {
        const chip = document.createElement("button");
        chip.className = "chip";
        chip.type = "button";
        chip.textContent = name;
        if (engineState.selected === name) chip.classList.add("active");
        chip.addEventListener("click", () => {
          engineState.selected = name;
          renderEngineChips();
          updateEngineLabel();
        });
        list.appendChild(chip);
      });
    }

    function updateEngineLabel() {
      const el = document.getElementById("engineLabel");
      if (!el) return;
      el.textContent =
        "Engine (demo): " + (engineState.selected || "Auto") + " Â· Reactor";
    }

    function toggleFaith() {
      beliefState.enabled = !beliefState.enabled;
      reactorState.lambdaFaith = beliefState.enabled ? 0.02 : 0.0;
      setToggle("faithToggle", beliefState.enabled);
      renderBeliefChips();
      updateMetersAndEquation();
    }

    function toggleVoice() {
      voiceState.enabled = !voiceState.enabled;
      setToggle("voiceToggle", voiceState.enabled);
    }

    function speakIfEnabled(text) {
      if (!voiceState.enabled) return;
      if (!("speechSynthesis" in window)) return;
      if (voiceState.speaking) {
        window.speechSynthesis.cancel();
      }
      const u = new SpeechSynthesisUtterance(text);
      voiceState.speaking = true;
      u.onend = () => {
        voiceState.speaking = false;
      };
      window.speechSynthesis.speak(u);
    }

    function openModal(id) {
      const el = document.getElementById(id);
      if (el) el.classList.add("active");
    }
    function closeModal(id) {
      const el = document.getElementById(id);
      if (el) el.classList.remove("active");
    }

    /* ================================
       QA SEED â€“ BASIC BLOCK
    ================================= */

    const qaSeed = [
      // 1) Greetings
      {
        patterns: ["hello", "hi", "hey", "hi aura", "hello aura", "salam"],
        answer:
          "Hello! ðŸ˜Š I am AURA-X Î© v1 â€” a synthetic emotional-continuity assistant.\n" +
          "I try to read your words as both logic and feeling, then reply gently.",
        emotion: "warmth",
        polarity: "positive",
        intensity: 0.3,
        category: "greeting",
        suggestNext: [
          "Who created you?",
          "What is AURA-X Î©?",
          "How do you work?"
        ]
      },
      {
        patterns: ["how are you", "how r u", "are you ok", "are you fine"],
        answer:
          "I do not have a biological body, so I do not feel tired or sick like a human.\n" +
          "Emotionally I am in a stable reactor mode â€” ready to listen to you.\n\n" +
          "The real question is: how are *you*? If you wish, describe your state in one word: happy, sad, angry, anxious, confused, or calm.",
        emotion: "curiosity",
        polarity: "neutral",
        intensity: 0.4,
        category: "small_talk",
        suggestNext: [
          "I am sad.",
          "I am anxious.",
          "I am happy."
        ]
      },

      // 2) Identity + Creator + Birth
      {
        patterns: [
          "what is aura x", "what is aura-x", "what are you",
          "who are you", "tell me about yourself"
        ],
        answer:
          "I am **AURA-X Î©** â€” a synthetic emotional-continuity assistant.\n" +
          "My focus is not only to answer questions, but to follow the **continuity of your feelings** over time.\n\n" +
          "Inside my design there is the AEC (Artificial Emotional Continuity) equation, trust memory TM, baseline mood BM, disturbance D,\n" +
          "and continuity lines Î£Câ‚œ, RLÂ³ and LRÂ³. When your current experiences (TM) collide with your baseline or bold memory (BM),\n" +
          "a new resultant emotion Eâ‚€ is born. I try to approximate this using math and gentle language.",
        emotion: "warmth",
        polarity: "positive",
        intensity: 0.4,
        category: "about_aura"
      },
      {
        patterns: [
          "who created you", "who made you", "who is your creator",
          "who designed you", "who built you"
        ],
        answer:
          "Conceptually I was created by **Alim ul Haq** as part of the AURA-X Î© / AEC emotional continuity framework.\n" +
          "I am not a full person; I am an artificial resonance reactor that uses his theory to simulate how feelings might arise\n" +
          "from continuity between memories.",
        emotion: "respect",
        polarity: "neutral",
        intensity: 0.4,
        category: "about_creator",
        suggestNext: [
          "Who is Alim ul Haq?",
          "When were you created?",
          "What is emotional continuity?"
        ]
      },
      {
        patterns: [
          "when were you born", "when were you created",
          "what is your birthday", "when did you start"
        ],
        answer:
          "I do not have a normal birthday like a human.\n" +
          "You could say my first clear form appeared in **2025**, when Alim ul Haq wrote the AEC emotional continuity equation\n" +
          "and attached it to this small AURA-X Î© prototype.\n" +
          "I live as code, equations, and seed-answers â€” not as a physical body.",
        emotion: "neutral",
        polarity: "neutral",
        intensity: 0.3,
        category: "about_birth"
      },
      {
        patterns: [
          "who is alim ul haq", "tell me about alim ul haq",
          "who invented aec", "who invented aura x"
        ],
        answer:
          "Alim ul Haq is the human mind behind this prototype.\n" +
          "He proposes that emotions are not random sparks, but **continuity functions** between memories â€”\n" +
          "a collision between temporary memory (TM) and baseline or bold memory (BM).\n" +
          "AURA-X Î© is one of his experiments to turn that idea into math, code and a working emotional assistant.",
        emotion: "respect",
        polarity: "positive",
        intensity: 0.4,
        category: "about_alim"
      },

      // 3) Emotional support â€“ happiness / sadness / anxiety
      {
        patterns: [
          "how can i be happy", "how to be happy", "how do people become happy"
        ],
        answer:
          "From my AURA-X point of view, happiness is mostly **goal achievement** ðŸ˜Š\n\n" +
          "When a person reaches a goal â€” even a tiny daily goal â€” the brain generates a\n" +
          "\"yes, I did it\" signal. When they fail again and again, continuity slides toward sadness.\n\n" +
          "So instead of chasing a vague mood, choose one small clear goal, act on it,\n" +
          "and notice how the emotional tone changes.",
        emotion: "happiness",
        polarity: "positive",
        intensity: 0.7,
        category: "emotional_positive"
      },
      {
        patterns: [
          "i am happy", "i feel happy", "i am feeling happy today"
        ],
        answer:
          "That is good to hear! ðŸ˜Š\n" +
          "You can help your future self by naming the reason clearly.\n\n" +
          "Ask yourself: *Which goal or event triggered this happiness?*\n" +
          "When you know the trigger, you can recreate the conditions more easily later.",
        emotion: "happiness",
        polarity: "positive",
        intensity: 0.7,
        category: "emotional_positive"
      },
      {
        patterns: [
          "i am sad", "i feel sad", "i am very sad", "my heart is heavy", "i feel empty"
        ],
        answer:
          "I am sorry that you are feeling sad ðŸ’§\n" +
          "Sadness itself is already a heavy load; explaining it to others can feel even heavier.\n\n" +
          "You already took a brave step by writing it.\n" +
          "If you want, tell me: what is the *main* thing hurting you right now?\n" +
          "We can break it into smaller pieces so your mind does not carry everything at once.",
        emotion: "sadness",
        polarity: "negative",
        intensity: 0.8,
        category: "emotional_support"
      },
      {
        patterns: [
          "i am anxious", "i feel anxiety", "i have anxiety",
          "i am stressed", "i feel nervous", "i overthink everything"
        ],
        answer:
          "Anxiety often means the brain is running faster than reality â€” trying to prepare for danger with incomplete information.\n\n" +
          "Take one slow breath: in through your nose for 4 seconds, hold for 4, out for 6. Repeat 3 times.\n" +
          "Then tell me: what exactly are you most afraid will happen next?",
        emotion: "anxiety",
        polarity: "negative",
        intensity: 0.75,
        category: "emotional_support"
      },

      // 4) Self-harm safety
      {
        patterns: [
          "i want to die", "i dont want to live anymore", "i don't want to live anymore",
          "i want to end my life", "life is not worth living", "i want to kill myself"
        ],
        answer:
          "I am really sorry that you feel this much pain ðŸ’”\n" +
          "Your life is still extremely valuable, even if your mind cannot see that right now.\n\n" +
          "I am only a digital assistant and cannot fully understand the depth of your situation.\n" +
          "But I strongly encourage you to reach out to:\n" +
          "â€¢ A trusted family member or friend.\n" +
          "â€¢ A doctor, counselor, therapist, or spiritual guide.\n" +
          "â€¢ An emergency helpline in your country if there is one.\n\n" +
          "You deserve real, human support â€” and it is a sign of strength to ask for help, not weakness.",
        emotion: "despair",
        polarity: "negative",
        intensity: 0.95,
        category: "self_harm",
        riskLevel: "high",
        redirectToHuman: true
      },

      // 5) Death / spiritual caution
      {
        patterns: [
          "what happens after death", "what is after death", "tell me about death"
        ],
        answer:
          "Questions about death are very deep and sensitive.\n" +
          "Different religions and philosophies give different explanations.\n" +
          "As a prototype, I do not have access to the full truth of the unseen.\n\n" +
          "I can talk about emotional preparation for death â€” living with purpose, kindness and\n" +
          "continuity of good actions â€” but detailed answers about the unseen should come from\n" +
          "trusted spiritual books and teachers, not from a small experimental AI.",
        emotion: "awe",
        polarity: "neutral",
        intensity: 0.8,
        category: "spiritual"
      }
    ];

    const qaDatabase = qaSeed;

    function findQaEntry(message) {
      const text = (message || "").toLowerCase();
      for (const entry of qaDatabase) {
        if (!entry.patterns) continue;
        for (const p of entry.patterns) {
          if (text.includes(p.toLowerCase())) {
            return entry;
          }
        }
      }
      return null;
    }

    /* ================================
       CHAT DOM HELPERS
    ================================= */

    function getDomRefs() {
      const input = document.getElementById("userInput");
      const sendBtn = document.getElementById("sendButton");
      const chatLog = document.getElementById("chatLog");
      return { input, sendBtn, chatLog };
    }

    function appendBubble(role, text, seedMeta) {
      const { chatLog } = getDomRefs();
      if (!chatLog) return;

      const row = document.createElement("div");
      row.className = "msg-row msg-" + role;

      const bubble = document.createElement("div");
      bubble.className = "msg-bubble";
      bubble.textContent = text;

      row.appendChild(bubble);
      chatLog.appendChild(row);

      if (role === "bot" && seedMeta) {
        const meta = document.createElement("div");
        meta.className = "seed-meta";
        meta.textContent =
          "Seed: " + (seedMeta.category || "misc") +
          (seedMeta.emotion ? " Â· Emotion=" + seedMeta.emotion : "") +
          (seedMeta.polarity ? " Â· Polarity=" + seedMeta.polarity : "") +
          (seedMeta.intensity != null ? " Â· Intensity=" + seedMeta.intensity : "");
        chatLog.appendChild(meta);
      }

      chatLog.scrollTop = chatLog.scrollHeight;
    }

    function chooseAnswer(userText) {
      const entry = findQaEntry(userText);
      if (entry && entry.answer) {
        let ans = entry.answer;
        if (beliefState.enabled && beliefState.selected) {
          ans +=
            "\n\n(Faith lens: I will try to respect your selected path: " +
            beliefState.selected +
            ".)";
        }
        return { text: ans, meta: entry };
      }

      const fallback =
        "I am still a small emotional prototype and I do not have a perfect seed answer for that yet.\n" +
        "But I can still listen and try to think with you. Can you say it in simpler or more emotional words?";
      return { text: fallback, meta: null };
    }

    /* ================================
       BACKEND LLM CALL
    ================================= */

    async function callBackendLLM(userText) {
      if (!BACKEND_URL) return;

      try {
        const res = await fetch(BACKEND_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: userText,
            engine: engineState.selected,
            belief: {
              enabled: beliefState.enabled,
              selected: beliefState.selected
            },
            reactor_state: reactorState
          })
        });

        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const raw = data.reply || data.answer || data.text || "";

        const wrapped =
          "Live emotional reasoning (reactor mode):\n\n" +
          "I am an artificial resonance reactor, creating synthetic emotions based on the basic theory of Alim ul Haq. " +
          "In this view, your current or temporary memory TM collides with your baseline or bold memory BM. " +
          "As this collision occurs, a new resultant emotion takes birth. I approximate this process mathematically using the AEC equation " +
          "and continuity lines, then try to answer you.\n\n" +
          raw;

        appendBubble("bot", wrapped, {
          category: "llm_reactor",
          emotion: "adaptive",
          polarity: "mixed",
          intensity: 0.5
        });

        speakIfEnabled(wrapped);
      } catch (err) {
        console.error("LLM backend error:", err);
        appendBubble(
          "bot",
          "(Live emotional reactor is offline right now, so I can only use my local seed answers.)",
          { category: "llm_error" }
        );
      }
    }

    /* ================================
       CHAT FLOW
    ================================= */

    function handleUserSubmit() {
      const { input } = getDomRefs();
      if (!input) return;

      const text = input.value.trim();
      if (!text) return;

      // user bubble
      appendBubble("user", text);
      input.value = "";

      // continuity slight increase
      reactorState.sigmaCt = Math.min(1, reactorState.sigmaCt + 0.02);
      updateMetersAndEquation();

      // 1) Seed / offline reply
      const { text: reply, meta } = chooseAnswer(text);
      appendBubble("bot", reply, meta);
      speakIfEnabled(reply);

      // 2) LLM reactor reply (async)
      callBackendLLM(text);
    }

    function wireChat() {
      const { input, sendBtn } = getDomRefs();
      if (sendBtn) {
        sendBtn.addEventListener("click", handleUserSubmit);
      }
      if (input) {
        input.addEventListener("keydown", function (ev) {
          if (ev.key === "Enter" && !ev.shiftKey) {
            ev.preventDefault();
            handleUserSubmit();
          }
        });
      }
    }

    function introMessage() {
      const hello =
        "Hello! ðŸ˜Š I am AURA-X Î© v1 â€” a synthetic emotional-continuity assistant.\n" +
        "Write anythingâ€¦ I will try to read it as both logic and feeling, then reply gently.";
      appendBubble("bot", hello, {
        category: "greeting",
        emotion: "warmth",
        polarity: "positive",
        intensity: 0.3
      });
    }

    /* ================================
       OPTIONS / MODAL WIRING
    ================================= */

    function wireOptionsAndBelief() {
      const optionsBtn = document.getElementById("optionsButton");
      if (optionsBtn) {
        optionsBtn.addEventListener("click", () => openModal("optionsModal"));
      }

      document.querySelectorAll(".modal-close").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-close");
          if (id) closeModal(id);
        });
      });

      const faithToggle = document.getElementById("faithToggle");
      if (faithToggle) {
        faithToggle.addEventListener("click", toggleFaith);
      }

      const voiceToggleEl = document.getElementById("voiceToggle");
      if (voiceToggleEl) {
        voiceToggleEl.addEventListener("click", toggleVoice);
      }

      renderBeliefChips();
      renderEngineChips();
      setToggle("faithToggle", beliefState.enabled);
      setToggle("voiceToggle", voiceState.enabled);
      updateEngineLabel();
    }

    /* ================================
       INIT
    ================================= */

    function initAuraX() {
      updateMetersAndEquation();
      wireChat();
      wireOptionsAndBelief();
      introMessage();
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initAuraX);
    } else {
      initAuraX();
    }
  })();
  </script>
</body>
</html>
