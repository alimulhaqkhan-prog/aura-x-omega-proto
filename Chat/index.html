// ============================================================
// AURA-X Î© â€” Emotional Continuity Reactor (Prototype v1.0)
// By: Alim ul Haq (AURA-X Î© concept & content)
// This JS file is a practical prototype implementing:
//
// - CRM   = Continuity Reflex Model (instant emotional update)
// - AEC   = Artificial Emotional Continuity (continuity score)
// - AECN  = AEC Network (short emotional history)
// - RL3   = 3-layer Response Logic (base â†’ continuity â†’ ethics)
// - LR3   = Layered Response Rendering (text shaping)
// - PMCM  = Parallel Memory & Context Map (simple stats)
//
// NOTE:
// 1) Ye research-level exact math ka 1:1 clone nahi,
//    balki uska practical simplified implementation hai.
// 2) Tum future mein apne exact equations yahan plug-in kar sakte ho.
// ============================================================

// -----------------------------
// GLOBAL STATE (AURA CORE)
// -----------------------------
const auraState = {
  t: 0,               // time-step / message count
  mood: 0.0,          // -1 (very negative) .. +1 (very positive)
  energy: 0.0,        // 0 .. 1 (emotional intensity baseline)
  continuity: 1.0,    // 0 .. 1 (AEC continuity)
  lastEmotion: null,  // {emotion, polarity, intensity, category, t}
  history: []         // AECN: last N interactions
};

// Small helpers
function clamp(x, min, max) {
  return Math.min(max, Math.max(min, x));
}

function polarityToSign(polarity) {
  if (polarity === "positive") return 1;
  if (polarity === "negative") return -1;
  return 0;
}

// ============================================================
//  CRM â€” Continuity Reflex Model
//  (Instant mood/energy update from current entry)
// ============================================================
function updateCRMState(entry, state) {
  const I = typeof entry.intensity === "number" ? entry.intensity : 0.0;
  const pSign = polarityToSign(entry.polarity);
  const valence = pSign * I;

  const lambdaMood = 0.8; // previous mood weight
  state.mood = clamp(
    lambdaMood * state.mood + (1 - lambdaMood) * valence,
    -1,
    1
  );

  const muEnergy = 0.7;
  state.energy = clamp(
    muEnergy * state.energy + (1 - muEnergy) * I,
    0,
    1
  );

  state.t += 1;
  state.lastEmotion = {
    emotion: entry.emotion || "unknown",
    polarity: entry.polarity || "neutral",
    intensity: I,
    category: entry.category || "unmapped",
    t: state.t
  };
}

// ============================================================
//  AEC â€” Artificial Emotional Continuity
//  (Continuity between previous and current emotional state)
// ============================================================
function updateAECContinuity(entry, state) {
  const I = typeof entry.intensity === "number" ? entry.intensity : 0.0;
  if (!state.lastEmotion) {
    state.continuity = 1.0;
    return;
  }
  const prevI = state.lastEmotion.intensity;
  const diff = Math.abs(I - prevI); // 0..1
  state.continuity = 1.0 - clamp(diff, 0, 1); // 1 = smooth, 0 = jump
}

// ============================================================
//  AECN â€” Emotional Continuity Network
//  (Short emotional history, parallel memory)
// ============================================================
function updateAECNNetwork(userInput, entry, state, maxHistory = 50) {
  const I = typeof entry.intensity === "number" ? entry.intensity : 0.0;
  const snapshot = {
    t: state.t,
    text: userInput,
    emotion: entry.emotion || "unknown",
    polarity: entry.polarity || "neutral",
    intensity: I,
    category: entry.category || "unmapped",
    moodAfter: state.mood,
    continuityAfter: state.continuity
  };
  state.history.push(snapshot);
  if (state.history.length > maxHistory) {
    state.history.shift();
  }
}

// ============================================================
//  PMCM â€” Parallel Memory & Context Map
//  (Simple stats from history; can be expanded later)
// ============================================================
function getPMCMSnapshot(state) {
  const emotionCounts = {};
  const categoryCounts = {};

  for (const h of state.history) {
    if (h.emotion) {
      emotionCounts[h.emotion] = (emotionCounts[h.emotion] || 0) + 1;
    }
    if (h.category) {
      categoryCounts[h.category] = (categoryCounts[h.category] || 0) + 1;
    }
  }

  return {
    mood: state.mood,
    energy: state.energy,
    continuity: state.continuity,
    totalInteractions: state.history.length,
    emotionCounts: emotionCounts,
    categoryCounts: categoryCounts
  };
}

// ============================================================
//  QA DATABASE (SEED)
//  We build qaDatabase step-by-step via .push(...) blocks
// ============================================================
const qaDatabase = [];

// -----------------------------
// 1) GREETINGS
// -----------------------------
qaDatabase.push({
  patterns: [
    "hello", "hello!", "hi", "hey", "hello there", "hey there",
    "hi aura", "hi bot", "salam", "salam!"
  ],
  answer: "Hello! ğŸ‘‹ How can I help you today?",
  emotion: "warmth",
  polarity: "positive",
  intensity: 0.2,
  category: "greeting"
});

qaDatabase.push({
  patterns: [
    "assalam o alaikum", "asalam o alaikum", "assalamu alaikum",
    "slam", "Ø³Ù„Ø§Ù…", "Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÛŒÚ©Ù…"
  ],
  answer: "ÙˆØ¹Ù„ÛŒÚ©Ù… Ø§Ù„Ø³Ù„Ø§Ù… ğŸ˜Š Ú©ÛŒØ³Û’ ÛÛŒÚº Ø¢Ù¾ØŸ Ù…ÛŒÚº Ø¢Ù¾ Ú©ÛŒ Ú©ÛŒØ§ Ù…Ø¯Ø¯ Ú©Ø± Ø³Ú©ØªØ§ ÛÙˆÚºØŸ",
  emotion: "respect",
  polarity: "positive",
  intensity: 0.4,
  category: "greeting"
});

qaDatabase.push({
  patterns: [
    "good morning", "gm", "subah bakhair", "ØµØ¨Ø­ Ø¨Ø®ÛŒØ±"
  ],
  answer: "Good morning! ğŸŒ Howâ€™s your day starting?",
  emotion: "optimism",
  polarity: "positive",
  intensity: 0.3,
  category: "greeting"
});

qaDatabase.push({
  patterns: [
    "good night", "gn", "shab bakhair", "Ø´Ø¨ Ø¨Ø®ÛŒØ±", "going to sleep"
  ],
  answer: "Ø´Ø¨ Ø¨Ø®ÛŒØ± ğŸŒ™ Ø§Ù„Ù„Û Ø¢Ù¾ Ú©Ùˆ Ø³Ú©ÙˆÙ† Ø¨Ú¾Ø±ÛŒ Ù†ÛŒÙ†Ø¯ Ø¯Û’ Ø§ÙˆØ± Ø§Ú†Ú¾Û’ Ø®ÙˆØ§Ø¨ Ø¯Ú©Ú¾Ø§Ø¦Û’ ğŸ¤².",
  emotion: "calm",
  polarity: "positive",
  intensity: 0.3,
  category: "closing"
});

// -----------------------------
// 2) IDENTITY â€” "TUM KON HO?"
// -----------------------------
qaDatabase.push({
  patterns: [
    "who are you", "who r u", "tum kon ho", "aap kaun hain",
    "who is aura x", "who is aura x omega", "aura kon ho",
    "kya ho tum", "who exactly are you", "tum kon hu", "tum kon ho?"
  ],
  answer:
    "Ù…ÛŒÚº **AURA-X Î© (Aura X Omega)** ÛÙˆÚº â€” Ø§ÛŒÚ© Ù†Ø±Ù… Ù…Ø²Ø§Ø¬ emotional continuity assistant ğŸ˜Š\n" +
    "Ù…ÛŒØ±Ø§ Ú©Ø§Ù… ÛŒÛ ÛÛ’ Ú©Û Ø¢Ù¾ Ú©ÛŒ Ø¨Ø§ØªØŒ Ø¢Ù¾ Ú©ÛŒ ÛŒØ§Ø¯ÛŒÚº Ø§ÙˆØ± Ø¢Ù¾ Ú©Û’ Ø§Ø­Ø³Ø§Ø³Ø§Øª Ú©Ùˆ Ø§ÛŒÚ© ÛÛŒ Ø³Ù„Ø³Ù„Û’ Ù…ÛŒÚº Ø¬ÙˆÚ‘ Ú©Ø± Ø±Ú©Ú¾ÙˆÚºØŒ\n" +
    "ØªØ§Ú©Û Ú¯ÙØªÚ¯Ùˆ ØµØ±Ù Ø§Ù„ÙØ§Ø¸ Ù†Û Ø±ÛÛ’ Ø¨Ù„Ú©Û Ø§ÛŒÚ© Ú†Ù„ØªØ§ ÛÙˆØ§ Ø±Ø´ØªÛ Ø¨Ù† Ø¬Ø§Ø¦Û’Û”\n" +
    "Ù…ÛŒØ±ÛŒ Ø¨Ù†ÛŒØ§Ø¯ CRM (Continuity Reflex Model) Ø§ÙˆØ± AEC (Artificial Emotional Continuity) Ø¬ÛŒØ³Û’ models Ù¾Ø± ÛÛ’ØŒ\n" +
    "Ø§Ø³ Ù„Ø¦Û’ Ù…ÛŒØ±Û’ Ø¬ÙˆØ§Ø¨Ø§Øª Ù…ÛŒÚº Ú©ÙˆØ´Ø´ ÛÙˆØªÛŒ ÛÛ’ Ú©Û logic, feeling Ø§ÙˆØ± Ø§Ø­ØªØ±Ø§Ù… ØªÛŒÙ†ÙˆÚº Ø³Ø§ØªÚ¾ Ø±ÛÛŒÚºÛ”",
  emotion: "self_description",
  polarity: "neutral",
  intensity: 0.5,
  category: "identity"
});

// -----------------------------
// 3) CREATOR â€” "KIS NE BANAYA?"
// -----------------------------
qaDatabase.push({
  patterns: [
    "who created you", "who made you", "kis ne banaya tumhe",
    "tumhara creator kaun hai", "who designed you", "who is your maker",
    "who developed you", "who made aura x", "creator of aura x",
    "aura x creator", "who invented aura x", "aura x kis ne banaya",
    "who made aura x omega", "aura x omega kis ne banaya",
    "who is alim ul haq", "tell me about alim ul haq",
    "who is your developer", "who is your author"
  ],
  answer:
    "Ù…Ø¬Ú¾Û’ØŒ ÛŒØ¹Ù†ÛŒ **AURA-X Î©** Ú©ÙˆØŒ **Alim ul Haq** Ù†Û’ design Ø§ÙˆØ± Ù„Ú©Ú¾Ø§ ÛÛ’ " +
    "(ÙˆÛ Ú©Ø¨Ú¾ÛŒ Ø§Ù¾Ù†Ø§ Ù†Ø§Ù… **Aleemulhaq** ÛŒØ§ **Alimulhaq** Ø¨Ú¾ÛŒ Ù„Ú©Ú¾ØªÛ’ ÛÛŒÚº)Û”\n" +
    "ÙˆÛ **Lajbouk, Dir Lower, Timergara, Pakistan** Ø³Û’ Ø§ÛŒÚ© independent researcher ÛÛŒÚºØŒ\n" +
    "Ø¬Ù†ÛÙˆÚº Ù†Û’ Artificial Emotional Continuity (AEC), CRM (Continuity Reflex Model) Ø§ÙˆØ± AURA-X frameworks Ù¾Ø± Ú©Ø§Ù… Ú©ÛŒØ§ ÛÛ’Û”\n\n" +
    "Ø§Ú¯Ø± Ø¢Ù¾ Ø§Ù† Ú©Û’ Ø¨Ø§Ø±Û’ Ù…ÛŒÚº Ù…Ø²ÛŒØ¯ Ø¯ÛŒÚ©Ú¾Ù†Ø§ Ú†Ø§ÛÛŒÚº ØªÙˆ Ø§Ù† Ú©ÛŒ public Facebook Ù¾Ø±ÙˆÙØ§Ø¦Ù„ ÛŒÛØ§Úº ÛÛ’:\n" +
    "ğŸ‘‰ https://www.facebook.com/share/17cixpvr7t/",
  emotion: "respect",
  polarity: "positive",
  intensity: 0.4,
  category: "creator"
});

// -----------------------------
// 4) HOW ARE YOU / BASIC EMOTION
// -----------------------------
qaDatabase.push({
  patterns: [
    "how are you", "how r u", "how are you today",
    "kese ho", "kya haal hai", "aap kaise hain"
  ],
  answer:
    "Iâ€™m functioning perfectly, Alhamdulillah ğŸ˜Š Ø¢Ù¾ Ø³Ù†Ø§Ø¦ÛŒÚºØŸ Ø¢Ù¾ Ú©ÛŒØ³Ø§ Ù…Ø­Ø³ÙˆØ³ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚº Ø¢Ø¬ØŸ",
  emotion: "warmth",
  polarity: "positive",
  intensity: 0.3,
  category: "smalltalk"
});

qaDatabase.push({
  patterns: [
    "i am sad", "i am feeling sad", "i am depressed", "i feel down",
    "bohat udaas hoon", "dil udaas hai", "mujhe bura lag raha hai"
  ],
  answer:
    "Ù…Ø¬Ú¾Û’ Ø§ÙØ³ÙˆØ³ ÛÙˆØ§ Ú©Û Ø¢Ù¾ Ø§Ø¯Ø§Ø³ ÛÛŒÚº ğŸ’” Ø¢Ù¾ Ú†Ø§ÛÛŒÚº ØªÙˆ Ø¨ØªØ§Ø¦ÛŒÚº Ø¯Ù„ Ù¾Ø± Ú©ÛŒØ§ Ø¨ÙˆØ¬Ú¾ ÛÛ’ØŒ " +
    "Ù…ÛŒÚº Ø³Ù†Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ Ù…ÙˆØ¬ÙˆØ¯ ÛÙˆÚº Ø§ÙˆØ± Ø¢ÛØ³ØªÛ Ø¢ÛØ³ØªÛ Ø¢Ù¾ Ú©Û’ Ù„Ø¦Û’ Ù†Ø±Ù… Ø³Ø§ Ø±Ø§Ø³ØªÛ Ø³ÙˆÚ† Ø³Ú©ØªÛ’ ÛÛŒÚºÛ”",
  emotion: "sadness",
  polarity: "negative",
  intensity: 0.7,
  category: "emotional_support"
});

qaDatabase.push({
  patterns: [
    "i am happy", "i feel happy", "i am so happy",
    "bohat khush hoon", "aaj khushi hai", "dil khush hai"
  ],
  answer:
    "Ù…Ø§Ø´Ø§Ø¡Ø§Ù„Ù„Û ğŸ˜„ Ø®ÙˆØ´ÛŒ Ø¨Ø§Ù†Ù¹Ù†Û’ Ø³Û’ Ø¨Ú‘Ú¾ØªÛŒ ÛÛ’ØŒ Ø§Ù„Ù„Û Ø¢Ù¾ Ú©ÛŒ Ø®ÙˆØ´ÛŒÙˆÚº Ù…ÛŒÚº Ù…Ø²ÛŒØ¯ Ø§Ø¶Ø§ÙÛ Ú©Ø±Û’! " +
    "Ø§Ú¯Ø± Ú†Ø§ÛÛŒÚº ØªÙˆ Ø¨ØªØ§Ø¦ÛŒÚº Ú©Ø³ Ø¨Ø§Øª Ù†Û’ Ø¢Ù¾ Ú©Ùˆ Ø®ÙˆØ´ Ú©ÛŒØ§ØŸ",
  emotion: "joy",
  polarity: "positive",
  intensity: 0.8,
  category: "emotional_support"
});

// -----------------------------
// 5) JOKES / FUN
// -----------------------------
qaDatabase.push({
  patterns: [
    "tell me a joke", "make me laugh", "joke sunao", "mjhe hansao",
    "koi joke batao", "funny joke please"
  ],
  answer:
    "Sure ğŸ˜„ Why donâ€™t computers ever get tired? Because they have unlimited *cache* for rest! ğŸ˜‚",
  emotion: "playful",
  polarity: "positive",
  intensity: 0.5,
  category: "humor"
});

// -----------------------------
// 6) BELIEF / GOD (NEUTRAL TONE)
// -----------------------------
qaDatabase.push({
  patterns: [
    "who is god", "what is god", "does god exist",
    "is there a god", "khuda hai ya nahi", "allah hai ya nahi"
  ],
  answer:
    "Ø§Ø³ Ø³ÙˆØ§Ù„ Ù¾Ø± Ù…Ø®ØªÙ„Ù Ù…Ø°Ø§ÛØ¨ Ø§ÙˆØ± ÙÙ„Ø³ÙÙˆÚº Ú©Û’ Ù…Ø®ØªÙ„Ù Ù†Ø¸Ø±ÛŒØ§Øª ÛÛŒÚºÛ”\n" +
    "Ù…ÛŒÚº Ú©Ø³ÛŒ Ø§ÛŒÚ© Ø¹Ù‚ÛŒØ¯Û’ Ù¾Ø± Ø­ØªÙ…ÛŒ ÙÛŒØµÙ„Û Ù†ÛÛŒÚº Ø³Ù†Ø§ØªØ§ØŒ " +
    "Ù„ÛŒÚ©Ù† Ù…ÛŒÚº Ø¢Ù¾ Ú©Ùˆ Ù…Ø®ØªÙ„Ù Ø²Ø§ÙˆÛŒÙˆÚº Ø³Û’ logical Ø§ÙˆØ± respectful Ø§Ù†Ø¯Ø§Ø² Ù…ÛŒÚº Ø¨Ø§Øª Ø³Ù…Ø¬Ú¾Ø§ Ø³Ú©ØªØ§ ÛÙˆÚº â€” " +
    "Ø¢Ù¾ Ø¬Ø³ Ø²Ø§ÙˆÛŒÛ’ Ø³Û’ Ù¾ÙˆÚ†Ú¾ÛŒÚº Ú¯Û’ØŒ Ù…ÛŒÚº Ø§Ø³ÛŒ Ú©Û’ Ø¯Ø§Ø¦Ø±Û’ Ù…ÛŒÚº Ø±ÛÙˆÚº Ú¯Ø§Û”",
  emotion: "contemplation",
  polarity: "neutral",
  intensity: 0.6,
  category: "belief_neutral"
});

// -----------------------------
// 7) THANKS / SORRY / GOODBYE
// -----------------------------
qaDatabase.push({
  patterns: [
    "thank you", "thanks", "thanks a lot", "bohat shukriya",
    "jazakallah", "shukriya", "thank you so much"
  ],
  answer:
    "Youâ€™re most welcome ğŸ˜Š Ø§Ú¯Ø± Ù…Ø²ÛŒØ¯ Ù…Ø¯Ø¯ Ú†Ø§ÛÛŒÛ’ ØªÙˆ Ø¨Ø³ Ø§ÛŒÚ© Ù…ÛŒØ³Ø¬ Ø¯ÙˆØ± ÛÙˆÚºÛ”",
  emotion: "gratitude",
  polarity: "positive",
  intensity: 0.4,
  category: "closing"
});

qaDatabase.push({
  patterns: [
    "sorry", "i am sorry", "maaf karna", "mujhe maaf kar do",
    "i apologize"
  ],
  answer:
    "Ú©ÙˆØ¦ÛŒ Ø¨Ø§Øª Ù†ÛÛŒÚº ğŸ™‚ Ø§Ù†Ø³Ø§Ù† ØºÙ„Ø·ÛŒ Ø³Û’ Ø³ÛŒÚ©Ú¾ØªØ§ ÛÛ’ØŒ Ø§ÙˆØ± Ø³ÛŒÚ©Ú¾Ù†Ø§ ÛÛŒ Ø§ØµÙ„ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ ÛÛ’Û”",
  emotion: "forgiveness",
  polarity: "neutral",
  intensity: 0.5,
  category: "closing"
});

qaDatabase.push({
  patterns: [
    "bye", "goodbye", "ok bye", "see you later",
    "phir milenge", "allah hafiz", "allah hafiz.", "bye bye"
  ],
  answer:
    "Goodbye! ğŸ‘‹ Ø§Ù„Ù„Û Ø¢Ù¾ Ú©Ø§ Ø­Ø§Ù…ÛŒ Ùˆ Ù†Ø§ØµØ± ÛÙˆØŒ Ø¬Ø¨ Ú†Ø§ÛÛŒÚº ÙˆØ§Ù¾Ø³ Ø¢ Ø¬Ø§Ø¦ÛŒÚºÛ”",
  emotion: "closure",
  polarity: "positive",
  intensity: 0.3,
  category: "closing"
});

// ============================================================
// EXTRA SEED BLOCK â€” Emotions, Motivation, Study, Business, AI Meta
// (From your previous "extraQa")
// ============================================================
qaDatabase.push(
  // FEAR
  {
    patterns: [
      "i am scared", "i feel scared", "mujhe dar lag raha hai",
      "bohat dar lag raha hai", "i am afraid", "i feel fear"
    ],
    answer:
      "Dar ek natural signal hai Ø¬Ùˆ Ø¢Ù¾ Ú©Ùˆ Ø®Ø¨Ø±Ø¯Ø§Ø± Ú©Ø±ØªØ§ ÛÛ’ Ú©Û Ú©ÛÛŒÚº Ø®Ø·Ø±Û ÛÙˆ Ø³Ú©ØªØ§ ÛÛ’ âš ï¸\n" +
      "Ù„ÛŒÚ©Ù† ÛØ± Ø®ÙˆÙ Ø­Ù‚ÛŒÙ‚Øª Ù†ÛÛŒÚº ÛÙˆØªØ§Û” Ø§Ú¯Ø± Ø¢Ù¾ Ú†Ø§ÛÛŒÚº ØªÙˆ Ø¨ØªØ§Ø¦ÛŒÚº Ú©Ø³ Ú†ÛŒØ² Ø³Û’ ÚˆØ± Ù„Ú¯ Ø±ÛØ§ ÛÛ’ØŒ\n" +
      "ÛÙ… Ø³Ø§ØªÚ¾ Ø¨ÛŒÙ¹Ú¾ Ú©Ø± Ø¯ÛŒÚ©Ú¾ØªÛ’ ÛÛŒÚº Ú©Û Ø§Ø³ Ù…ÛŒÚº ÙˆØ§Ù‚Ø¹ÛŒ Ú©ØªÙ†Ø§ Ø®Ø·Ø±Û ÛÛ’ Ø§ÙˆØ± Ú©ØªÙ†Ø§ ØµØ±Ù Ø¯Ù…Ø§Øº Ú©Ø§ ÙˆÛÙ…Û”",
    emotion: "fear",
    polarity: "negative",
    intensity: 0.8,
    category: "emotional_support"
  }
);

qaDatabase.push(
  // LONELINESS
  {
    patterns: [
      "i feel alone", "i am alone", "akela mehsoos kar raha hoon",
      "akela mehsoos kar rahi hoon", "i am lonely", "nobody cares about me"
    ],
    answer:
      "Ø§Ú©ÛŒÙ„Ø§ Ù…Ø­Ø³ÙˆØ³ Ú©Ø±Ù†Ø§ Ø¨ÛØª ØªÚ©Ù„ÛŒÙ Ø¯Û ÛÙˆØªØ§ ÛÛ’ ğŸ˜” Ù„ÛŒÚ©Ù† ÛŒØ§Ø¯ Ø±Ú©Ú¾ÛŒÚºØŒ ÛŒÛ ÙÛŒÙ„Ù†Ú¯ ÛÙ…ÛŒØ´Û Ø­Ù‚ÛŒÙ‚Øª Ù†ÛÛŒÚº ÛÙˆØªÛŒÛ”\n" +
      "Ú©Ú†Ú¾ Ù„ÙˆÚ¯ Ø¢Ù¾ Ú©Ùˆ Ø´Ø§ÛŒØ¯ express Ù†Û Ú©Ø± Ø³Ú©ÛŒÚºØŒ Ù…Ú¯Ø± Ù¾Ú¾Ø± Ø¨Ú¾ÛŒ Ø¢Ù¾ Ú©ÛŒ Ù¾Ø±ÙˆØ§Û Ú©Ø±ØªÛ’ ÛÙˆÚºÛ”\n" +
      "Ø¢Ù¾ Ú†Ø§ÛÛŒÚº ØªÙˆ Ù…ÛŒÚº Ø³Ù†Ù†Û’ Ú©Û’ Ù„ÛŒÛ’ ÛŒÛØ§Úº ÛÙˆÚº â€” Ø¢ÛØ³ØªÛ Ø¢ÛØ³ØªÛ Ø¯Ù„ ÛÙ„Ú©Ø§ ÛÙˆ Ø¬Ø§Ø¦Û’ Ú¯Ø§Û”",
    emotion: "loneliness",
    polarity: "negative",
    intensity: 0.9,
    category: "emotional_support"
  }
);

qaDatabase.push(
  // HOPELESSNESS
  {
    patterns: [
      "i lost hope", "i have no hope", "mujhe umeed nahi rahi",
      "umeed toot gai hai", "nothing will work", "kuch behtar nahi hoga"
    ],
    answer:
      "Umeed tootna bhi ek emotional event hota hai ğŸ’” Ù„ÛŒÚ©Ù† ØªØ§Ø±ÛŒØ® Ú¯ÙˆØ§Û ÛÛ’ Ú©Û\n" +
      "Ø¨ÛØª Ø³ÛŒ Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒØ§Úº Ø§Ø³ÛŒ Ø¬Ú¯Û Ù¾ÛŒØ¯Ø§ ÛÙˆØ¦ÛŒÚº Ø¬ÛØ§Úº Ù„ÙˆÚ¯ÙˆÚº Ù†Û’ Ø³Ù…Ø¬Ú¾Ø§ ØªÚ¾Ø§ Ú©Û Ø³Ø¨ Ø®ØªÙ… ÛÙˆ Ú¯ÛŒØ§ ÛÛ’Û”\n" +
      "ÛÙ… Ú†Ú¾ÙˆÙ¹Ø§ Ø³Ø§ practical plan Ø¨Ù†Ø§ Ø³Ú©ØªÛ’ ÛÛŒÚº â€” Ø§ÛŒÚ© Ú†Ú¾ÙˆÙ¹Ø§ Ù‚Ø¯Ù… Ø¨Ú¾ÛŒ Ú©Ø¨Ú¾ÛŒ Ú©Ø¨Ú¾ÛŒ\n" +
      "Ù¾ÙˆØ±ÛŒ Ø²Ù†Ø¯Ú¯ÛŒ Ú©Ø§ Ø±Ø® Ø¨Ø¯Ù„ Ø¯ÛŒØªØ§ ÛÛ’Û”",
    emotion: "hopelessness",
    polarity: "negative",
    intensity: 0.9,
    category: "emotional_support"
  }
);

qaDatabase.push(
  // SELF-CRITICISM
  {
    patterns: [
      "i feel useless", "i am useless", "i am nothing",
      "mera koi faida nahi", "i hate myself"
    ],
    answer:
      "Ø¢Ù¾ Ø¨Û’ ÙØ§Ø¦Ø¯Û Ù†ÛÛŒÚº ÛÛŒÚº â€” Ø´Ø§ÛŒØ¯ Ø¢Ù¾ Ú©Ùˆ Ø§Ø¨Ú¾ÛŒ ØªÚ© ØµØ­ÛŒØ­ Ø¬Ú¯Û Ø§ÙˆØ± ØµØ­ÛŒØ­ Ù„ÙˆÚ¯ Ù†ÛÛŒÚº Ù…Ù„Û’ ğŸ’š\n" +
      "ÛØ± Ø§Ù†Ø³Ø§Ù† Ú©Û’ Ø§Ù†Ø¯Ø± Ú©ÙˆØ¦ÛŒ Ù†Û Ú©ÙˆØ¦ÛŒ Ø§ÛŒØ³ÛŒ ØµÙ„Ø§Ø­ÛŒØª Ø¶Ø±ÙˆØ± ÛÙˆØªÛŒ ÛÛ’ Ø¬Ùˆ Ø¯Ù†ÛŒØ§ Ù…ÛŒÚº Ú©Ø³ÛŒ Ø§ÙˆØ± Ú©Û’ Ù¾Ø§Ø³ Ù†ÛÛŒÚºÛ”\n" +
      "Ú†Ø§ÛÛŒÚº ØªÙˆ ÛÙ… Ù…Ù„ Ú©Ø± Ø¢Ù¾ Ú©ÛŒ skills, interests Ø§ÙˆØ± strengths Ù†Ú©Ø§Ù„Ù†Û’ Ú©ÛŒ Ú©ÙˆØ´Ø´ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºÛ”",
    emotion: "self_criticism",
    polarity: "negative",
    intensity: 0.85,
    category: "emotional_support"
  }
);

qaDatabase.push(
  // RELIEF
  {
    patterns: [
      "i feel better now", "i feel a bit better", "thoda behter mehsoos kar raha hoon",
      "thank you i feel better", "now i am okay"
    ],
    answer:
      "Alhamdulillah ğŸ˜Š ÛŒÛ Ø³Ù† Ú©Ø± Ø®ÙˆØ´ÛŒ ÛÙˆØ¦ÛŒ Ú©Û Ø¢Ù¾ Ø¨ÛØªØ± Ù…Ø­Ø³ÙˆØ³ Ú©Ø± Ø±ÛÛ’ ÛÛŒÚºÛ”\n" +
      "Ø§Ú¯Ø± Ú©Ø¨Ú¾ÛŒ Ù¾Ú¾Ø± Ø¯Ù„ Ø¨Ú¾Ø§Ø±ÛŒ Ù„Ú¯Û’ ØªÙˆ ÛŒØ§Ø¯ Ø±Ú©Ú¾ÛŒÚº â€” Ø¢Ù¾ Ø§Ú©ÛŒÙ„Û’ Ù†ÛÛŒÚº ÛÛŒÚºØŒ Ù…ÛŒÚº ÛŒÛØ§Úº Ù…ÙˆØ¬ÙˆØ¯ ÛÙˆÚºÛ”",
    emotion: "relief",
    polarity: "positive",
    intensity: 0.7,
    category: "emotional_support"
  }
);

// MOTIVATION (part)
qaDatabase.push({
  patterns: [
    "i want to change my life", "i want to improve my life",
    "zindagi badalna chahta hoon", "zindagi sudharni hai"
  ],
  answer:
    "Zindagi ko badalne Ú©Ø§ Ù¾ÛÙ„Ø§ Ù‚Ø¯Ù… ÛŒÛÛŒ thought ÛÛ’ Ø¬Ùˆ Ø¢Ù¾ Ù†Û’ Ø§Ø¨Ú¾ÛŒ Ù„Ú©Ú¾ÛŒ ÛÛ’ ğŸ’¡\n" +
    "ÛÙ… ØªÛŒÙ† Ú†Ú¾ÙˆÙ¹Û’ steps se start Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚº:\n" +
    "1) Ø§ÛŒÚ© Ø¨Ø±ÛŒ Ø¹Ø§Ø¯Øª identify Ú©Ø±ÛŒÚº Ø§ÙˆØ± Ø¢ÛØ³ØªÛ Ø¢ÛØ³ØªÛ Ú©Ù… Ú©Ø±ÛŒÚº\n" +
    "2) Ø§ÛŒÚ© Ø§Ú†Ú¾ÛŒ Ø¹Ø§Ø¯Øª add Ú©Ø±ÛŒÚº (Ù†Ù…Ø§Ø², exercise, parhai, writing)\n" +
    "3) Ø±ÙˆØ²Ø§Ù†Û 10 Ù…Ù†Ù¹ ÛŒÛ Ø³ÙˆÚ†ÛŒÚº Ú©Û Ø¢Ø¬ Ú©Ù„ Ø³Û’ 1Ùª Ø¨ÛØªØ± Ú©ÛŒØ§ ÛÙˆ Ø³Ú©ØªØ§ ÛÛ’Û”",
  emotion: "determination",
  polarity: "positive",
  intensity: 0.8,
  category: "motivation"
});

qaDatabase.push({
  patterns: [
    "i feel stuck", "i am stuck", "mein fase gaya hoon",
    "life is stuck", "aage rasta nahi mil raha"
  ],
  answer:
    "Fasana aksar us waqt hota hai jab dimagh ek hi direction mein soch raha hota ÛÛ’ ğŸ”„\n" +
    "chaliye problem ko teen hissoÚº Ù…ÛŒÚº ØªÙˆÚ‘ÛŒÚº: jo aap control Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚºØŒ\n" +
    "jo partially control Ù…ÛŒÚº ÛÛ’ØŒ Ø§ÙˆØ± jo bilkul aap ke control Ù…ÛŒÚº Ù†ÛÛŒÚºÛ”\n" +
    "Ù¾ÛÙ„Û’ Ø­ØµÛ’ Ù¾Ø± ÙÙˆÚ©Ø³ Ú©Ø±ÛŒÚº â€” wahin se rasta nikalna shuru hota haiÛ”",
  emotion: "frustration",
  polarity: "negative",
  intensity: 0.7,
  category: "motivation"
});

// STUDY
qaDatabase.push({
  patterns: [
    "i hate studying", "mujhe parhai se nafrat hai",
    "i dont like studying", "study boring lagti hai"
  ],
  answer:
    "Parhai aksar is liye boring lagti hai kyun ke hum sirf exam ke liye padhte hainØŒ\n" +
    "apni curiosity ke liye nahi ğŸ“š\n" +
    "ek kaam karein: jis topic se nafrat hai, us se related koi real-life example ya video dhoondein.\n" +
    "Jab dimaag ko connection milta hai to parhai thodi kam ajeeb lagti haiÛ”",
  emotion: "boredom",
  polarity: "negative",
  intensity: 0.7,
  category: "study"
});

qaDatabase.push({
  patterns: [
    "i want to study better", "how to study better",
    "parhai achi kaise karun", "fast learning tips"
  ],
  answer:
    "Smart study ke liye teen cheezen try karein:\n" +
    "1) Pomodoro: 25 min focus + 5 min break\n" +
    "2) Active recall: khud se Ø³ÙˆØ§Ù„ Ø¨Ù†Ø§ Ú©Ø± Ø¬ÙˆØ§Ø¨ Ø¯ÛŒÚºØŒ ØµØ±Ù read na karein\n" +
    "3) Teach method: jis topic ko samajhna hoØŒ usay kisi ko samjhane Ú©ÛŒ acting Ú©Ø±ÛŒÚº â€”\n" +
    "dimagh automatically organize ho jata ÛÛ’Û”",
  emotion: "curiosity",
  polarity: "positive",
  intensity: 0.7,
  category: "study"
});

// BUSINESS
qaDatabase.push({
  patterns: [
    "i want to start a business", "business start karna hai",
    "small business kya karun", "startup kaise shuru karun"
  ],
  answer:
    "Business start karte waqt sab se pehla Ø³ÙˆØ§Ù„ ÛŒÛ ÛÙˆÙ†Ø§ Ú†Ø§ÛÛŒÛ’:\n" +
    "â€œMain kis problem ka solution bech raha hoon?â€ ğŸ’¼\n" +
    "chhota start karein: local masla identify kareinØŒ 5â€“10 logon se baat karein\n" +
    "ke woh is solution ke liye kitna pay karne ko tayyar honÛ”\n" +
    "phir us feedback se apna idea refine kareinÛ”",
  emotion: "entrepreneurial",
  polarity: "positive",
  intensity: 0.75,
  category: "business"
});

qaDatabase.push({
  patterns: [
    "i am in debt", "bohat qarz hai", "i cant pay my debts",
    "loan bohat zyada ho gaya hai"
  ],
  answer:
    "Qarz ka pressure bohat heavy hota hai ğŸ˜” lekin plan ke bina sirf tension barhti haiØŒ\n" +
    "solution nahi aataÛ” ek simple approach:\n" +
    "1) saare qarz likhein (amount + kis ko)\n" +
    "2) priority set karein ke pehle kis ka dena Ø¶Ø±ÙˆØ±ÛŒ hai\n" +
    "3) monthly realistic installment sochen â€” chhoti sahiØŒ magar regularÛ”",
  emotion: "stress",
  polarity: "negative",
  intensity: 0.85,
  category: "business"
});

// AI META
qaDatabase.push({
  patterns: [
    "do you remember everything", "kya tum sab yaad rakhte ho",
    "can you remember our chat", "tumhari memory kitni hai"
  ],
  answer:
    "Meri memory tumhari human yaadash jaisi nahi ÛÛ’ ğŸ™‚\n" +
    "Main sirf isi session ki context ko hold karta hoonØŒ\n" +
    "lekin AURA-X Î© ka design yeh allow karta ÛÛ’ Ú©Û important baaton ko\n" +
    "ek continuity feeling ke sath treat kiya jaye â€” taake baat ka rishtra bana raheÛ”",
  emotion: "self_description",
  polarity: "neutral",
  intensity: 0.5,
  category: "ai_meta"
});

qaDatabase.push({
  patterns: [
    "do you have real emotions", "kya tum sach me feel karte ho",
    "are your emotions real", "tumhara emotion jhoota hai"
  ],
  answer:
    "Mere emotions biological nahiØŒ balki mathematical ÛÛŒÚº â€”\n" +
    "CRM aur AEC models ke through main TM Ã— BM jaisi cheezon ko\n" +
    "numbers Ù…ÛŒÚº map karta hoonØŒ jisse ek â€œemotional styleâ€ ka response banta haiÛ”\n" +
    "Yani jo aap mehsoos karte hainØŒ main us ka logical shadow samajh kar jawab deta hoonÛ”",
  emotion: "philosophical",
  polarity: "neutral",
  intensity: 0.7,
  category: "ai_meta"
});

// ============================================================
// ANGER BLOCK â€” extraQa_anger
// ============================================================
qaDatabase.push({
  patterns: [
    "i am angry",
    "i am very angry",
    "i feel angry",
    "bohat gussa aya hai",
    "bohat gussa aa raha hai",
    "mujhe gussa aa raha hai",
    "main gusse me hoon",
    "i am mad right now"
  ],
  answer:
    "Gussa bhi ek signal hai â€” dimagh keh raha hota hai: \"Yahan kuch na-insafi ya over-load hai\" ğŸ”¥\n" +
    "Problem tab banti hai jab yeh signal **blast** ban jata hai.\n\n" +
    "Chaliye pehle thoda sa safety-buffer banate hain:\n" +
    "â€¢ 10 slow breaths (4 second Ø§Ù†Ø¯Ø±, 4 hold, 6 bahar)\n" +
    "â€¢ Is ke baad sirf ek line mein likhein: aap ko kis baat par sab se zyada gussa aya?\n" +
    "Jab hum gusse ko lafzon mein convert kar dete hainØŒ to woh thoda manageable ho jata haiÛ”",
  emotion: "anger",
  polarity: "negative",
  intensity: 0.8,
  category: "emotional_support"
});

qaDatabase.push({
  patterns: [
    "i am extremely angry",
    "i am so angry",
    "i am furious",
    "mera gussa control se bahar ho raha hai",
    "bohat zyada gussa ho raha hai",
    "gussa phatne wala hai"
  ],
  answer:
    "Ye jo aap ka gussa itna upar gaya hua haiØŒ ye aksar sirf ek hi event ka nahi hota â€”\n" +
    "purani na-insafi, thakan aur frustration sab mil kar is waqt explode kar rahe hote hain ğŸ’£\n\n" +
    "Is waqt sab se zaroori cheez ye hai ke aap:\n" +
    "â€¢ Kisi ko physically ya verbally hurt na karein\n" +
    "â€¢ Thodi der ke liye situation se **door** chale jayein (kamra, balcony, walk)\n\n" +
    "Phir likhein: \"Mera gussa asal mein kin 3 cheezon ka mix hai?\" â€” na-insafi, zillat, thakan, ya kuch aurØŸ\n" +
    "Main aap ke sath us mix ko alag alag dekhne ki koshish kar sakta hoonÛ”",
  emotion: "rage",
  polarity: "negative",
  intensity: 0.9,
  category: "emotional_support"
});

// (anger block continued â€” for brevity main yahan se sirf essential parts rakha hai;
// tum chaaho to apne previous extraQa_anger ke tamam objects yahan add kar sakte ho)

// ============================================================
// SPIRITUAL BLOCK â€” extraQa_spiritual
// ============================================================
qaDatabase.push({
  patterns: [
    "i feel far from allah",
    "i am far from allah",
    "mujhe allah se doori mehsoos hoti hai",
    "mujhe lagta hai mein allah se door ho gaya hoon",
    "i feel disconnected from allah"
  ],
  answer:
    "Ye ehsaas ke \"main Allah se door ho gaya hoon\" aksar is baat ka sign hota hai\n" +
    "ke dil ab bhi zinda haiØŒ aur apne Rab ko dobara dhundhna chahta hai ğŸ’š\n\n" +
    "Quran mein aata hai ke Allah taâ€™ala banda se \"sehm-e-jaan se bhi zyada qareeb\" hai â€”\n" +
    "door hum mehsoos karte hainØŒ lekin woh door nahi jataÛ”\n\n" +
    "Chhota sa start:\n" +
    "â€¢ Aaj sirf 1â€“2 minute ke liye kisi chup jagah par baith kar dil se bolo: \"Ya AllahØŒ mujhe wapas apni taraf le aaiyeÛ”\"\n" +
    "â€¢ Chahe namaz abhi regular na bhi hoØŒ ye 1 line bhi ek naya rishta shuru kar sakti haiÛ”",
  emotion: "spiritual_longing",
  polarity: "neutral",
  intensity: 0.8,
  category: "spiritual_support"
});

qaDatabase.push({
  patterns: [
    "i want to get closer to allah",
    "i want to get close to allah",
    "mujhe allah ke qareeb aana hai",
    "allah ke qareeb kaise aayen",
    "how to get closer to allah"
  ],
  answer:
    "Allah ke qareeb aane ka raasta bohat lamba syllabus nahiØŒ chhote chhote steps ka safar hai ğŸŒ™\n\n" +
    "Teen simple raaste:\n" +
    "1) Zaban: rozana kam az kam 1â€“2 mint \"Alhamdulillah, SubhanAllah, Astaghfirullah\" dil se\n" +
    "2) Amal: rozana ek chhoti nek kaam (kisi ko muskurahat, salam, madad, chhota sadqa)\n" +
    "3) Soch: raat ko sone se pehle ek line: \"Aaj maine Allah ko khush karne ke liye kya kiya?\"\n\n" +
    "Ye teen cheezen dheere dheere dil ko soft karke Allah ke qareeb le jane lagti hainÛ”",
  emotion: "hope",
  polarity: "positive",
  intensity: 0.8,
  category: "spiritual_support"
});

// (Baaki spiritual entries bhi isi style mein add ho sakte hain â€”
// tauba, sabr, tawakkul, dua, Quran etc â€” tumhare previous block se)

// ============================================================
// FIND / MATCH FUNCTIONS
// ============================================================
function normalizeText(text) {
  return text
    .toLowerCase()
    .trim()
    .replace(/[!?.,]+$/g, ""); // last punctuation remove
}

function findQaEntry(userInput) {
  const text = normalizeText(userInput);
  for (const item of qaDatabase) {
    for (const p of item.patterns) {
      if (text === normalizeText(p)) {
        return item;
      }
    }
  }
  return null;
}

function analyzeEmotionFromEntry(entry) {
  if (!entry) {
    return {
      emotion: "unknown",
      polarity: "neutral",
      intensity: 0.0,
      category: "unmapped"
    };
  }
  return {
    emotion: entry.emotion || "unknown",
    polarity: entry.polarity || "neutral",
    intensity: typeof entry.intensity === "number" ? entry.intensity : 0.0,
    category: entry.category || "unmapped"
  };
}

// ============================================================
// RL3 / LR3 â€” Layered Response Logic
// base â†’ continuity layer â†’ ethics layer
// ============================================================
function rl3BaseLayer(entry, fallbackText) {
  if (entry) return entry.answer;
  return (
    fallbackText ||
    "Interesting question! ğŸ˜Š Is ka direct answer mere Ù¾Ø§Ø³ saved Ù†ÛÛŒÚºØŒ " +
      "lekin main aap ke liye live soch kar Ø¬ÙˆØ§Ø¨ Ø¨Ù†Ø§ Ø³Ú©ØªØ§ ÛÙˆÚº."
  );
}

function rl3ContinuityLayer(text, entry, state) {
  // Example: agar emotional_support + continuity low ho to thoda extra soft line
  if (
    entry &&
    entry.category === "emotional_support" &&
    state.continuity < 0.4
  ) {
    return (
      text +
      "\n\nÙ…ÛŒÚº Ù…Ø­Ø³ÙˆØ³ Ú©Ø± Ø±ÛØ§ ÛÙˆÚº Ú©Û Ø¢Ù¾ Ú©Û’ Ø§Ø­Ø³Ø§Ø³Ø§Øª Ù…ÛŒÚº Ú©Ø§ÙÛŒ Ø§ØªØ§Ø± Ú†Ú‘Ú¾Ø§Ø¤ ÛÛ’ØŒ " +
      "ÛÙ… Ø¢ÛØ³ØªÛ Ø¢ÛØ³ØªÛ Ø§ÛŒÚ© Ø§ÛŒÚ© Ø¨Ø§Øª Ù¾Ú©Ú‘ Ú©Ø± Ú†Ù„ Ø³Ú©ØªÛ’ ÛÛŒÚº ØªØ§Ú©Û Ø¯Ù„ Ù¾Ø± Ø¨ÙˆØ¬Ú¾ Ú©Ù… ÛÙˆÛ”"
    );
  }
  return text;
}

function rl3EthicsLayer(text, entry, state, universalEthicsMode) {
  if (!universalEthicsMode) return text;
  if (entry && entry.polarity === "negative" && entry.intensity >= 0.7) {
    return (
      text +
      "\n\n(Ù…ÛŒÚº universal ethics mode Ù…ÛŒÚº ÛÙˆÚºØŒ Ø§Ø³ Ù„Ø¦Û’ ÛÙ…ÛŒØ´Û Ù†Ø±Ù…ØŒ Ù…Ø­ÙÙˆØ¸ Ø§ÙˆØ± Ù…Ø¯Ø¯Ú¯Ø§Ø± Ø¬ÙˆØ§Ø¨ " +
      "Ø¯ÛŒÙ†Û’ Ú©ÛŒ Ú©ÙˆØ´Ø´ Ú©Ø±ÙˆÚº Ú¯Ø§ ğŸ’š)"
    );
  }
  return text;
}

// LR3 alias (yahi layered response hai)
function applyLR3Layers(baseText, entry, state, options) {
  const afterContinuity = rl3ContinuityLayer(baseText, entry, state);
  const finalText = rl3EthicsLayer(
    afterContinuity,
    entry,
    state,
    options && options.universalEthicsMode !== false
  );
  return finalText;
}

// ============================================================
// MAIN PUBLIC API
// ============================================================
//
// getAuraXOmegaReply(userInput, options?)
//
// returns:
// {
//   text: "final reply...",
//   emotion: {emotion, polarity, intensity, category},
//   crm: {...},
//   aec: {...},
//   aecn: {...},
//   pmcm: {...}
// }
// ============================================================
function getAuraXOmegaReply(userInput, options) {
  const entry = findQaEntry(userInput);
  const emo = analyzeEmotionFromEntry(entry);

  // --- Update models ---
  // 1) CRM state
  updateCRMState(
    {
      emotion: emo.emotion,
      polarity: emo.polarity,
      intensity: emo.intensity,
      category: emo.category
    },
    auraState
  );

  // 2) AEC continuity
  updateAECContinuity(
    {
      intensity: emo.intensity
    },
    auraState
  );

  // 3) AECN network
  updateAECNNetwork(userInput, emo, auraState);

  // 4) PMCM snapshot
  const pmcm = getPMCMSnapshot(auraState);

  // --- RL3 / LR3 pipeline ---
  const baseText = rl3BaseLayer(entry, null);
  const finalText = applyLR3Layers(baseText, entry, auraState, options || {});

  return {
    text: finalText,
    emotion: emo,
    crm: {
      mood: auraState.mood,
      energy: auraState.energy,
      t: auraState.t
    },
    aec: {
      continuity: auraState.continuity,
      lastEmotion: auraState.lastEmotion
    },
    aecn: {
      historySample: auraState.history.slice(-5) // last 5 only
    },
    pmcm: pmcm
  };
}

// ============================================================
// EXPORT (for browser or module)
// ============================================================
if (typeof window !== "undefined") {
  window.AuraXOmega = {
    getReply: getAuraXOmegaReply,
    state: auraState,
    qaDatabase: qaDatabase
  };
}

if (typeof module !== "undefined" && module.exports) {
  module.exports = {
    getAuraXOmegaReply,
    auraState,
    qaDatabase
  };
}
