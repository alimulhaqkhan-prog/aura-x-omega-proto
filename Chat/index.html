<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Î© v1 â€“ Emotional Continuity Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f7;
      color: #111827;
      display: flex;
      justify-content: center;
    }
    #app {
      width: 100%;
      max-width: 800px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 12px;
    }
    .header-card {
      background: #ffffff;
      border-radius: 14px;
      padding: 12px 16px;
      margin-bottom: 8px;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.08);
    }
    .title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .title-row h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 650;
      letter-spacing: 0.03em;
    }
    .subtitle {
      font-size: 12px;
      color: #6b7280;
      margin-top: 2px;
    }
    .badge {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #e0f2fe;
      color: #0369a1;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }

    /* Continuity bar */
    .continuity-card {
      background: #ffffff;
      border-radius: 12px;
      padding: 8px 12px;
      margin-bottom: 8px;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.06);
      font-size: 11px;
    }
    .continuity-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }
    .continuity-label {
      font-weight: 600;
      color: #374151;
    }
    .continuity-metrics {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: #6b7280;
    }
    .continuity-bar {
      position: relative;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }
    .continuity-fill {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 40%;
      border-radius: inherit;
      transition: width 0.25s ease-out, background 0.25s ease-out;
    }

    /* Chat area */
    .chat-log {
      flex: 1;
      overflow-y: auto;
      padding: 8px 0;
    }
    .bubble-row {
      margin-bottom: 8px;
      display: flex;
    }
    .bubble-row.user { justify-content: flex-end; }
    .bubble-row.bot { justify-content: flex-start; }
    .bubble {
      max-width: 86%;
      padding: 10px 12px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.45;
      white-space: pre-wrap;
    }
    .bubble.user-bubble {
      background: #2563eb;
      color: #f9fafb;
      border-bottom-right-radius: 4px;
    }
    .bubble.bot-bubble {
      background: #ffffff;
      border-bottom-left-radius: 4px;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.06);
    }
    .meta-row {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 3px;
      margin-left: 4px;
    }

    .ethical-card {
      margin-top: 6px;
      background: #fef3c7;
      border-radius: 12px;
      padding: 8px 10px;
      font-size: 12px;
      color: #78350f;
      border: 1px solid #facc15;
    }
    .ethical-title {
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.06em;
      color: #92400e;
      margin-bottom: 3px;
      text-transform: uppercase;
    }

    /* Input area */
    .input-area {
      margin-top: 8px;
      padding-top: 4px;
      border-top: 1px solid #e5e7eb;
    }
    .input-row {
      display: flex;
      gap: 8px;
      align-items: flex-end;
      padding: 8px 0 10px;
    }
    .text-input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 10px 14px;
      font-size: 14px;
      outline: none;
      resize: none;
      min-height: 42px;
      max-height: 120px;
      background: #ffffff;
    }
    .text-input:focus {
      border-color: #fb923c;
      box-shadow: 0 0 0 1px rgba(248, 172, 98, 0.7);
    }
    .send-btn {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      background: linear-gradient(135deg, #fb923c, #f97316);
      color: white;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(249, 115, 22, 0.35);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .send-btn:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }
    .send-arrow { font-size: 13px; }

    /* Neeche wala text HIDDEN */
    .footer-line {
      font-size: 11px;
      color: #9ca3af;
      padding-bottom: 4px;
      display: none;
    }

    @media (max-width: 600px) {
      .header-card { border-radius: 0 0 16px 16px; }
      #app { padding: 0 8px 8px; }
    }
  </style>
</head>
<body>
<div id="app">
  <div class="header-card">
    <div class="title-row">
      <div>
        <h1>AURA-X Î© v1</h1>
        <div class="subtitle">Emotional Continuity Assistant</div>
      </div>
      <div class="badge">
        <span class="badge-dot"></span> Prototype Â· Seed + Continuity Equation
      </div>
    </div>
  </div>

  <!-- Live continuity bar with AEC/CRM style equation -->
  <div class="continuity-card">
    <div class="continuity-top">
      <div class="continuity-label">
        Continuity Â· Eâ‚€ = tanh((TM Ã— BM) âˆ’ D + Î»_faith + Î»_sys + Î£Câ‚œ)
      </div>
      <div id="continuityMetrics" class="continuity-metrics">
        TM:0.20 Â· BM:0.40 Â· D:0.20 Â· Î£Câ‚œ:0.00 Â· Eâ‚€:0.00
      </div>
    </div>
    <div class="continuity-bar">
      <div id="continuityFill" class="continuity-fill"></div>
    </div>
  </div>

  <!-- Chat log -->
  <div id="chatLog" class="chat-log"></div>

  <!-- Input area -->
  <div class="input-area">
    <div class="input-row">
      <textarea id="userInput" class="text-input"
                placeholder="Write anythingâ€¦ AURA-X will read it as logic + feeling."></textarea>
      <button id="sendBtn" class="send-btn">
        Send <span class="send-arrow">âž¤</span>
      </button>
    </div>
    <div class="footer-line" id="footerLine"></div>
  </div>
</div>

<script>
  // ================================
  // 1) PASTE YOUR FULL qaSeed HERE
  //    (exact block from your message)
  // ================================
  // Example:
  // const qaSeed = [ { patterns: [...], answer: "...", ... }, ... ];
  // ----> Copy-paste your entire block here <----

  // For now, to avoid syntax error if you open without pasting:
  const qaSeed = typeof qaSeed !== "undefined" ? qaSeed : [];

  // Use only this seed (no old 1200-seed at all)
  const qaDatabase = qaSeed;

  // ================================
  // 2) Belief / ethical snippets
  //    (simple Islamic examples)
  // ================================
  let beliefMode = "islamic"; // future: menu se change ho sakta hai

  const ethicalSnippets = [
    {
      key: "patience",
      matchCategories: ["emotional_support", "self_harm"],
      text: "â€œØ¥ÙÙ†Ù‘ÙŽ Ø§Ù„Ù„Ù‘ÙŽÙ‡ÙŽ Ù…ÙŽØ¹ÙŽ Ø§Ù„ØµÙ‘ÙŽØ§Ø¨ÙØ±ÙÙŠÙ†ÙŽâ€ â€” Surely Allah is with those who are patient. (Qurâ€™an 2:153)"
    },
    {
      key: "trust",
      matchCategories: ["emotional_positive", "capabilities", "theory"],
      text: "â€œÙˆÙŽÙ…ÙŽÙ† ÙŠÙŽØªÙŽÙˆÙŽÙƒÙ‘ÙŽÙ„Ù’ Ø¹ÙŽÙ„ÙŽÙ‰ Ù±Ù„Ù„Ù‘ÙŽÙ‡Ù ÙÙŽÙ‡ÙÙˆÙŽ Ø­ÙŽØ³Ù’Ø¨ÙÙ‡ÙÛ¥â€ â€” Whoever puts their trust in Allah, He is sufficient for them. (Qurâ€™an 65:3)"
    }
  ];

  function pickEthicalSnippet(entry) {
    if (beliefMode !== "islamic") return null;
    if (!entry || !entry.category) return null;

    // Simple mapping by category
    for (const snip of ethicalSnippets) {
      if (snip.matchCategories.includes(entry.category)) return snip;
    }
    return null;
  }

  // ================================
  // 3) Emotional continuity engine
  // ================================
  let TM = 0.2;       // trust memory
  let BM = 0.4;       // base mood
  let D  = 0.2;       // disturbance
  let lambdaFaith = 0.05;
  let lambdaSys   = 0.05;
  let contSum     = 0.0;

  function clamp01(x) {
    return Math.max(0, Math.min(1, x));
  }

  function updateStateFromEntry(entry) {
    if (!entry) return;

    const pol = entry.polarity || "neutral";
    const inten = entry.intensity || 0.3;

    if (pol === "positive") {
      BM = clamp01(BM + 0.06 * inten);
      D  = clamp01(D  - 0.04 * inten);
      contSum += 0.15 * inten;
    } else if (pol === "negative") {
      BM = clamp01(BM - 0.06 * inten);
      D  = clamp01(D  + 0.05 * inten);
      contSum -= 0.18 * inten;
    } else {
      contSum += 0.02 * inten;
    }

    // Trust memory slightly increases when system answers
    TM = clamp01(TM + 0.02);
    lambdaFaith = clamp01(lambdaFaith); // constant for now
    lambdaSys   = clamp01(lambdaSys);
    renderContinuity();
  }

  function computeE0() {
    const raw = Math.tanh((TM * BM) - D + lambdaFaith + lambdaSys + contSum);
    return raw; // -1 to +1
  }

  function renderContinuity() {
    const metricsEl = document.getElementById("continuityMetrics");
    const fillEl = document.getElementById("continuityFill");
    const E0 = computeE0();
    const norm = (E0 + 1) / 2; // 0..1

    metricsEl.textContent =
      `TM:${TM.toFixed(2)} Â· BM:${BM.toFixed(2)} Â· D:${D.toFixed(2)} Â· Î£Câ‚œ:${contSum.toFixed(2)} Â· Eâ‚€:${E0.toFixed(2)}`;

    fillEl.style.width = (norm * 100).toFixed(0) + "%";

    if (E0 > 0.25) {
      fillEl.style.background = "#22c55e";
    } else if (E0 < -0.25) {
      fillEl.style.background = "#ef4444";
    } else {
      fillEl.style.background = "#f97316";
    }
  }

  renderContinuity();

  // ================================
  // 4) Seed matcher
  // ================================
  function findQaEntry(message) {
    if (!message) return null;
    const text = message.toLowerCase().trim();

    let best = null;
    let bestScore = 0;

    for (const entry of qaDatabase) {
      if (!entry.patterns) continue;
      for (const p of entry.patterns) {
        const pat = p.toLowerCase();
        if (!pat) continue;
        // simple contains or exact match
        if (text === pat || text.includes(pat)) {
          const score = pat.length;
          if (score > bestScore) {
            bestScore = score;
            best = entry;
          }
        }
      }
    }
    return best;
  }

  // ================================
  // 5) Chat rendering
  // ================================
  const chatLog = document.getElementById("chatLog");
  const userInput = document.getElementById("userInput");
  const sendBtn = document.getElementById("sendBtn");

  function addBubble(role, content, meta, ethical) {
    const row = document.createElement("div");
    row.className = "bubble-row " + (role === "user" ? "user" : "bot");

    const container = document.createElement("div");
    container.style.maxWidth = "100%";

    if (meta) {
      const metaRow = document.createElement("div");
      metaRow.className = "meta-row";
      metaRow.textContent = meta;
      container.appendChild(metaRow);
    }

    const bubble = document.createElement("div");
    bubble.className = "bubble " + (role === "user" ? "user-bubble" : "bot-bubble");
    bubble.innerHTML = content;
    container.appendChild(bubble);

    if (ethical && ethical.text) {
      const eth = document.createElement("div");
      eth.className = "ethical-card";
      eth.innerHTML =
        `<div class="ethical-title">ETHICAL REFLECTION</div>${ethical.text}`;
      container.appendChild(eth);
    }

    row.appendChild(container);
    chatLog.appendChild(row);
    chatLog.scrollTop = chatLog.scrollHeight;
  }

  function systemGreeting() {
    addBubble(
      "bot",
      "Hello! ðŸ˜Š I am AURA-X Î© v1 â€” a synthetic emotional-continuity assistant.\n" +
      "Write anythingâ€¦ I will try to read it as logic + feeling, then reply gently.",
      "System greeting"
    );
  }

  systemGreeting();

  function handleUserMessage() {
    const text = userInput.value.trim();
    if (!text) return;
    userInput.value = "";
    addBubble("user", text, null);

    const entry = findQaEntry(text);
    if (entry) {
      updateStateFromEntry(entry);

      // bold markdown ** ** ko HTML <strong> me convert
      const safeAnswer = entry.answer.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
      const meta = `Seed: ${entry.category || "general"} Â· emotion=${entry.emotion || "neutral"} Â· intensity=${entry.intensity ?? "?"}`;
      const ethical = pickEthicalSnippet(entry);

      addBubble("bot", safeAnswer, meta, ethical);
    } else {
      // fallback: LLM-ready style neutral reply
      const fallback =
        "I am still a small prototype and I do not have a perfect seed answer for that yet.\n\n" +
        "But I can still listen and try to think with you. Can you explain your question " +
        "in a simpler or more emotional way?";
      updateStateFromEntry({
        polarity: "neutral",
        intensity: 0.3,
        category: "small_talk"
      });
      addBubble("bot", fallback, "Prototype fallback", null);
    }
  }

  sendBtn.addEventListener("click", handleUserMessage);
  userInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      handleUserMessage();
    }
  });
</script>
</body>
</html>
