<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Œ© ‚Äì Emotional Reactor</title>
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
/>

  <style>
    /* ===== Base Layout ===== */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      background: #020617;
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    #app {
      position: relative;
      width: 100%;
      max-width: 480px;
      height: 100vh;
      box-sizing: border-box;
      padding: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transform-origin: top center;
    }

    @media (max-height: 720px) {
      #app { transform: scale(0.82); }
    }
    @media (max-height: 640px) {
      #app { transform: scale(0.75); }
    }

    /* ===== Main Card ===== */
    .card {
      position: relative;
      width: 100%;
      max-width: 430px;
      background: radial-gradient(circle at top, #0b1220 0%, #020617 55%);
      border-radius: 28px;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.95);
      padding: 28px 22px 24px 22px;
      box-sizing: border-box;
      overflow: hidden;
    }

    .card-header {
      text-align: center;
      margin-bottom: 16px;
    }

    .title {
      font-size: 26px;
      letter-spacing: 0.12em;
      color: #facc15;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: #9ca3af;
    }

    .mode-line {
      margin-top: 18px;
      font-size: 13px;
      color: #e5e7eb;
    }
    .mode-label {
      color: #facc15;
      font-weight: 600;
    }

    .you-said {
      margin-top: 6px;
      font-size: 13px;
      color: #d1d5db;
    }

    /* ===== Sun / Moon Orb ===== */
    .orb-wrapper {
      margin-top: 10px;
      margin-bottom: 4px;
      display: flex;
      justify-content: center;
    }

    .orb {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #fef9c3, #f97316 55%, #b45309 100%);
      box-shadow: 0 0 40px rgba(251, 191, 36, 0.75),
                  0 0 90px rgba(250, 204, 21, 0.65);
      position: relative;
      cursor: pointer;
      transition: all 0.7s ease;
      animation: sunPulse 3.5s ease-in-out infinite;
    }

    @keyframes sunPulse {
      0%   { transform: scale(1);   box-shadow: 0 0 40px rgba(251, 191, 36, 0.7);}
      50%  { transform: scale(1.06);box-shadow: 0 0 70px rgba(250, 204, 21, 0.9);}
      100% { transform: scale(1);   box-shadow: 0 0 40px rgba(251, 191, 36, 0.7);}
    }

    /* moon animated */
    .orb.moon {
      background: radial-gradient(circle at 30% 25%, #e5e7eb, #6b7280 55%, #111827 100%);
      box-shadow: 0 0 15px rgba(191, 219, 254, 0.7),
                  0 0 45px rgba(59, 130, 246, 0.9);
      animation: moonGlow 4s ease-in-out infinite;
    }

    @keyframes moonGlow {
      0%   { box-shadow: 0 0 15px rgba(191, 219, 254, 0.5); }
      50%  { box-shadow: 0 0 40px rgba(129, 140, 248, 0.9); }
      100% { box-shadow: 0 0 15px rgba(191, 219, 254, 0.5); }
    }

    /* moon static (dim) */
    .orb.moon-dim {
      background: radial-gradient(circle at 30% 25%, #d1d5db, #4b5563 70%, #020617 100%);
      box-shadow: 0 0 10px rgba(148, 163, 184, 0.6);
      animation: none;
      opacity: 0.8;
    }

    /* hidden state */
    .orb.hidden {
      opacity: 0;
      box-shadow: none;
      pointer-events: none;
    }

    /* ===== Text blocks ===== */
    .assistant-text {
      margin-top: 12px;
      font-size: 15px;
      color: #f9fafb;
      text-align: left;
    }

    .ethics-box {
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(250, 204, 21, 0.35);
      color: #fde68a;
      font-size: 13px;
      line-height: 1.35;
    }

    .equation-box {
      margin-top: 10px;
      padding: 10px 12px 12px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px dashed rgba(148, 163, 184, 0.6);
      font-size: 11px;
      letter-spacing: 0.03em;
      color: #e5e7eb;
    }

    .equation-title {
      font-weight: 600;
      margin-bottom: 4px;
      color: #cbd5f5;
    }

    /* ===== FAB Main + Menu ===== */
    .fab-main {
      position: absolute;
      right: 18px;
      top: 96px;
      width: 46px;
      height: 46px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 30% 20%, #1f2937, #020617 80%);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s;
      z-index: 5;
    }

    .fab-main span {
      font-size: 18px;
    }

    .fab-main:hover {
      transform: translateY(-1px) scale(1.03);
      box-shadow: 0 14px 35px rgba(0, 0, 0, 0.8);
    }

    .fab-menu {
      position: absolute;
      right: 18px;
      top: 150px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      pointer-events: none;
    }

    .fab-menu.open {
      pointer-events: auto;
    }

    .fab-option {
      width: 42px;
      height: 42px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 30% 20%, #111827, #020617 80%);
      color: #e5e7eb;
      font-size: 16px;
      cursor: pointer;
      opacity: 0;
      transform: translateY(8px) scale(0.8);
      transition:
        opacity 0.18s ease,
        transform 0.18s ease,
        box-shadow 0.15s ease,
        background 0.15s ease;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
      pointer-events: none;
    }

    .fab-menu.open .fab-option {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    .fab-option.active {
      box-shadow: 0 0 18px rgba(52, 211, 153, 0.9);
      border-color: rgba(52, 211, 153, 0.9);
    }

    .fab-option:hover {
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.9);
    }

    /* ===== Seed buttons on left (L/T) ===== */
    .side-buttons-left {
      position: absolute;
      left: 18px;
      top: 150px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .side-btn {
      width: 42px;
      height: 42px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 30% 20%, #020617, #020617 90%);
      color: #e5e7eb;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.7);
    }

    .side-btn:hover {
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.9);
    }

    /* ===== Belief Modal ===== */
    .belief-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.82);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 30;
    }

    .belief-backdrop.show {
      display: flex;
    }

    .belief-modal {
      width: 100%;
      max-width: 440px;
      margin: 16px;
      background: radial-gradient(circle at top, #020617 0%, #020617 60%);
      border-radius: 26px;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.95);
      padding: 18px 18px 20px;
      box-sizing: border-box;
      color: #e5e7eb;
    }

    .belief-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .belief-title {
      font-size: 17px;
      font-weight: 600;
    }

    .belief-close {
      font-size: 14px;
      color: #9ca3af;
      cursor: pointer;
    }

    .belief-sub {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 10px;
    }

    .belief-banner {
      margin-bottom: 12px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(22, 163, 74, 0.12);
      border: 1px solid rgba(22, 163, 74, 0.6);
      font-size: 11px;
      color: #bbf7d0;
      text-align: center;
    }

    .faith-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .faith-pill {
      padding: 9px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      text-align: center;
      font-size: 13px;
      cursor: pointer;
      background: radial-gradient(circle at 30% 20%, #020617, #020617 90%);
      color: #e5e7eb;
    }

    .faith-pill.active {
      border-color: #22c55e;
      background: radial-gradient(circle at 30% 20%, #064e3b, #022c22 80%);
      color: #bbf7d0;
    }

    /* ===== Input bar ===== */
    .input-row {
      width: 100%;
      max-width: 430px;
      margin-top: 14px;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .input-box {
      flex: 1;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 999px;
      padding: 10px 16px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.9);
    }

    .input-box span.icon {
      font-size: 15px;
    }

    #userInput {
      flex: 1;
      border: none;
      outline: none;
      background: transparent;
      color: #e5e7eb;
      font-size: 14px;
    }

    #userInput::placeholder {
      color: #6b7280;
    }

    .send-btn {
      border: none;
      outline: none;
      background: radial-gradient(circle at 30% 20%, #facc15, #eab308 70%, #ca8a04 100%);
      color: #111827;
      font-weight: 600;
      font-size: 15px;
      padding: 11px 22px;
      border-radius: 999px;
      box-shadow: 0 18px 40px rgba(250, 204, 21, 0.55);
      cursor: pointer;
      min-width: 86px;
    }

    .send-btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 10px 26px rgba(250, 204, 21, 0.45);
    }
  </style>
</head>

<body>
  <div id="app">
    <div class="card">
      <div class="card-header">
        <div class="title">AURA-X Œ©</div>
        <div class="subtitle">
          LOGICAL ¬∑ EMOTIONAL ¬∑ UNIVERSAL ETHICS REACTOR
        </div>
      </div>

      <!-- Sun / Moon orb -->
      <div class="orb-wrapper">
        <div id="orb" class="orb" title="Tap to change state"></div>
      </div>

      <!-- Left small buttons (L / T) -->
      <div class="side-buttons-left">
        <div class="side-btn" id="btnLLMs" title="LLM list (coming soon)">L</div>
        <div class="side-btn" id="btnThemes" title="Themes (cycle)">T</div>
      </div>

      <!-- Floating main button + menu -->
      <div class="fab-main" id="fabMain" title="Options">
        <span>‚ò∞</span>
      </div>
      <div class="fab-menu" id="fabMenu">
        <div class="fab-option" id="btnBelief" title="Belief / Faith">B</div>
        <div class="fab-option" id="btnVoice" title="Voice on/off">V</div>
      </div>

      <div class="mode-line">
        Mode: <span class="mode-label" id="modeLabel">Universal Ethics</span>
      </div>
      <div class="you-said" id="youSaidLabel">You said: ‚Äú‚Äî‚Äù</div>

      <div class="assistant-text" id="assistantText">
        Hello! üëã How can I help you today?
      </div>

      <div class="ethics-box" id="ethicsBox">
        Universal Ethics says: avoid actions that create negative emotions in
        you or others, and gently move toward actions that create calm,
        kindness and positive feelings.
      </div>

      <div class="equation-box" id="equationBox">
        <div class="equation-title">EMOTIONAL CONTINUITY EQUATION</div>
        <div>E = M¬∑E‚Çö + K¬∑P¬∑C, &nbsp; P = t‚Çò + b‚Çò ‚àí d</div>
        <div id="equationValues">
          E = 0.26 | P = 0.04 | t‚Çò = 0.04 | b‚Çò = 0 | d = 0 | C = 0.45
        </div>
      </div>
    </div>

    <!-- Input row -->
    <form id="chatForm" class="input-row">
      <div class="input-box">
        <span class="icon">‚ú®</span>
        <input
          id="userInput"
          type="text"
          autocomplete="off"
          placeholder="Write anything‚Ä¶ AURA-X will feel it with you."
        />
      </div>
      <button class="send-btn" type="submit">Send</button>
    </form>
  </div>

  <!-- Belief modal -->
  <div class="belief-backdrop" id="beliefBackdrop">
    <div class="belief-modal">
      <div class="belief-header">
        <div class="belief-title">Belief settings</div>
        <div class="belief-close" id="beliefClose">Close</div>
      </div>
      <div class="belief-sub">
        Optional spiritual flavour on top of Universal Ethics.
      </div>
      <div class="belief-banner">
        Faith is optional ¬∑ Base rule is always Universal Ethics
      </div>
      <div class="belief-sub" style="margin-bottom: 12px;">
        Pick your faith to allow AURA-X to sometimes add short, gentle
        references from that tradition. Nothing is sent anywhere.
      </div>

      <div class="faith-grid" id="faithGrid">
        <button class="faith-pill" data-faith="Islam">Islam</button>
        <button class="faith-pill" data-faith="Christianity">Christianity</button>
        <button class="faith-pill" data-faith="Hinduism">Hinduism</button>
        <button class="faith-pill" data-faith="Buddhism">Buddhism</button>
        <button class="faith-pill" data-faith="Sikhism">Sikhism</button>
        <button class="faith-pill" data-faith="Judaism">Judaism</button>
        <button class="faith-pill" data-faith="Baha'i">Bah√°'√≠</button>
        <button class="faith-pill" data-faith="Jainism">Jainism</button>
        <button class="faith-pill" data-faith="Atheism">Atheism</button>
        <button class="faith-pill" data-faith="Other">Other</button>
      </div>
    </div>
  </div>

  <script>
    /* ========= Small-talk + QA database ========= */
    const qaDatabase = [
      {
        patterns: ["hello", "hello!", "hello there", "helo", "hallo"],
        answer: "Hello! üëã How can I help you today?"
      },
      {
        patterns: ["hi", "hi!", "hii", "hiii", "hey"],
        answer: "Hi there! üòä What can I do for you?"
      },
      {
        patterns: [
          "assalam o alaikum",
          "asalam o alaikum",
          "salam",
          "slam",
          "asalamu alaikum"
        ],
        answer:
          "ŸàÿπŸÑ€å⁄©ŸÖ ÿßŸÑÿ≥ŸÑÿßŸÖ üòä ⁄©€åÿ≥€í €Å€å⁄∫ ÿ¢Ÿæÿü ŸÖ€å⁄∫ ÿ¢Ÿæ ⁄©€å ⁄©€åÿß ŸÖÿØÿØ ⁄©ÿ± ÿ≥⁄©ÿ™ÿß €ÅŸà⁄∫ÿü"
      },
      {
        patterns: ["what is your name", "whats your name", "your name"],
        answer: "My name is AURA-X Œ©, your Emotional Continuity Assistant ü§ñ."
      },
      {
        patterns: ["who are you", "who r u", "aap kaun hain", "tum kon ho"],
        answer:
          "I‚Äôm AURA-X Œ© ‚Äî an AI assistant based on Emotional Continuity concepts created by Alim ul Haq Khan."
      },
      {
        patterns: ["how are you", "how r u", "kese ho", "kya haal hai"],
        answer:
          "I‚Äôm functioning perfectly, Alhamdulillah üòä ÿ¢Ÿæ ⁄©€åÿ≥€í €Å€å⁄∫ÿü"
      },
      {
        patterns: ["i am sad", "i am feeling sad", "i am depressed"],
        answer:
          "ŸÖÿ¨⁄æ€í ÿßŸÅÿ≥Ÿàÿ≥ €ÅŸàÿß ⁄©€Å ÿ¢Ÿæ ÿßÿØÿßÿ≥ €Å€å⁄∫ üíî ÿ¢Ÿæ ⁄Üÿß€Å€å⁄∫ ÿ™Ÿà ÿ®ÿ™ÿßÿ¶€å⁄∫ ÿØŸÑ Ÿæÿ± ⁄©€åÿß ÿ®Ÿàÿ¨⁄æ €Å€íÿå ŸÖ€å⁄∫ ÿ≥ŸÜŸÜ€í ⁄©€í ŸÑ€å€í ŸÖŸàÿ¨ŸàÿØ €ÅŸà⁄∫€î"
      },
      {
        patterns: ["i am happy", "i feel happy", "bohat khush hoon"],
        answer:
          "ŸÖÿßÿ¥ÿßÿ°ÿßŸÑŸÑ€Å üòÑ ÿÆŸàÿ¥€å ÿ®ÿßŸÜŸπŸÜ€í ÿ≥€í ÿ®⁄ë⁄æÿ™€å €Å€íÿå ÿßŸÑŸÑ€Å ÿ¢Ÿæ ⁄©€å ÿÆŸàÿ¥€åŸà⁄∫ ŸÖ€å⁄∫ ŸÖÿ≤€åÿØ ÿßÿ∂ÿßŸÅ€Å ⁄©ÿ±€í!"
      },
      {
        patterns: ["tell me a joke", "make me laugh", "joke sunao"],
        answer:
          "Sure üòÑ Why don‚Äôt computers ever get tired? Because they have unlimited *cache* for rest! üòÇ"
      },
      {
        patterns: ["what is aura x", "what is aura x omega", "aura x kya hai"],
        answer:
          "AURA-X Œ© ÿß€å⁄© Emotional Continuity Reactor idea €Å€í ÿ¨Ÿà memory + feeling ⁄©Ÿà mathematically model ⁄©ÿ±ŸÜ€í ⁄©€å ⁄©Ÿàÿ¥ÿ¥ ⁄©ÿ±ÿ™ÿß €Å€í."
      },
      {
        patterns: ["how old are you", "when were you born"],
        answer:
          "ŸÖ€å⁄∫ÿå AURA-X Œ©, ÿ™ŸÇÿ±€åÿ®ÿßŸã 2025 ⁄©€í ÿ¢ÿÆÿ± ŸÖ€å⁄∫ ÿßÿ≥ prototype ÿ¥⁄©ŸÑ ŸÖ€å⁄∫ Ÿæ€åÿØÿß €ÅŸàÿß €ÅŸà⁄∫ üòÑ ÿßÿ®⁄æ€å ÿ™Ÿà ÿ®⁄Ü€Å AI €ÅŸà⁄∫!"
      },
      {
        patterns: ["bye", "goodbye", "see you later", "phir milenge"],
        answer:
          "Goodbye! üëã ÿßŸÑŸÑ€Å ÿ¢Ÿæ ⁄©ÿß ÿ≠ÿßŸÖ€å Ÿà ŸÜÿßÿµÿ± €ÅŸàÿå ÿ¨ÿ® ⁄Üÿß€Å€å⁄∫ ŸàÿßŸæÿ≥ ÿ¢ÿ¨ÿßÿ¶€å⁄∫€î"
      }
    ];

    function findQaAnswer(text) {
      const cleaned = text.toLowerCase().trim();
      for (const item of qaDatabase) {
        for (const pat of item.patterns) {
          if (cleaned.includes(pat)) return item.answer;
        }
      }
      return null;
    }

    /* ========= Orb Sun/Moon cycle ========= */
    const orbEl = document.getElementById("orb");
    let orbState = 0; // 0: sun, 1: moon anim, 2: moon dim, 3: hidden

    function updateOrb() {
      orbEl.classList.remove("moon", "moon-dim", "hidden");
      if (orbState === 0) {
        // sun
      } else if (orbState === 1) {
        orbEl.classList.add("moon");
      } else if (orbState === 2) {
        orbEl.classList.add("moon-dim");
      } else if (orbState === 3) {
        orbEl.classList.add("hidden");
      }
    }

    orbEl.addEventListener("click", () => {
      orbState = (orbState + 1) % 4;
      updateOrb();
    });

    updateOrb();

    /* ========= FAB menu ========= */
    const fabMain = document.getElementById("fabMain");
    const fabMenu = document.getElementById("fabMenu");
    fabMain.addEventListener("click", () => {
      fabMenu.classList.toggle("open");
    });

    const btnBelief = document.getElementById("btnBelief");
    const btnVoice = document.getElementById("btnVoice");
    const btnLLMs = document.getElementById("btnLLMs");
    const btnThemes = document.getElementById("btnThemes");

    /* ========= Belief modal logic ========= */
    const beliefBackdrop = document.getElementById("beliefBackdrop");
    const beliefClose = document.getElementById("beliefClose");
    const faithGrid = document.getElementById("faithGrid");
    let selectedFaith = null;

    function openBeliefModal() {
      beliefBackdrop.classList.add("show");
    }
    function closeBeliefModal() {
      beliefBackdrop.classList.remove("show");
    }

    btnBelief.addEventListener("click", () => {
      openBeliefModal();
    });
    beliefClose.addEventListener("click", closeBeliefModal);
    beliefBackdrop.addEventListener("click", (e) => {
      if (e.target === beliefBackdrop) closeBeliefModal();
    });

    faithGrid.addEventListener("click", (e) => {
      const pill = e.target.closest(".faith-pill");
      if (!pill) return;
      const faith = pill.dataset.faith;
      selectedFaith = faith;

      document
        .querySelectorAll(".faith-pill")
        .forEach((p) => p.classList.remove("active"));
      pill.classList.add("active");
      closeBeliefModal();
    });

    /* ========= Themes (simple cycle) ========= */
    const body = document.body;
    const themes = ["default", "night", "calm"];
    let themeIndex = 0;

    function applyTheme() {
      body.classList.remove("theme-night", "theme-calm");
      if (themes[themeIndex] === "night") {
        body.style.background = "#020617";
      } else if (themes[themeIndex] === "calm") {
        body.style.background = "#020617";
      } else {
        body.style.background = "#020617";
      }
    }

    btnThemes.addEventListener("click", () => {
      themeIndex = (themeIndex + 1) % themes.length;
      applyTheme();
    });

    /* ========= Voice handling ========= */
    let voiceEnabled = true;
    btnVoice.classList.add("active");

    function speakOnce(text) {
      if (!voiceEnabled || !("speechSynthesis" in window)) return;
      window.speechSynthesis.cancel();
      const utter = new SpeechSynthesisUtterance(text);
      // Urdu/English mix voice selection (best-effort)
      const voices = window.speechSynthesis.getVoices();
      const urduLike = voices.find(v =>
        /urdu|arabic|hindi|pakistan/i.test(v.lang)
      );
      if (urduLike) utter.voice = urduLike;
      utter.rate = 1.0;
      utter.pitch = 1.0;
      window.speechSynthesis.speak(utter);
    }

    btnVoice.addEventListener("click", () => {
      voiceEnabled = !voiceEnabled;
      if (voiceEnabled) {
        btnVoice.classList.add("active");
      } else {
        btnVoice.classList.remove("active");
        window.speechSynthesis.cancel();
      }
    });

    /* ========= LLMs button (placeholder) ========= */
    btnLLMs.addEventListener("click", () => {
      alert(
        "LLM list coming soon.\nYahan se aap ChatGPT / Gemini / Grok / etc select kar ÿ≥⁄©€å⁄∫ ⁄Ø€í (online mode)."
      );
    });

    /* ========= Emotional continuity equation ========= */
    function computeEmotionMetrics(text) {
      const clean = text.toLowerCase();
      const lengthScore = Math.min(clean.length / 120, 1);

      const positiveWords = ["thanks", "shukriya", "happy", "good", "great"];
      const negativeWords = ["sad", "depressed", "tension", "bura", "gussa"];

      let pos = 0, neg = 0;
      for (const w of positiveWords) {
        if (clean.includes(w)) pos += 0.12;
      }
      for (const w of negativeWords) {
        if (clean.includes(w)) neg += 0.15;
      }

      const t_m = +(lengthScore.toFixed(2));
      const b_m = +(Math.max(pos - neg, -1).toFixed(2));
      const d = +(Math.max(neg - pos, 0).toFixed(2));
      const C = 0.45;       // continuity weight (fixed in this proto)
      const P = +(t_m + b_m - d).toFixed(2);

      const M = 0.7;        // memory resonance weight (demo)
      const E_p = 0.4;      // baseline emotional potential
      const K = 0.9;        // coupling factor

      const E = +(M * E_p + K * P * C).toFixed(3);

      return { E, P, t_m, b_m, d, C };
    }

    function updateEquationDisplay(metrics) {
      const eqEl = document.getElementById("equationValues");
      const { E, P, t_m, b_m, d, C } = metrics;
      eqEl.textContent =
        `E = ${E} | P = ${P} | t‚Çò = ${t_m} | b‚Çò = ${b_m} | d = ${d} | C = ${C}`;
    }

    /* ========= Chat handling ========= */
    const chatForm = document.getElementById("chatForm");
    const userInput = document.getElementById("userInput");
    const youSaidLabel = document.getElementById("youSaidLabel");
    const assistantText = document.getElementById("assistantText");
    const ethicsBox = document.getElementById("ethicsBox");

    function buildFaithSuffix() {
      if (!selectedFaith) return "";
      if (selectedFaith === "Islam") {
        return "\n\nüìø ÿß€åŸÖÿßŸÜ note: ÿßŸÑŸÑ€Å Ÿæÿ± ÿ®⁄æÿ±Ÿàÿ≥€Å ⁄©€åÿ¨€å€íÿå €Åÿ± ŸÖÿ¥⁄©ŸÑ ⁄©€í ÿ®ÿπÿØ ÿ¢ÿ≥ÿßŸÜ€å €Å€í€î";
      }
      if (selectedFaith === "Christianity") {
        return "\n\n‚úùÔ∏è Faith note: Remember, grace and hope walk with you.";
      }
      if (selectedFaith === "Atheism") {
        return "\n\nüß† Reflection note: Meaning ÿ¢Ÿæ ÿÆŸàÿØ create ⁄©ÿ± ÿ≥⁄©ÿ™€í €Å€å⁄∫ÿå ÿ∞ŸÖ€Å ÿØÿßÿ±€å ⁄©€í ÿ≥ÿßÿ™⁄æ€î";
      }
      return "\n\nüïä Faith note: ÿßŸæŸÜ€í ÿ∂ŸÖ€åÿ± ÿßŸàÿ± ÿ®⁄æŸÑÿßÿ¶€å ⁄©€å ÿ∑ÿ±ŸÅ ŸÜÿ±ŸÖ€å ÿ≥€í ÿ¨⁄æ⁄©€å⁄∫€î";
    }

    chatForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const text = userInput.value.trim();
      if (!text) return;

      youSaidLabel.textContent = `You said: ‚Äú${text}‚Äù`;

      let baseAnswer = findQaAnswer(text);
      if (!baseAnswer) {
        baseAnswer =
          "Thank you for sharing. üòä ŸÖ€å⁄∫ ÿ¢Ÿæ ⁄©€í ÿÆ€åÿßŸÑ ⁄©Ÿà ŸÖÿ≠ÿ≥Ÿàÿ≥ ⁄©ÿ± ÿ±€Åÿß €ÅŸà⁄∫ÿå ⁄©€åÿß ÿ¢Ÿæ ÿ™⁄æŸà⁄ëÿß ÿßŸàÿ± detail ŸÖ€å⁄∫ ÿ®ÿ™ÿß ÿ≥⁄©ÿ™€í €Å€å⁄∫ÿü";
      }

      let fullAnswer = baseAnswer;
      fullAnswer += buildFaithSuffix();

      assistantText.textContent = fullAnswer.split("\n\n")[0];
      ethicsBox.textContent =
        "Universal Ethics says: avoid actions that create negative emotions in you or others, and gently move toward actions that create calm, kindness and positive feelings.";

      const metrics = computeEmotionMetrics(text);
      updateEquationDisplay(metrics);

      speakOnce(assistantText.textContent);

      userInput.value = "";
    });
  </script>
</body>
</html>
