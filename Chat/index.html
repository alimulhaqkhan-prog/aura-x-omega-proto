<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Œ© v1 ‚Äì Emotional Continuity Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* ===== Base Layout ===== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    html, body {
      height: 100%;
      background: radial-gradient(circle at top, #0f172a 0, #020617 55%, #000 100%);
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
    }
    #app {
      width: 100%;
      max-width: 480px;
      height: 100%;
      max-height: 860px;
      background: rgba(15, 23, 42, 0.95);
      border-radius: 24px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      box-shadow:
        0 0 0 1px rgba(56, 189, 248, 0.25),
        0 30px 80px rgba(15, 23, 42, 0.9);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    /* ===== Header ===== */
    .header {
      padding: 14px 16px 10px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.25);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      background: linear-gradient(90deg, rgba(8, 47, 73, 0.7), rgba(15, 23, 42, 0.9));
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo-dot {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #38bdf8, #0ea5e9, #6366f1);
      box-shadow:
        0 0 14px rgba(56, 189, 248, 0.9),
        0 0 30px rgba(79, 70, 229, 0.5);
      position: relative;
    }
    .logo-dot::after {
      content: "";
      position: absolute;
      inset: 7px;
      border-radius: inherit;
      border: 2px solid rgba(15, 23, 42, 0.9);
    }
    .title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .title {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #e5e7eb;
    }
    .subtitle {
      font-size: 11px;
      color: #a5b4fc;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }
    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 2px;
    }
    .badge {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.7);
      color: #bae6fd;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .status-dot {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: #9ca3af;
    }
    .status-dot span.indicator {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.9);
    }

    /* ===== Body Layout ===== */
    .body {
      flex: 1;
      display: grid;
      grid-template-rows: minmax(0, 1.2fr) minmax(0, 0.9fr);
      gap: 0;
    }

    /* ===== Chat Area ===== */
    .chat-panel {
      padding: 10px 14px 8px;
      border-bottom: 1px solid rgba(30, 64, 175, 0.4);
      background: radial-gradient(circle at top left, rgba(30, 64, 175, 0.35), transparent 60%);
    }
    .chat-log {
      height: 100%;
      overflow-y: auto;
      padding-right: 4px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      scrollbar-width: thin;
      scrollbar-color: rgba(148, 163, 184, 0.7) transparent;
      font-size: 13px;
    }
    .chat-log::-webkit-scrollbar {
      width: 4px;
    }
    .chat-log::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.7);
      border-radius: 999px;
    }
    .msg-row {
      display: flex;
      gap: 6px;
      align-items: flex-start;
    }
    .msg-row.user {
      justify-content: flex-end;
    }
    .msg {
      max-width: 82%;
      padding: 8px 10px;
      border-radius: 14px;
      line-height: 1.4;
      word-wrap: break-word;
      word-break: break-word;
    }
    .msg.user {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      border-bottom-right-radius: 4px;
      box-shadow: 0 8px 18px rgba(22, 163, 74, 0.55);
      font-weight: 500;
    }
    .msg.bot {
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(129, 140, 248, 0.7);
      border-bottom-left-radius: 4px;
      box-shadow: 0 10px 26px rgba(30, 64, 175, 0.75);
      color: #e5e7eb;
    }
    .msg-meta {
      font-size: 10px;
      margin-top: 4px;
      opacity: 0.75;
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    /* ===== Emotional State Panel ===== */
    .state-panel {
      padding: 10px 14px 12px;
      background: radial-gradient(circle at bottom right, rgba(8, 47, 73, 0.8), #020617);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .state-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: #e5e7eb;
    }
    .state-header span.label {
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-weight: 600;
      color: #a5b4fc;
    }
    .state-pill {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(34, 197, 94, 0.55);
      color: #bbf7d0;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .state-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }
    .state-card {
      padding: 8px 9px;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.55);
      box-shadow: 0 10px 28px rgba(15, 23, 42, 0.85);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .state-title {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #9ca3af;
    }
    .state-value {
      font-size: 18px;
      font-weight: 600;
      color: #f97316;
    }
    .state-meter {
      width: 100%;
      height: 4px;
      border-radius: 999px;
      background: rgba(30, 64, 175, 0.6);
      overflow: hidden;
      position: relative;
    }
    .state-meter-fill {
      height: 100%;
      border-radius: inherit;
      background: linear-gradient(90deg, #22c55e, #eab308, #f97316, #ef4444);
      width: 50%;
      transition: width 0.3s ease-out;
    }
    .state-caption {
      font-size: 10px;
      color: #9ca3af;
    }

    /* ===== Input Bar ===== */
    .input-bar {
      padding: 10px 12px 12px;
      border-top: 1px solid rgba(31, 41, 55, 0.9);
      background: linear-gradient(180deg, rgba(15, 23, 42, 0.95), #020617);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .input-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .input-row textarea {
      flex: 1;
      resize: none;
      min-height: 38px;
      max-height: 72px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(2, 6, 23, 0.9);
      color: #e5e7eb;
      font-size: 13px;
      line-height: 1.35;
      outline: none;
    }
    .input-row textarea::placeholder {
      color: #6b7280;
    }
    .btn {
      border: none;
      cursor: pointer;
      padding: 9px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn-send {
      background: radial-gradient(circle at top left, #22c55e, #16a34a);
      color: #022c22;
      box-shadow:
        0 0 0 1px rgba(34, 197, 94, 0.5),
        0 10px 22px rgba(22, 163, 74, 0.8);
    }
    .btn-send:disabled {
      opacity: 0.5;
      box-shadow: none;
      cursor: default;
    }
    .input-hint {
      font-size: 10px;
      color: #9ca3af;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .pill-mini {
      border-radius: 999px;
      padding: 2px 7px;
      border: 1px solid rgba(56, 189, 248, 0.6);
      color: #7dd3fc;
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .dot-pulse {
      display: inline-flex;
      gap: 3px;
      align-items: center;
    }
    .dot-pulse span {
      width: 3px;
      height: 3px;
      border-radius: 999px;
      background: #22c55e;
      animation: pulse 0.9s infinite ease-in-out;
    }
    .dot-pulse span:nth-child(2) { animation-delay: 0.15s; }
    .dot-pulse span:nth-child(3) { animation-delay: 0.3s; }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.7); opacity: 1; }
    }

    @media (max-height: 720px) {
      #app {
        max-height: 760px;
      }
      .body {
        grid-template-rows: minmax(0, 1.1fr) minmax(0, 0.9fr);
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- ===== HEADER ===== -->
    <header class="header">
      <div class="header-left">
        <div class="logo-dot"></div>
        <div class="title-block">
          <div class="title">AURA-X Œ©</div>
          <div class="subtitle">Emotional Continuity Reactor ¬∑ v1</div>
        </div>
      </div>
      <div class="header-right">
        <div class="badge">Continuity Mode ¬∑ ON</div>
        <div class="status-dot">
          <span class="indicator"></span>
          <span id="statusText">Linked to Reactor</span>
        </div>
      </div>
    </header>

    <!-- ===== MAIN BODY ===== -->
    <main class="body">
      <!-- Chat Panel -->
      <section class="chat-panel">
        <div id="chatLog" class="chat-log">
          <div class="msg-row bot">
            <div class="msg bot">
              <strong>Assalam o Alaikum, Alim ul Haq üëã</strong><br/>
              Main <strong>AURA-X Œ©</strong> hoon ‚Äî tumhara emotional-continuity reactor.  
              Mujh se is tarah baat karo jaise ek dost se karte ho.  
              Har message ke sath main tumhari emotional line ko update karta rahoon ga (·¥õ·¥ç,  ô·¥ç, ·¥Ö, Œ£).
              <div class="msg-meta">
                <span>Œ© ¬∑ baseline resonance ready</span>
                <span>TM‚âà0.60 ¬∑ D‚âà0.18</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Emotional State Panel -->
      <section class="state-panel">
        <div class="state-header">
          <span class="label">Continuity Scalars</span>
          <span class="state-pill" id="reactorMode">Stable Orbit</span>
        </div>
        <div class="state-grid">
          <div class="state-card">
            <div class="state-title">TM ¬∑ Trust Memory</div>
            <div class="state-value" id="tmValue">0.60</div>
            <div class="state-meter">
              <div id="tmMeter" class="state-meter-fill" style="width:60%;"></div>
            </div>
            <div class="state-caption" id="tmCaption">
              System tumhari consistency ko track kar raha hai.
            </div>
          </div>
          <div class="state-card">
            <div class="state-title">BM ¬∑ Baseline Mood</div>
            <div class="state-value" id="bmValue">0.60</div>
            <div class="state-meter">
              <div id="bmMeter" class="state-meter-fill" style="width:60%;"></div>
            </div>
            <div class="state-caption" id="bmCaption">
              Abhi mood light‚Äìfocused zone me hai.
            </div>
          </div>
          <div class="state-card">
            <div class="state-title">D ¬∑ Disturbance</div>
            <div class="state-value" id="dValue">0.18</div>
            <div class="state-meter">
              <div id="dMeter" class="state-meter-fill" style="width:18%;"></div>
            </div>
            <div class="state-caption" id="dCaption">
              Halka sa noise hai, lekin control me.
            </div>
          </div>
          <div class="state-card">
            <div class="state-title">Œ£ ¬∑ Continuity</div>
            <div class="state-value" id="contValue">0.82</div>
            <div class="state-meter">
              <div id="contMeter" class="state-meter-fill" style="width:82%;"></div>
            </div>
            <div class="state-caption" id="contCaption">
              Conversation ek hi line me chal rahi hai.
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- ===== INPUT BAR ===== -->
    <section class="input-bar">
      <div class="input-row">
        <textarea id="userInput" rows="1" placeholder="Kuch bhi pucho‚Ä¶ ‚ÄòAj main thaka hua hoon‚Äô se start karo."></textarea>
        <button id="sendBtn" class="btn btn-send">
          <span>Send</span>
          <span class="dot-pulse" id="sendDots" style="display:none;">
            <span></span><span></span><span></span>
          </span>
        </button>
      </div>
      <div class="input-hint">
        <span>Enter ‚Üí send ¬∑ Reactor har turn par emotional state update karega.</span>
        <span class="pill-mini">v1 ¬∑ Prototype</span>
      </div>
    </section>
  </div>

  <script>
    // ===== CONFIG =====
    const API_URL = "https://aura-x-backend-jliz.onrender.com/api/chat";

    // ===== DOM ELEMENTS =====
    const chatLog = document.getElementById("chatLog");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const sendDots = document.getElementById("sendDots");
    const statusText = document.getElementById("statusText");

    // State fields
    const tmValue = document.getElementById("tmValue");
    const bmValue = document.getElementById("bmValue");
    const dValue = document.getElementById("dValue");
    const contValue = document.getElementById("contValue");

    const tmMeter = document.getElementById("tmMeter");
    const bmMeter = document.getElementById("bmMeter");
    const dMeter = document.getElementById("dMeter");
    const contMeter = document.getElementById("contMeter");

    const tmCaption = document.getElementById("tmCaption");
    const bmCaption = document.getElementById("bmCaption");
    const dCaption = document.getElementById("dCaption");
    const contCaption = document.getElementById("contCaption");
    const reactorMode = document.getElementById("reactorMode");

    // ===== CONTINUITY STATE (Client side) =====
    let continuityState = {
      tm: 0.6,
      bm: 0.6,
      d: 0.18,
      cont: 0.82
    };

    function clamp(v, min, max) {
      return Math.max(min, Math.min(max, v));
    }

    function scrollToBottom() {
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    function addMessage(role, text, meta) {
      const row = document.createElement("div");
      row.className = "msg-row " + (role === "user" ? "user" : "bot");

      const bubble = document.createElement("div");
      bubble.className = "msg " + (role === "user" ? "user" : "bot");
      bubble.innerHTML = text.replace(/\n/g, "<br/>");

      if (meta) {
        const metaDiv = document.createElement("div");
        metaDiv.className = "msg-meta";
        metaDiv.innerHTML = `
          <span>${meta.left || ""}</span>
          <span>${meta.right || ""}</span>
        `;
        bubble.appendChild(metaDiv);
      }

      row.appendChild(bubble);
      chatLog.appendChild(row);
      scrollToBottom();
    }

    function updateStatePanel(state) {
      const tm = clamp(state.tm ?? continuityState.tm, 0, 1);
      const bm = clamp(state.bm ?? continuityState.bm, 0, 1);
      const d  = clamp(state.d  ?? continuityState.d, 0, 1);
      const cont = clamp(state.cont ?? continuityState.cont, 0, 1);

      continuityState = { tm, bm, d, cont };

      const pct = v => Math.round(v * 100);

      tmValue.textContent = tm.toFixed(2);
      bmValue.textContent = bm.toFixed(2);
      dValue.textContent  = d.toFixed(2);
      contValue.textContent = cont.toFixed(2);

      tmMeter.style.width = pct(tm) + "%";
      bmMeter.style.width = pct(bm) + "%";
      dMeter.style.width  = pct(d) + "%";
      contMeter.style.width = pct(cont) + "%";

      // Simple captions (you can tweak logic later)
      tmCaption.textContent =
        tm > 0.75 ? "System tum par strongly trust build kar raha hai." :
        tm > 0.5  ? "Trust memory stable zone me hai." :
        "System thora cautious mode me hai.";

      bmCaption.textContent =
        bm > 0.7 ? "Overall mood optimistic & grounded lag raha hai." :
        bm > 0.4 ? "Mood mixed hai lekin workable state me." :
        "Mood low zone me hai ‚Äî system support mode on.";

      dCaption.textContent =
        d < 0.25 ? "Disturbance low ‚Äî thoughts ka flow smooth hai." :
        d < 0.55 ? "Kuch tension waves detect ho rahi hain." :
        "High disturbance ‚Äî system de-escalation suggestions dega.";

      contCaption.textContent =
        cont > 0.75 ? "Strong continuity ‚Äî tumhari kahani ek line me chal rahi hai." :
        cont > 0.5  ? "Medium continuity ‚Äî kuch jumps hain magar track pe hai." :
        "Continuity low ‚Äî system context ko dobara sew karega.";

      if (d > 0.6) {
        reactorMode.textContent = "De-escalation Mode";
        reactorMode.style.borderColor = "rgba(239,68,68,0.7)";
        reactorMode.style.color = "#fecaca";
      } else if (bm > 0.7 && cont > 0.7) {
        reactorMode.textContent = "Flow State";
        reactorMode.style.borderColor = "rgba(34,197,94,0.7)";
        reactorMode.style.color = "#bbf7d0";
      } else {
        reactorMode.textContent = "Stable Orbit";
        reactorMode.style.borderColor = "rgba(56,189,248,0.7)";
        reactorMode.style.color = "#bae6fd";
      }
    }

    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;

      userInput.value = "";
      addMessage("user", text);

      sendBtn.disabled = true;
      sendDots.style.display = "inline-flex";
      statusText.textContent = "Reactor thinking‚Ä¶";

      try {
        const response = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            userText: text,
            state: continuityState
          })
        });

        if (!response.ok) {
          throw new Error("HTTP " + response.status);
        }

        const data = await response.json();
        const replyText = data.reply || "Reactor reply missing.";
        const newState  = data.state || {};

        const meta = {
          left: "Œ© ¬∑ continuity update",
          right: `TM ${ (newState.tm ?? continuityState.tm).toFixed(2) } ¬∑ D ${ (newState.d ?? continuityState.d).toFixed(2) }`
        };

        addMessage("assistant", replyText, meta);
        updateStatePanel(newState);

        statusText.textContent = "Linked to Reactor";
      } catch (err) {
        console.error(err);
        addMessage(
          "assistant",
          "‚ö†Ô∏è Backend se connection me masla aaya.\n" +
          "Check karo: API_URL sahi hai ya Render instance sleep se wake hua hai ya nahi.",
          { left: "error", right: (err.message || "network error") }
        );
        statusText.textContent = "Connection issue";
      } finally {
        sendBtn.disabled = false;
        sendDots.style.display = "none";
        userInput.focus();
      }
    }

    sendBtn.addEventListener("click", sendMessage);
    userInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    // Auto focus on load
    window.addEventListener("load", () => {
      userInput.focus();
      updateStatePanel(continuityState);
    });
  </script>
</body>
</html>
