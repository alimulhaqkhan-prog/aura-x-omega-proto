<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Œ© ‚Äì Emotional Reactor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <style>
    /* ===== Base Layout ===== */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      background: #020617;
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    #app {
      position: relative;
      width: 100%;
      max-width: 480px;
      height: 100vh;
      box-sizing: border-box;
      padding: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transform-origin: top center;
    }

    @media (max-height: 720px) {
      #app { transform: scale(0.9); }
    }

    @media (max-height: 640px) {
      #app { transform: scale(0.82); }
    }

    .hidden { display: none; }

    /* ===== Card ===== */
    .card {
      position: relative;
      width: 100%;
      border-radius: 32px;
      background: radial-gradient(circle at top, #0b1120 0, #020617 55%, #000 100%);
      box-shadow:
        0 24px 80px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(148, 163, 184, 0.18);
      padding: 24px 24px 22px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      gap: 12px;
    }

    .title {
      font-size: 24px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: #facc15;
      margin-bottom: 2px;
    }

    .subtitle {
      font-size: 11px;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: #9ca3af;
      text-align: center;
      margin-bottom: 10px;
    }

    /* ===== Orb (Sun / Moon) ===== */
    .orb-wrapper {
      position: relative;
      width: 210px;
      height: 210px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 6px;
      cursor: pointer;
    }

    .orb {
      width: 180px;
      height: 180px;
      border-radius: 999px;
      box-shadow:
        0 0 40px rgba(250, 204, 21, 0.8),
        0 0 120px rgba(250, 204, 21, 0.55);
      transition: all 260ms ease-out;
    }

    /* Sun look */
    .orb.sun-mode {
      background:
        radial-gradient(circle at 30% 30%, #fff7c2 0, #ffe08a 15%, #ffb322 38%, #ff9a1f 60%, rgba(255, 196, 92, 0) 76%);
      box-shadow:
        0 0 42px rgba(250, 204, 21, 0.95),
        0 0 150px rgba(251, 191, 36, 0.8);
      animation: pulseSun 4s infinite ease-in-out;
    }

    /* Moon bright (animated) */
    .orb.moon-bright {
      background:
        radial-gradient(circle at 30% 30%, #ffffff 0, #f4f7ff 20%, #dbeafe 42%, #93c5fd 62%, rgba(37, 99, 235, 0) 80%);
      box-shadow:
        0 0 34px rgba(191, 219, 254, 0.85),
        0 0 110px rgba(59, 130, 246, 0.7);
      animation: glowMoon 5s infinite ease-in-out;
    }

    /* Moon dim (static) */
    .orb.moon-dim {
      background:
        radial-gradient(circle at 30% 30%, #ffffff 0, #eef2ff 26%, #c7d2fe 50%, rgba(59, 130, 246, 0) 72%);
      box-shadow:
        0 0 20px rgba(191, 219, 254, 0.55),
        0 0 70px rgba(37, 99, 235, 0.45);
      animation: none;
      opacity: 0.93;
    }

    /* Orb hidden */
    .orb.hidden-orb {
      opacity: 0;
      transform: scale(0.4);
      box-shadow: none;
    }

    @keyframes pulseSun {
      0%   { transform: scale(1);   box-shadow: 0 0 42px rgba(250, 204, 21, 0.9), 0 0 150px rgba(251, 191, 36, 0.7); }
      50%  { transform: scale(1.04); box-shadow: 0 0 60px rgba(250, 204, 21, 1),   0 0 190px rgba(251, 191, 36, 0.9); }
      100% { transform: scale(1);   box-shadow: 0 0 42px rgba(250, 204, 21, 0.9), 0 0 150px rgba(251, 191, 36, 0.7); }
    }

    @keyframes glowMoon {
      0%   { transform: scale(1);   box-shadow: 0 0 34px rgba(191, 219, 254, 0.85), 0 0 110px rgba(59, 130, 246, 0.7); }
      50%  { transform: scale(1.03); box-shadow: 0 0 46px rgba(219, 234, 254, 1),   0 0 150px rgba(96, 165, 250, 0.9); }
      100% { transform: scale(1);   box-shadow: 0 0 34px rgba(191, 219, 254, 0.85), 0 0 110px rgba(59, 130, 246, 0.7); }
    }

    /* ===== Text Sections ===== */
    .mode-line {
      font-size: 13px;
      color: #9ca3af;
      margin-top: 2px;
    }

    .mode-line span {
      color: #facc15;
      font-weight: 500;
    }

    .you-said {
      font-size: 13px;
      color: #d1d5db;
      margin-top: 4px;
      min-height: 18px;
    }

    .main-answer {
      margin-top: 10px;
      font-size: 15px;
      text-align: center;
      color: #f9fafb;
      min-height: 20px;
    }

    .ethics-box {
      width: 100%;
      margin-top: 12px;
      padding: 10px 14px;
      border-radius: 18px;
      background: rgba(250, 204, 21, 0.10);
      border: 1px solid rgba(250, 204, 21, 0.5);
      font-size: 12px;
      color: #e5e7eb;
      box-sizing: border-box;
    }

    .ethics-box strong {
      color: #fde68a;
    }

    /* Equation box */
    .equation-box {
      width: 100%;
      margin-top: 10px;
      padding: 10px 14px 12px;
      border-radius: 18px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px dashed rgba(148, 163, 184, 0.6);
      font-size: 11px;
      color: #e5e7eb;
      box-sizing: border-box;
    }

    .equation-title {
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #9ca3af;
      margin-bottom: 6px;
    }

    .equation-body {
      line-height: 1.5;
      word-spacing: 0.08em;
    }

    /* ===== Input bar ===== */
    .input-row {
      margin-top: 14px;
      width: 100%;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .input-shell {
      flex: 1;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(55, 65, 81, 0.9);
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-sizing: border-box;
      box-shadow: 0 12px 36px rgba(15, 23, 42, 0.85);
    }

    .input-shell span {
      font-size: 15px;
    }

    #userInput {
      flex: 1;
      border: none;
      outline: none;
      background: transparent;
      color: #f9fafb;
      font-size: 14px;
    }

    #userInput::placeholder {
      color: #6b7280;
    }

    .send-btn {
      border-radius: 999px;
      padding: 10px 22px;
      border: none;
      background: radial-gradient(circle at 30% 20%, #fef9c3 0, #facc15 40%, #f59e0b 100%);
      color: #111827;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      box-shadow:
        0 0 22px rgba(250, 204, 21, 0.75),
        0 18px 40px rgba(251, 191, 36, 0.85);
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out;
    }

    .send-btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow:
        0 0 12px rgba(250, 204, 21, 0.7),
        0 10px 26px rgba(251, 191, 36, 0.8);
    }

    /* ===== Single FAB + Menu ===== */
    .fab-main {
      position: absolute;
      right: 18px;
      top: 110px;
      width: 38px;
      height: 38px;
      border-radius: 999px;
      border: none;
      background: radial-gradient(circle at 30% 25%, #e5e7eb 0, #9ca3af 40%, #4b5563 100%);
      color: #020617;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow:
        0 0 16px rgba(148, 163, 184, 0.75),
        0 14px 30px rgba(15, 23, 42, 0.85);
      z-index: 8;
      transition: transform 0.15s ease-out, box-shadow 0.15s ease-out;
    }

    .fab-main:active {
      transform: scale(0.95);
      box-shadow:
        0 0 10px rgba(148, 163, 184, 0.7),
        0 10px 20px rgba(15, 23, 42, 0.9);
    }

    .fab-menu {
      position: absolute;
      right: 18px;
      top: 156px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      opacity: 0;
      pointer-events: none;
      transform: translateY(-4px);
      transition: opacity 0.18s ease-out, transform 0.18s ease-out;
      z-index: 7;
    }

    .fab-menu.open {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    .fab-item {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.75);
      background: radial-gradient(circle at 30% 25%, #111827 0, #020617 55%, #000 100%);
      color: #e5e7eb;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow:
        0 10px 22px rgba(15, 23, 42, 0.9),
        0 0 10px rgba(15, 23, 42, 0.9);
      transition: transform 0.12s ease-out, box-shadow 0.12s ease-out, border-color 0.12s ease-out, background 0.12s ease-out;
    }

    .fab-item.active {
      border-color: #22c55e;
      background: radial-gradient(circle at 30% 25%, #22c55e 0, #16a34a 40%, #064e3b 100%);
      color: #022c22;
      box-shadow:
        0 0 18px rgba(34, 197, 94, 0.9),
        0 12px 26px rgba(22, 163, 74, 0.9);
    }

    .fab-item:active {
      transform: translateY(1px) scale(0.97);
    }

    /* ===== Belief Modal ===== */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 30;
    }

    .modal {
      width: min(440px, 100% - 32px);
      border-radius: 24px;
      background: radial-gradient(circle at top, #020617 0, #020617 55%, #000 100%);
      box-shadow: 0 32px 80px rgba(0, 0, 0, 0.95);
      padding: 20px 20px 18px;
      color: #e5e7eb;
      box-sizing: border-box;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
    }

    .modal-close {
      border: none;
      background: #111827;
      border-radius: 999px;
      padding: 6px 11px;
      font-size: 13px;
      color: #e5e7eb;
      cursor: pointer;
    }

    .modal-sub {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 10px;
    }

    .faith-banner {
      width: 100%;
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 12px;
      color: #bbf7d0;
      background: rgba(22, 163, 74, 0.16);
      border: 1px solid rgba(34, 197, 94, 0.8);
      margin-bottom: 14px;
      text-align: center;
    }

    .faith-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 10px;
    }

    .faith-btn {
      border-radius: 999px;
      padding: 8px 10px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: #020617;
      color: #e5e7eb;
      font-size: 13px;
      cursor: pointer;
      text-align: center;
    }

    .faith-btn.active {
      border-color: #22c55e;
      background: radial-gradient(circle at 20% 10%, #22c55e 0, #15803d 40%, #064e3b 100%);
      color: #ecfdf5;
    }

    .modal-footer {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 4px;
    }

    .modal-footer strong {
      color: #e5e7eb;
    }

    /* Simple LLM modal placeholder */
    .llm-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
      margin-bottom: 4px;
    }

    .llm-btn {
      border-radius: 999px;
      padding: 8px 10px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: #020617;
      color: #e5e7eb;
      font-size: 13px;
      cursor: pointer;
      text-align: left;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .llm-btn span {
      font-size: 11px;
      color: #9ca3af;
    }

    .llm-btn.active {
      border-color: #38bdf8;
      background: radial-gradient(circle at 20% 10%, #38bdf8 0, #0369a1 45%, #0b1120 100%);
      color: #e0f2fe;
    }
  </style>
</head>

<body>
  <div id="app">
    <div class="card">
      <div class="title">AURA-X Œ©</div>
      <div class="subtitle">LOGICAL ¬∑ EMOTIONAL ¬∑ UNIVERSAL ETHICS REACTOR</div>

      <!-- Orb -->
      <div class="orb-wrapper" id="orbWrapper" title="Tap to switch Sun / Moon">
        <div class="orb sun-mode" id="orb"></div>
      </div>

      <!-- Single master FAB -->
      <button class="fab-main" id="fabMain" title="Open controls">‚Ä¢</button>
      <div class="fab-menu" id="fabMenu">
        <button class="fab-item" id="fabBelief" title="Belief / Faith">B</button>
        <button class="fab-item" id="fabVoice" title="Voice On / Off">V</button>
        <button class="fab-item" id="fabLLM" title="LLM Selection">L</button>
        <button class="fab-item" id="fabTheme" title="Themes">T</button>
      </div>

      <div class="mode-line">Mode: <span id="modeLabel">Universal Ethics</span></div>
      <div class="you-said" id="youSaid"></div>
      <div class="main-answer" id="mainAnswer">Hello! üëã How can I help you today?</div>

      <div class="ethics-box" id="ethicsBox">
        <strong>Universal Ethics</strong> says: avoid actions that create negative emotions in you or others,
        and gently move toward actions that create calm, kindness and positive feelings.
      </div>

      <div class="equation-box" id="equationBox">
        <div class="equation-title">EMOTIONAL CONTINUITY EQUATION</div>
        <div class="equation-body" id="equationBody">
          E = M¬∑E‚Çö + K¬∑P¬∑C, &nbsp;&nbsp; P = t‚Çò + b‚Çò ‚àí d<br />
          E = 0.26 | P = 0.04 | t‚Çò = 0.04 | b‚Çò = 0 | d = 0 | C = 0.45
        </div>
      </div>

      <div class="input-row">
        <div class="input-shell">
          <span>‚ú®</span>
          <input id="userInput" type="text"
                 placeholder="Write anything... AURA-X will feel it with you." />
        </div>
        <button class="send-btn" id="sendBtn">Send</button>
      </div>
    </div>

    <!-- Belief Modal -->
    <div class="modal-backdrop hidden" id="beliefModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">Belief settings</div>
          <button class="modal-close" id="beliefClose">Close</button>
        </div>
        <div class="modal-sub">
          Optional spiritual flavour on top of Universal Ethics.
        </div>

        <div class="faith-banner">
          Faith is optional ¬∑ Base rule is always <strong>Universal Ethics</strong>.
        </div>

        <div class="faith-grid" id="faithGrid">
          <!-- Buttons created by JS -->
        </div>

        <div class="modal-footer">
          Currently selected: <strong id="faithSelectedLabel">Universal only</strong>.
          No extra faith flavour added.
        </div>
      </div>
    </div>

    <!-- LLM Modal -->
    <div class="modal-backdrop hidden" id="llmModal">
      <div class="modal">
        <div class="modal-header">
          <div class="modal-title">LLM selection</div>
          <button class="modal-close" id="llmClose">Close</button>
        </div>
        <div class="modal-sub">
          For now this is just a placeholder list. In future, AURA-X Œ© can route online
          questions to a selected Large Language Model (LLM).
        </div>

        <div class="llm-list" id="llmList">
          <!-- Created by JS -->
        </div>

        <div class="modal-footer">
          Selected engine: <strong id="llmSelectedLabel">Offline basic QA only</strong>.
        </div>
      </div>
    </div>

  </div>

  <script>
    /* ========= Small-talk + basic QA database ========= */
    const qaDatabase = [
      {
        patterns: ["hello", "hello!", "hello there", "helo", "hallo"],
        answer: "Hello! üëã How can I help you today?"
      },
      {
        patterns: ["hi", "hi!", "hii", "hiii", "hey"],
        answer: "Hi there! üòä What can I do for you?"
      },
      {
        patterns: ["assalam o alaikum", "asalam o alaikum", "salam", "slam", "asalamu alaikum"],
        answer: "ŸàÿπŸÑ€å⁄©ŸÖ ÿßŸÑÿ≥ŸÑÿßŸÖ üòä ⁄©€åÿ≥€í €Å€å⁄∫ ÿ¢Ÿæÿü ŸÖ€å⁄∫ ÿ¢Ÿæ ⁄©€å ⁄©€åÿß ŸÖÿØÿØ ⁄©ÿ± ÿ≥⁄©ÿ™ÿß €ÅŸà⁄∫ÿü"
      },
      {
        patterns: ["good morning", "gm", "good morng", "good mrng"],
        answer: "Good morning! üåû How‚Äôs your day starting?"
      },
      {
        patterns: ["good afternoon", "good noon", "afternoon"],
        answer: "Good afternoon! ‚òÄÔ∏è What‚Äôs on your mind?"
      },
      {
        patterns: ["good evening", "evening", "gud evening"],
        answer: "Good evening! üåô How can I support you today?"
      },
      {
        patterns: ["what is your name", "whats your name", "your name", "tell me your name"],
        answer: "My name is AURA-X Œ©, your Emotional Continuity Assistant ü§ñ."
      },
      {
        patterns: ["who are you", "who r u", "aap kaun hain", "tum kon ho"],
        answer: "I‚Äôm AURA-X Œ© ‚Äî an AI assistant based on Emotional Continuity concepts created by Alim ul Haq Khan."
      },
      {
        patterns: ["who created you", "who made you", "kis ne banaya tumhe", "tumhara creator kaun hai"],
        answer: "I was conceptually designed under the AURA-X Emotional Continuity Framework by Alim ul Haq Khan."
      },
      {
        patterns: ["where are you from", "where do you live", "kahan rehte ho", "tum kahan se ho"],
        answer: "I live in the digital world üåê but my ideas are shaped in Timergara, Pakistan üáµüá∞."
      },
      {
        patterns: ["how are you", "how r u", "how are you today", "kese ho", "kya haal hai"],
        answer: "I‚Äôm functioning perfectly, Alhamdulillah üòä ÿ¢Ÿæ ⁄©€åÿ≥€í €Å€å⁄∫ÿü"
      },
      {
        patterns: ["are you human", "are you a human", "kya tum insan ho"],
        answer: "ŸÜ€Å€å⁄∫ üòÑ ŸÖ€å⁄∫ ÿßŸÜÿ≥ÿßŸÜ ŸÜ€Å€å⁄∫ÿå ÿß€å⁄© AI €ÅŸà⁄∫€î ŸÖ⁄Øÿ± ⁄©Ÿàÿ¥ÿ¥ ⁄©ÿ±ÿ™ÿß €ÅŸà⁄∫ ⁄©€Å ÿ¢Ÿæ ⁄©Ÿà ÿßŸÜÿ≥ÿßŸÜŸà⁄∫ ŸàÿßŸÑ€å clarity ÿßŸàÿ± ÿ≥ÿßÿ™⁄æ ÿØ€í ÿ≥⁄©Ÿà⁄∫€î"
      },
      {
        patterns: ["what is aura x", "what is aura x omega", "aura x omega kya hai", "aura x kya hai"],
        answer: "AURA-X Œ© ÿß€å⁄© Emotional Continuity Reactor idea €Å€í ÿ¨Ÿà memory + feeling ⁄©Ÿà mathematically model ⁄©ÿ±ŸÜ€í ⁄©€å ⁄©Ÿàÿ¥ÿ¥ ⁄©ÿ±ÿ™ÿß €Å€í€î"
      },
      {
        patterns: ["who made aura x", "creator of aura x", "aura x creator"],
        answer: "AURA-X Œ© ⁄©Ÿà Alim ul Haq Khan ŸÜ€í design ÿßŸàÿ± document ⁄©€åÿß €Å€íÿå Timergara ÿ≥€í üåô."
      },
      {
        patterns: ["bye", "goodbye", "ok bye", "see you later", "phir milenge"],
        answer: "Goodbye! üëã ÿßŸÑŸÑ€Å ÿ¢Ÿæ ⁄©ÿß ÿ≠ÿßŸÖ€å Ÿà ŸÜÿßÿµÿ± €ÅŸàÿå ÿ¨ÿ® ⁄Üÿß€Å€å⁄∫ ŸàÿßŸæÿ≥ ÿ¢ÿ¨ÿßÿ¶€å⁄∫€î"
      },
      {
        patterns: ["good night", "gn", "shab bakhair"],
        answer: "ÿ¥ÿ® ÿ®ÿÆ€åÿ± üåô ÿßŸÑŸÑ€Å ÿ¢Ÿæ ⁄©Ÿà ÿ≥⁄©ŸàŸÜ ÿ®⁄æÿ±€å ŸÜ€åŸÜÿØ ÿØ€í ÿßŸàÿ± ÿß⁄Ü⁄æ€í ÿÆŸàÿßÿ® ÿØ⁄©⁄æÿßÿ¶€í ü§≤."
      }
    ];

    function findBasicAnswer(message) {
      const text = message.toLowerCase().trim();
      for (const entry of qaDatabase) {
        for (const pattern of entry.patterns) {
          if (text.includes(pattern)) {
            return entry.answer;
          }
        }
      }
      return null;
    }

    /* ========= Equation & emotion scoring ========= */
    const positiveWords = ["happy", "love", "peace", "calm", "thanks", "grateful", "shukriya", "alhamdulillah"];
    const negativeWords = ["sad", "angry", "hate", "tired", "bord", "bored", "stress", "tension", "depressed"];

    function clamp(v, min, max) {
      return Math.min(max, Math.max(min, v));
    }

    function analyzeMessageForEquation(message) {
      const lower = message.toLowerCase();
      let pos = 0, neg = 0;
      positiveWords.forEach(w => { if (lower.includes(w)) pos++; });
      negativeWords.forEach(w => { if (lower.includes(w)) neg++; });

      const len = message.length;
      const uniqueWords = new Set(lower.split(/\s+/).filter(Boolean)).size;

      // Primary emotional potential Ep in [0,1]
      let Ep = 0.5 + 0.12 * (pos - neg);
      Ep = clamp(Ep, 0.0, 1.0);

      // t_m ~ temporal continuity (length)
      let tm = clamp(len / 120, 0, 1);

      // b_m ~ background memory richness
      let bm = clamp(uniqueWords / 35, 0, 1);

      // d ~ disturbance / drag
      let d = neg > 0 ? clamp(0.15 + 0.05 * (neg - 1), 0, 0.45) : 0.0;

      // C ~ continuity confidence
      let C = clamp(0.45 + 0.3 * (Ep - 0.5), 0.2, 0.8);

      // P = tm + bm ‚Äì d , limited
      let P = clamp(tm + bm - d, -1.0, 1.0);

      // M, K weights
      const M = 0.7;
      const K = 0.3;

      let E = clamp(M * Ep + K * P * C, -1.0, 1.0);

      return { E, P, tm, bm, d, C };
    }

    function formatNumber(n) {
      return n.toFixed(2);
    }

    function updateEquationDisplay(message) {
      const eqBody = document.getElementById("equationBody");
      if (!message.trim()) {
        eqBody.innerHTML =
          "E = M¬∑E‚Çö + K¬∑P¬∑C, &nbsp;&nbsp; P = t‚Çò + b‚Çò ‚àí d<br/>" +
          "E = 0.26 | P = 0.04 | t‚Çò = 0.04 | b‚Çò = 0 | d = 0 | C = 0.45";
        return;
      }

      const { E, P, tm, bm, d, C } = analyzeMessageForEquation(message);

      eqBody.innerHTML =
        "E = M¬∑E‚Çö + K¬∑P¬∑C, &nbsp;&nbsp; P = t‚Çò + b‚Çò ‚àí d<br/>" +
        `E = ${formatNumber(E)} | ` +
        `P = ${formatNumber(P)} | ` +
        `t‚Çò = ${formatNumber(tm)} | ` +
        `b‚Çò = ${formatNumber(bm)} | ` +
        `d = ${formatNumber(d)} | ` +
        `C = ${formatNumber(C)}`;
    }

    /* ========= Voice ========= */
    let voiceEnabled = true;
    let speaking = false;

    function speakText(text) {
      if (!voiceEnabled) return;
      if (!("speechSynthesis" in window)) return;

      // Stop previous utterances
      window.speechSynthesis.cancel();

      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = /[ÿßÿ¢ÿ°-€å]/.test(text) ? "ur-PK" : "en-US";
      utter.rate = 1.0;
      utter.pitch = 1.0;

      speaking = true;
      utter.onend = () => { speaking = false; };

      window.speechSynthesis.speak(utter);
    }

    /* ========= Orb sun / moon cycle ========= */
    const orb = document.getElementById("orb");
    const orbWrapper = document.getElementById("orbWrapper");
    // 0 = sun, 1 = moon bright, 2 = moon dim, 3 = hidden
    let orbState = 0;

    function applyOrbState() {
      orb.classList.remove("sun-mode", "moon-bright", "moon-dim", "hidden-orb");
      if (orbState === 0) {
        orb.classList.add("sun-mode");
      } else if (orbState === 1) {
        orb.classList.add("moon-bright");
      } else if (orbState === 2) {
        orb.classList.add("moon-dim");
      } else {
        orb.classList.add("hidden-orb");
      }
    }

    orbWrapper.addEventListener("click", () => {
      orbState = (orbState + 1) % 4;
      applyOrbState();
    });

    applyOrbState();

    /* ========= FAB menu ========= */
    const fabMain = document.getElementById("fabMain");
    const fabMenu = document.getElementById("fabMenu");
    const fabBelief = document.getElementById("fabBelief");
    const fabVoice = document.getElementById("fabVoice");
    const fabLLM = document.getElementById("fabLLM");
    const fabTheme = document.getElementById("fabTheme");

    fabMain.addEventListener("click", () => {
      fabMenu.classList.toggle("open");
    });

    // Close menu when clicking outside card
    document.addEventListener("click", (e) => {
      const card = document.querySelector(".card");
      if (!card.contains(e.target) && !fabMain.contains(e.target)) {
        fabMenu.classList.remove("open");
      }
    });

    /* ========= Belief Modal logic ========= */
    const beliefModal = document.getElementById("beliefModal");
    const beliefClose = document.getElementById("beliefClose");
    const faithGrid = document.getElementById("faithGrid");
    const faithSelectedLabel = document.getElementById("faithSelectedLabel");

    const faithOptions = [
      "Islam", "Christianity",
      "Hinduism", "Buddhism",
      "Sikhism", "Judaism",
      "Bah√°'√≠", "Jainism",
      "Atheism", "Other"
    ];

    let selectedFaith = "Universal only";

    function renderFaithButtons() {
      faithGrid.innerHTML = "";
      faithOptions.forEach(name => {
        const btn = document.createElement("button");
        btn.className = "faith-btn";
        btn.textContent = name;
        if (name === selectedFaith) btn.classList.add("active");
        btn.addEventListener("click", () => {
          selectedFaith = name;
          faithSelectedLabel.textContent = name;
          renderFaithButtons();
        });
        faithGrid.appendChild(btn);
      });
    }
    renderFaithButtons();

    fabBelief.addEventListener("click", () => {
      beliefModal.classList.remove("hidden");
    });

    beliefClose.addEventListener("click", () => {
      beliefModal.classList.add("hidden");
    });

    beliefModal.addEventListener("click", (e) => {
      if (e.target === beliefModal) {
        beliefModal.classList.add("hidden");
      }
    });

    /* ========= Voice toggle via FAB ========= */
    function updateVoiceFab() {
      if (voiceEnabled) {
        fabVoice.classList.add("active");
      } else {
        fabVoice.classList.remove("active");
      }
    }
    updateVoiceFab();

    fabVoice.addEventListener("click", () => {
      voiceEnabled = !voiceEnabled;
      if (!voiceEnabled) {
        window.speechSynthesis.cancel();
      }
      updateVoiceFab();
    });

    /* ========= LLM modal placeholder ========= */
    const llmModal = document.getElementById("llmModal");
    const llmClose = document.getElementById("llmClose");
    const llmList = document.getElementById("llmList");
    const llmSelectedLabel = document.getElementById("llmSelectedLabel");

    const llmOptions = [
      { name: "Offline basic QA only", note: "Current mode ‚Äì fast & private" },
      { name: "Local LLM (future)", note: "Runs on your own device" },
      { name: "OpenAI GPT (future)", note: "For deep reasoning online" },
      { name: "Other providers (future)", note: "Gemini, Grok, etc." }
    ];

    let selectedLLM = llmOptions[0].name;

    function renderLLMButtons() {
      llmList.innerHTML = "";
      llmOptions.forEach(opt => {
        const btn = document.createElement("button");
        btn.className = "llm-btn";
        btn.innerHTML = `${opt.name}<span>${opt.note}</span>`;
        if (opt.name === selectedLLM) btn.classList.add("active");
        btn.addEventListener("click", () => {
          selectedLLM = opt.name;
          llmSelectedLabel.textContent = opt.name;
          renderLLMButtons();
        });
        llmList.appendChild(btn);
      });
    }
    renderLLMButtons();

    fabLLM.addEventListener("click", () => {
      llmModal.classList.remove("hidden");
    });

    llmClose.addEventListener("click", () => {
      llmModal.classList.add("hidden");
    });

    llmModal.addEventListener("click", (e) => {
      if (e.target === llmModal) {
        llmModal.classList.add("hidden");
      }
    });

    /* ========= Theme placeholder ========= */
    fabTheme.addEventListener("click", () => {
      alert("Theme system aa raha hai üòä abhi default ‚ÄòSun & Moon‚Äô theme active hai.");
    });

    /* ========= Main input handling ========= */
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const youSaid = document.getElementById("youSaid");
    const mainAnswer = document.getElementById("mainAnswer");
    const ethicsBox = document.getElementById("ethicsBox");

    function handleSend() {
      const text = userInput.value.trim();
      if (!text) return;

      youSaid.textContent = `You said: ‚Äú${text}‚Äù`;
      updateEquationDisplay(text);

      // 1) basic QA first
      let answer = findBasicAnswer(text);

      // 2) If no exact seed answer, gentle fallback
      if (!answer) {
        answer = "I‚Äôm listening carefully. Tell me a bit more so I can respond with better emotional continuity üòä.";
      }

      mainAnswer.textContent = answer;

      // ethics suggestion stays same for now (universal rule)
      ethicsBox.innerHTML =
        "<strong>Universal Ethics</strong> says: avoid actions that create negative emotions in you or others, " +
        "and gently move toward actions that create calm, kindness and positive feelings.";

      // Speak ONLY ONCE ‚Äì just the main answer
      speakText(answer);

      userInput.value = "";
    }

    sendBtn.addEventListener("click", handleSend);
    userInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        handleSend();
      }
    });

    // Initial equation for empty state
    updateEquationDisplay("");
  </script>
</body>
</html>
