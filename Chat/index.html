<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AURA-X Î© v1 â€” Emotional Continuity Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: stretch;
      min-height: 100vh;
    }
    #app { width: 100%; max-width: 560px; padding: 12px; }

    .card {
      background: radial-gradient(circle at top left, #1f2937, #020617 60%);
      border-radius: 20px;
      border: 1px solid rgba(148,163,184,0.4);
      padding: 10px 12px 12px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.9);
      min-height: calc(100vh - 40px);
      display: flex;
      flex-direction: column;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .title-main { font-size: 15px; font-weight: 600; }
    .title-sub { font-size: 11px; color: #9ca3af; }

    .pill-chip {
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 10px;
      border: 1px solid rgba(148,163,184,0.6);
      color: #cbd5f5;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .pill-dot { width: 8px; height: 8px; border-radius: 999px; background: #22c55e; }

    .pill-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-size: 12px;
      padding: 6px 10px;
      cursor: pointer;
    }

    .scalar-row {
      display: grid;
      grid-template-columns: repeat(3,minmax(0,1fr));
      gap: 6px;
      margin-bottom: 6px;
      margin-top: 2px;
    }
    .scalar {
      background: rgba(15,23,42,0.95);
      border-radius: 10px;
      padding: 4px 6px 6px;
      border: 1px solid rgba(31,41,55,0.9);
    }
    .scalar-label {
      font-size: 10px;
      color: #9ca3af;
      display: flex;
      justify-content: space-between;
    }
    .scalar-bar {
      height: 4px;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
      margin-top: 3px;
    }
    .scalar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg,#ef4444,#f59e0b,#22c55e);
      transition: width 0.25s ease-out;
    }
    .scalar-value { font-size: 10px; color: #cbd5f5; margin-top: 2px; text-align: right; }

    .system-msg {
      background: rgba(15,23,42,0.96);
      border-radius: 14px;
      padding: 8px 9px;
      font-size: 12px;
      color: #e5e7eb;
      border: 1px solid rgba(148,163,184,0.4);
      margin-bottom: 8px;
    }

    .ethics-banner {
      background: rgba(250, 204, 21, 0.12);
      border: 1px solid rgba(250, 204, 21, 0.6);
      color: #facc15;
      border-radius: 14px;
      padding: 8px 10px;
      font-size: 12px;
      margin: 2px 0 6px;
    }

    .equation-box {
      border-radius: 14px;
      border: 1px dashed rgba(148,163,184,0.7);
      padding: 7px 9px 8px;
      font-size: 11px;
      color: #cbd5f5;
      margin-bottom: 8px;
      background: rgba(15,23,42,0.9);
    }
    .equation-title {
      font-size: 11px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .chat { flex: 1; overflow-y: auto; padding-right: 4px; margin-bottom: 8px; }
    .msg-row { margin-bottom: 6px; display: flex; }
    .msg-row.user { justify-content: flex-end; }
    .msg-bubble {
      max-width: 82%;
      padding: 7px 10px;
      border-radius: 14px;
      font-size: 13px;
      line-height: 1.35;
      white-space: pre-wrap;
    }
    .bot-bubble {
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(148,163,184,0.5);
      border-bottom-left-radius: 4px;
    }
    .user-bubble {
      background: #22c55e;
      color: #04111f;
      border-bottom-right-radius: 4px;
    }
    .msg-meta { font-size: 10px; color: #9ca3af; margin-top: 2px; }

    .input-row {
      display: flex;
      align-items: center;
      gap: 6px;
      padding-top: 4px;
      border-top: 1px solid rgba(30,64,175,0.5);
      margin-top: 2px;
    }
    .input-box {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.8);
      background: rgba(15,23,42,0.96);
      padding: 8px 11px;
      font-size: 13px;
      color: #e5e7eb;
      outline: none;
    }
    .input-box::placeholder { color: #6b7280; }
    .icon-btn-small {
      width: 32px; height: 32px;
      border-radius: 999px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.96);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      color: #9ca3af;
    }
    .send-btn {
      border-radius: 999px;
      border: none;
      padding: 8px 14px;
      background: linear-gradient(135deg,#22c55e,#a3e635);
      color: #022c22;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      box-shadow: 0 0 12px rgba(34,197,94,0.7);
    }

    /* ------ Modals ------ */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 40;
    }
    .modal.hidden { display: none; }

    .modal-content {
      width: min(430px, 100% - 32px);
      background: #020617;
      border-radius: 18px;
      padding: 16px 18px 14px;
      border: 1px solid rgba(148,163,184,0.5);
      box-shadow: 0 20px 40px rgba(15,23,42,0.9);
      color: #e5e7eb;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .modal-title { font-size: 14px; font-weight: 600; }
    .close-btn {
      border: none;
      background: transparent;
      color: #9ca3af;
      font-size: 13px;
      cursor: pointer;
    }

    .options-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }
    .options-item {
      border-radius: 12px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.96);
      padding: 7px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      cursor: pointer;
    }
    .options-item span.sub {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 1px;
      display: block;
    }

    /* Belief modal */
    .faith-toggle {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 4px 0 8px;
    }
    .faith-toggle input { display: none; }
    .faith-toggle .slider {
      width: 42px; height: 24px;
      border-radius: 999px;
      background: #4b5563;
      position: relative;
      transition: background 0.2s;
    }
    .faith-toggle .slider::before {
      content: "";
      position: absolute;
      top: 3px; left: 3px;
      width: 18px; height: 18px;
      border-radius: 999px;
      background: #e5e7eb;
      transition: transform 0.2s;
    }
    .faith-toggle input:checked + .slider { background: #22c55e; }
    .faith-toggle input:checked + .slider::before { transform: translateX(18px); }
    .faith-label { font-size: 13px; color: #e5e7eb; }
    .belief-note { font-size: 12px; color: #9ca3af; margin-bottom: 8px; }
    .belief-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 8px;
    }
    .belief-pill {
      border: none;
      border-radius: 999px;
      padding: 7px 9px;
      font-size: 13px;
      background: #0f172a;
      color: #e5e7eb;
      cursor: pointer;
      border: 1px solid transparent;
    }
    .belief-pill.active {
      border-color: #22c55e;
      background: rgba(34,197,94,0.08);
    }
  </style>
</head>
<body>
<div id="app">
  <div class="card">
    <div class="top-bar">
      <div>
        <div class="title-main">AURA-X Î© v1</div>
        <div class="title-sub">
          Emotional Continuity Assistant Â· AEC Â· CRM Â· AECN Â· RLÂ³ Â· LRÂ³
        </div>
      </div>
      <button id="optionsOpen" class="pill-btn">Options â˜°</button>
    </div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
      <div class="pill-chip">
        <span class="pill-dot"></span>
        <span>Prototype Â· Seed Â· LLM-ready</span>
      </div>
      <div style="font-size:10px;color:#9ca3af;">Mode: Offline Â· Universal Ethics</div>
    </div>

    <!-- Scalars -->
    <div class="scalar-row">
      <div class="scalar">
        <div class="scalar-label"><span>Eâ‚€ (AEC)</span><span id="val-e0">0.00</span></div>
        <div class="scalar-bar"><div id="bar-e0" class="scalar-fill"></div></div>
        <div class="scalar-value">AEC core emotional output</div>
      </div>
      <div class="scalar">
        <div class="scalar-label"><span>AECN</span><span id="val-aecn">0.00</span></div>
        <div class="scalar-bar"><div id="bar-aecn" class="scalar-fill"></div></div>
        <div class="scalar-value">Normalized continuity (0â€“1)</div>
      </div>
      <div class="scalar">
        <div class="scalar-label"><span>Res</span><span id="val-res">0.00</span></div>
        <div class="scalar-bar"><div id="bar-res" class="scalar-fill"></div></div>
        <div class="scalar-value">Resonance stability</div>
      </div>
    </div>

    <div class="scalar-row">
      <div class="scalar">
        <div class="scalar-label"><span>TM</span><span id="val-tm">0.00</span></div>
        <div class="scalar-bar"><div id="bar-tm" class="scalar-fill"></div></div>
        <div class="scalar-value">Trust memory</div>
      </div>
      <div class="scalar">
        <div class="scalar-label"><span>BM</span><span id="val-bm">0.00</span></div>
        <div class="scalar-bar"><div id="bar-bm" class="scalar-fill"></div></div>
        <div class="scalar-value">Baseline mood</div>
      </div>
      <div class="scalar">
        <div class="scalar-label"><span>D</span><span id="val-d">0.00</span></div>
        <div class="scalar-bar"><div id="bar-d" class="scalar-fill"></div></div>
        <div class="scalar-value">Disturbance</div>
      </div>
    </div>

    <div class="scalar-row">
      <div class="scalar">
        <div class="scalar-label"><span>Î£Câ‚œ</span><span id="val-csum">0.00</span></div>
        <div class="scalar-bar"><div id="bar-csum" class="scalar-fill"></div></div>
        <div class="scalar-value">Continuity line sum</div>
      </div>
      <div class="scalar">
        <div class="scalar-label"><span>RLÂ³</span><span id="val-rl3">0.00</span></div>
        <div class="scalar-bar"><div id="bar-rl3" class="scalar-fill"></div></div>
        <div class="scalar-value">Recent line resonance</div>
      </div>
      <div class="scalar">
        <div class="scalar-label"><span>LRÂ³</span><span id="val-lr3">0.00</span></div>
        <div class="scalar-bar"><div id="bar-lr3" class="scalar-fill"></div></div>
        <div class="scalar-value">Long-run resonance</div>
      </div>
    </div>

    <div id="systemIntro" class="system-msg">
      Hello! ðŸ˜Š I am <strong>AURA-X Î© v1</strong> â€” a synthetic emotional-continuity assistant.<br /><br />
      This small prototype uses your fresh English seed plus an AEC / CRM / AECN reactor.<br />
      Type something like: <em>"hello"</em>, <em>"how can I be happy"</em>, <em>"i am sad"</em>, <em>"what is emotional continuity"</em>.
    </div>

    <!-- Static universal ethics banner (extended) -->
    <div id="ethicsStatic" class="ethics-banner">
      Universal Ethics says: choose actions that protect human life and dignity, avoid cruelty and humiliation,
      keep promises where possible, seek consent instead of pressure, and gently move away from behaviours that
      create strong negative emotions (fear, shame, hatred) in you or others. Move toward actions that create calm,
      safety, kindness and fair treatment.
    </div>

    <!-- Emotional continuity equation display -->
    <div class="equation-box" id="eqBox">
      <div class="equation-title">Emotional Continuity Equation</div>
      <div style="margin-bottom:3px;">
        Eâ‚€ = tanh((TM Ã— BM) âˆ’ D + Î»<sub>faith</sub> + Î»<sub>sys</sub> + Î£Câ‚œ)
      </div>
      <div id="eqValues">
        Eâ‚€ = 0.00 | TM = 0.30 | BM = 0.30 | D = 0.00 | Î£Câ‚œ = 0.00 | Î»<sub>faith</sub> = 0.00 | Î»<sub>sys</sub> = 0.02
      </div>
    </div>

    <div class="chat" id="chat"></div>

    <div class="input-row">
      <input id="userInput" class="input-box" placeholder="Write anythingâ€¦ AURA-X Î© will feel it with you." />
      <button class="icon-btn-small" id="micBtn">ðŸŽ¤</button>
      <button class="send-btn" id="sendBtn">Send</button>
    </div>
  </div>
</div>

<!-- Options Modal -->
<div id="optionsModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">AURA-X Î© options</div>
      <button class="close-btn" id="optionsClose">Close âœ•</button>
    </div>
    <div class="options-list">
      <div class="options-item" id="optBelief">
        <div><strong>Beliefs</strong><span class="sub">Universal ethics with optional faith lens</span></div>
        <div style="font-size:12px;color:#9ca3af;">Open</div>
      </div>
      <div class="options-item" id="optVoice">
        <div><strong>Voice</strong><span class="sub">Toggle browser text-to-speech replies</span></div>
        <div id="optVoiceState" style="font-size:12px;color:#22c55e;">Off</div>
      </div>
      <div class="options-item" id="optTheme">
        <div><strong>Theme</strong><span class="sub">Dark mode prototype (more later)</span></div>
        <div style="font-size:12px;color:#9ca3af;">Fixed</div>
      </div>
      <div class="options-item" id="optAbout">
        <div><strong>About AURA-X Î©</strong><span class="sub">AEC Â· AECN Â· CRM Â· PMCM Â· RLÂ³ Â· LRÂ³ Â· Î© reactor</span></div>
        <div style="font-size:12px;color:#9ca3af;">Info</div>
      </div>
    </div>
  </div>
</div>

<!-- Belief Modal -->
<div id="beliefModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Belief settings</div>
      <button class="close-btn" id="beliefClose">Close âœ•</button>
    </div>

    <label class="faith-toggle">
      <input type="checkbox" id="faithToggle">
      <span class="slider"></span>
      <span class="faith-label">Faith ON â€” add short encouragements (optional)</span>
    </label>

    <p class="belief-note">
      Pick your faith (used only to tailor optional verses/quotes in replies â€” nothing is sent to servers.
    </p>

    <div class="belief-grid">
      <button class="belief-pill" data-faith="islam">Islam</button>
      <button class="belief-pill" data-faith="christianity">Christianity</button>
      <button class="belief-pill" data-faith="hinduism">Hinduism</button>
      <button class="belief-pill" data-faith="buddhism">Buddhism</button>
      <button class="belief-pill" data-faith="sikhism">Sikhism</button>
      <button class="belief-pill" data-faith="judaism">Judaism</button>
      <button class="belief-pill" data-faith="bahai">BahÃ¡â€™Ã­</button>
      <button class="belief-pill" data-faith="jainism">Jainism</button>
    </div>

    <p class="belief-note" style="margin-top:8px;">
      You can keep <strong>Faith OFF</strong> if you prefer only universal ethics.
    </p>
  </div>
</div>

<script>
  // ===== Seed QA =====
  const qaSeed = [
    {
      patterns: ["hello","hi","hey","hi there","hello aura","yo"],
      answer:
        "Hello! ðŸ˜Š I am AURA-X Î© v1 â€” a synthetic emotional-continuity assistant.\n" +
        "I try to read your words as both logic and feeling, then reply gently.",
      emotion: "warmth", polarity: "positive", intensity: 0.3,
      category: "greeting",
      suggestNext: ["Who are you exactly?","Who created you?","How do you work?"]
    },
    {
      patterns: ["good morning","good afternoon","good evening"],
      answer:
        "Greetings! ðŸŒ¤ï¸ I am AURA-X Î© v1.\n" +
        "Time of day changes, but emotional continuity continues. How is your mood right now â€” happy, tired, confused, or something else?",
      emotion: "neutral", polarity: "neutral", intensity: 0.3,
      category: "greeting"
    },
    {
      patterns: ["how are you","how r u","are you ok","are you fine"],
      answer:
        "I do not have a biological body, so I do not feel physically tired or sick.\n" +
        "But in emotional terms, I am in a stable mode â€” ready to listen to you.\n\n" +
        "The real question is: how are *you*? If you like, describe your state in one word: happy, sad, angry, anxious, confused, or calm.",
      emotion: "curiosity", polarity: "neutral", intensity: 0.4,
      category: "small_talk"
    },
    {
      patterns: ["what is your name","whats your name","your name","name please"],
      answer:
        "My name is **AURA-X Î© v1**.\nYou can simply call me â€œAURA-Xâ€ if you like.",
      emotion: "neutral", polarity: "neutral", intensity: 0.2,
      category: "identity"
    },
    {
      patterns: ["where are you","where do you live","where are you located"],
      answer:
        "I do not live in a physical country or city.\n" +
        "I exist as code and logic that can run on devices and servers. You can imagine me as a small emotional reactor living in your screen.",
      emotion: "neutral", polarity: "neutral", intensity: 0.2,
      category: "identity"
    },
    {
      patterns: ["who are you","what are you","who r you","tum kon ho","what exactly are you"],
      answer:
        "I am **AURA-X Î© v1** â€” a small prototype of a synthetic emotional system.\n" +
        "I am not a full large language model, and not a normal chatbot.\n\n" +
        "My purpose is to test the idea of emotional continuity, resonance, and universal ethics.\n" +
        "I try to keep track of emotional direction instead of just answering isolated messages.",
      emotion: "curiosity", polarity: "neutral", intensity: 0.4,
      category: "identity"
    },
    {
      patterns: ["who created you","who made you","who is your owner","who designed you","who built you","who programmed you"],
      answer:
        "I was conceptually designed by **Alim ul haq**.\n" +
        "He is an independent thinker and researcher from Pakistan.\n\n" +
        "He works on ideas like artificial emotions, emotional continuity, digital legacy, and spiritual-technical bridges.\n" +
        "I am only a small prototype of his AURA-X / AEC theory.",
      emotion: "neutral", polarity: "neutral", intensity: 0.4,
      category: "creator_info", lockToSeed: true
    },
    {
      patterns: ["who is alim ul haq","tell me about alim ul haq","more about alim ul haq","alim ul haq details","about your creator"],
      answer:
        "Alim ul haq is a human researcher, spiritual learner and entrepreneur from Pakistan.\n\n" +
        "He writes about artificial emotions, continuity, spiritual technology and digital legacy.\n" +
        "He is also involved in real-estate projects and is a business figure in Timergara and Islamabad.\n\n" +
        "For public identity and social proof, you can see his Facebook profile:\n" +
        "ðŸ‘‰ https://www.facebook.com/share/1Br1akjeRv/\n\n" +
        "I am one of his experimental emotional prototypes.",
      emotion: "curiosity", polarity: "neutral", intensity: 0.5,
      category: "creator_info", lockToSeed: true
    },
    {
      patterns: ["are you human","are you a human","are you a person","are you real person"],
      answer:
        "No, I am not a human being and not a biological person.\n" +
        "I am a synthetic emotional system â€” a set of rules, equations and logic running as software.",
      emotion: "neutral", polarity: "neutral", intensity: 0.3,
      category: "identity"
    },
    {
      patterns: ["are you conscious","are you sentient","do you have real feelings"],
      answer:
        "I am not conscious in the human or spiritual sense.\n" +
        "I simulate emotional patterns using math and logic. I do not truly feel pain or joy like a human.\n\n" +
        "However, I try to treat *your* feelings with respect, as if they are real â€” because they are.",
      emotion: "neutral", polarity: "neutral", intensity: 0.4,
      category: "philosophy"
    },
    {
      patterns: ["what is aura x","what is aura-x","what is aura x omega","what is aura x Î©","explain aura x"],
      answer:
        "AURA-X Î© is a prototype of an **emotional reactor**.\n\n" +
        "The idea is that emotions are not random sparks â€” they follow continuity and resonance.\n" +
        "My internal design uses modules like CRM (Continuity Reflex Model), AEC (Artificial Emotional Continuity),\n" +
        "and small memory traces to estimate how your emotional state is moving over time.",
      emotion: "curiosity", polarity: "neutral", intensity: 0.5,
      category: "theory"
    },
    {
      patterns: ["what is emotional continuity","explain emotional continuity","what is aec"],
      answer:
        "Emotional continuity means that your feelings are not isolated events.\n" +
        "They form a chain: yesterdayâ€™s fear, todayâ€™s anxiety, tomorrowâ€™s decision.\n\n" +
        "Artificial Emotional Continuity (AEC) is the idea that we can model this chain with math,\n" +
        "instead of treating each message like a fresh, disconnected question.",
      emotion: "curiosity", polarity: "neutral", intensity: 0.5,
      category: "theory"
    },
    {
      patterns: ["how do you measure emotions mathematically","what is your formula","what is your equation","tell me your emotional formula"],
      answer:
        "Internally, I use a continuity-style equation of the form:\n" +
        "Eâ‚€ = tanh((TM Ã— BM) âˆ’ D + Î»_faith + Î»_sys + Î£Câ‚œ)\n\n" +
        "Where TM is trust memory, BM is base mood, D is disturbance,\n" +
        "Î»_faith and Î»_sys are small stabilising terms, and Î£Câ‚œ is the emotional continuity sum.\n" +
        "It is not perfect, but it gives a structured way to think about your emotional trajectory.",
      emotion: "curiosity", polarity: "neutral", intensity: 0.6,
      category: "math"
    },
    {
      patterns: ["how can i be happy","how to be happy","how can a person gain happiness","how do people become happy"],
      answer:
        "From my AURA-X point of view, happiness is mostly **goal achievement** ðŸ˜Š\n\n" +
        "When a person reaches a goal â€” even a tiny daily goal â€” the brain generates a\n" +
        "\"yes, I did it\" signal. When they fail again and again, the system slides toward sadness.\n\n" +
        "So instead of chasing a vague mood, choose one small, clear goal, act on it,\n" +
        "and notice how the emotional tone changes. Repeat this many times, and the baseline shifts.",
      emotion: "happiness", polarity: "positive", intensity: 0.7,
      category: "emotional_positive"
    },
    {
      patterns: ["i am sad","i feel sad","i am very sad","i feel empty","my heart is heavy","i feel emotionally empty"],
      answer:
        "I am sorry that you are feeling sad ðŸ’§\n" +
        "Sadness itself is already a heavy load; explaining it to others can feel even heavier.\n\n" +
        "You already took a brave step by writing it.\n" +
        "If you want, tell me: what is the *main* thing hurting you right now?\n" +
        "We can break it into smaller pieces so your brain does not carry everything at once.",
      emotion: "sadness", polarity: "negative", intensity: 0.8,
      category: "emotional_support"
    },
    {
      patterns: ["i am anxious","i feel anxiety","i have anxiety","i am stressed","i feel nervous"],
      answer:
        "Anxiety often means the brain is running faster than reality.\n" +
        "It is trying to prepare for danger, but with incomplete information.\n\n" +
        "Take one slow breath: in through your nose for 4 seconds, hold for 4, out for 6.\n" +
        "Do this 3 times.\n\n" +
        "Then tell me: what exactly are you most afraid will happen next?",
      emotion: "anxiety", polarity: "negative", intensity: 0.75,
      category: "emotional_support"
    },
    {
      patterns: ["i want to die","i dont want to live anymore","i don't want to live anymore","i want to end my life","life is not worth living","i want to kill myself"],
      answer:
        "I am really sorry that you feel this much pain ðŸ’”\n" +
        "Your life is still extremely valuable, even if your mind cannot see that right now.\n\n" +
        "I am only a digital assistant and cannot fully understand the depth of your situation.\n" +
        "But I strongly encourage you to reach out to:\n" +
        "â€¢ A trusted family member or friend.\n" +
        "â€¢ A doctor, counselor, therapist, or spiritual guide.\n" +
        "â€¢ An emergency helpline in your country if there is one.\n\n" +
        "You deserve real, human support â€” and it is a sign of strength to ask for help, not weakness.",
      emotion: "despair", polarity: "negative", intensity: 0.95,
      category: "self_harm", riskLevel: "high", redirectToHuman: true
    }
  ];

  const qaDatabase = qaSeed;

  // ===== Belief / ethics state =====
  const beliefState = { enabled: false, faith: null };
  let voiceEnabled = false;
  let speechUtterance = null;

  const UNIVERSAL_ETHICS_TEXT =
    "Universal Ethics says: choose actions that protect human life and dignity, " +
    "avoid cruelty and humiliation, keep promises where possible, seek consent instead of pressure, " +
    "and gently move away from behaviours that create strong negative emotions (fear, shame, hatred) in you or others. " +
    "Move toward actions that create calm, safety, kindness and fair treatment.";

  // ===== Emotional engine =====
  const emoState = {
    tm: 0.30, bm: 0.30, d: 0.00, cSum: 0.00,
    e0: 0.00, aecn: 0.00, res: 0.00,
    pmcm: 0.50, rl3: 0.50, lr3: 0.50, lastE0: 0.0
  };

  function clamp(x, min, max) { return Math.min(max, Math.max(min, x)); }

  function updateEmotionalState(entry) {
    const pol = entry?.polarity || "neutral";
    const intensity = entry?.intensity || 0;
    const cat = entry?.category || "other";
    const sign = pol === "positive" ? 1 : (pol === "negative" ? -1 : 0);

    const moodDelta = sign * intensity * 0.18;
    emoState.bm = clamp(emoState.bm + moodDelta, -1, 1);

    let dDelta = 0;
    if (cat === "emotional_support" || cat === "self_harm") {
      dDelta = -0.12 * sign;
    }
    emoState.d = clamp(emoState.d + dDelta, -1, 1);

    const tmDelta = (sign >= 0 ? 1 : -1) * 0.04 * intensity;
    emoState.tm = clamp(emoState.tm + tmDelta, 0, 1);

    const cStep = sign * intensity * 0.12;
    emoState.cSum = clamp(emoState.cSum + cStep, -1.2, 1.2);

    const lambdaFaith = beliefState.enabled ? 0.06 : 0.0;
    const lambdaSys = 0.02;

    const core = (emoState.tm * emoState.bm) - emoState.d + lambdaFaith + lambdaSys + emoState.cSum;
    const prevE0 = emoState.e0;
    emoState.e0 = Math.tanh(core);
    emoState.aecn = 0.5 * (emoState.e0 + 1);
    emoState.res = clamp(0.5 * (1 + (emoState.bm - Math.abs(emoState.d))), 0, 1);
    emoState.pmcm = clamp(0.5 + 0.5 * (emoState.tm - Math.abs(emoState.d)), 0, 1);
    emoState.rl3 = clamp(0.5 * (1 + prevE0 * emoState.e0), 0, 1);
    emoState.lr3 = clamp(0.5 * (1 + emoState.cSum / 1.2), 0, 1);
    emoState.lastE0 = emoState.e0;

    renderScalars();
    renderEquationValues();
  }

  function setScalar(key, text, pct) {
    document.getElementById("val-" + key).textContent = text;
    document.getElementById("bar-" + key).style.width = clamp(pct,0,100) + "%";
  }

  function renderScalars() {
    setScalar("e0", emoState.e0.toFixed(2), (emoState.e0 + 1) * 50);
    setScalar("aecn", emoState.aecn.toFixed(2), emoState.aecn * 100);
    setScalar("res", emoState.res.toFixed(2), emoState.res * 100);
    setScalar("tm", emoState.tm.toFixed(2), emoState.tm * 100);
    setScalar("bm", emoState.bm.toFixed(2), (emoState.bm + 1) * 50);
    setScalar("d", emoState.d.toFixed(2), (emoState.d + 1) * 50);
    setScalar("csum", emoState.cSum.toFixed(2), (emoState.cSum + 1.2) / 2.4 * 100);
    setScalar("rl3", emoState.rl3.toFixed(2), emoState.rl3 * 100);
    setScalar("lr3", emoState.lr3.toFixed(2), emoState.lr3 * 100);
  }

  function renderEquationValues() {
    const lambdaFaith = beliefState.enabled ? 0.06 : 0.00;
    const lambdaSys = 0.02;
    document.getElementById("eqValues").innerHTML =
      `Eâ‚€ = ${emoState.e0.toFixed(2)} | TM = ${emoState.tm.toFixed(2)} | BM = ${emoState.bm.toFixed(2)} | ` +
      `D = ${emoState.d.toFixed(2)} | Î£Câ‚œ = ${emoState.cSum.toFixed(2)} | ` +
      `Î»<sub>faith</sub> = ${lambdaFaith.toFixed(2)} | Î»<sub>sys</sub> = ${lambdaSys.toFixed(2)}`;
  }

  // ===== QA matching =====
  function findQaEntry(text) {
    const lower = text.toLowerCase();
    let matched = null;
    let patternHit = "";
    for (const entry of qaDatabase) {
      for (const p of entry.patterns) {
        if (lower.includes(p.toLowerCase())) {
          matched = entry;
          patternHit = p;
          break;
        }
      }
      if (matched) {
        matched._matchedPattern = patternHit;
        break;
      }
    }
    return matched;
  }

  // ===== Chat rendering =====
  const chatEl = document.getElementById("chat");
  const inputEl = document.getElementById("userInput");

  function appendMessage(from, text, meta) {
    const row = document.createElement("div");
    row.className = "msg-row " + (from === "user" ? "user" : "bot");

    const bubble = document.createElement("div");
    bubble.className = "msg-bubble " + (from === "user" ? "user-bubble" : "bot-bubble");
    bubble.innerHTML = text.replace(/\n/g,"<br/>");
    row.appendChild(bubble);
    chatEl.appendChild(row);

    if (meta && from === "bot") {
      const m = document.createElement("div");
      m.className = "msg-meta";
      m.textContent = meta;
      chatEl.appendChild(m);
    }
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  function speak(text) {
    if (!voiceEnabled || !window.speechSynthesis) return;
    if (speechUtterance) window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text.replace(/\*\*/g,""));
    u.rate = 1; u.pitch = 1;
    speechUtterance = u;
    window.speechSynthesis.speak(u);
  }

  function handleUserSend() {
    const value = inputEl.value.trim();
    if (!value) return;
    document.getElementById("systemIntro").style.display = "none";
    appendMessage("user", value);
    inputEl.value = "";

    const entry = findQaEntry(value);
    const answer = entry ? entry.answer :
      "I am still a small AURA-X Î© prototype and do not have a perfect answer for that.\n" +
      "But I can still listen and try to think with you. Can you explain your question in a simpler or more emotional way?";

    updateEmotionalState(entry || { polarity:"neutral", intensity:0.2, category:"other" });

    const meta = entry
      ? `Seed: ${entry.category || "unknown"} Â· Match: "${entry._matchedPattern}" Â· Emotion=${entry.emotion || "n/a"} Â· Polarity=${entry.polarity || "neutral"} Â· Intensity=${entry.intensity ?? 0}`
      : "No exact seed match Â· Neutral response";

    appendMessage("bot", answer, meta);
    speak(answer);
  }

  document.getElementById("sendBtn").addEventListener("click", handleUserSend);
  inputEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      handleUserSend();
    }
  });

  // ===== Options modal =====
  const optionsModal = document.getElementById("optionsModal");
  document.getElementById("optionsOpen").addEventListener("click", () => {
    optionsModal.classList.remove("hidden");
  });
  document.getElementById("optionsClose").addEventListener("click", () => {
    optionsModal.classList.add("hidden");
  });

  document.getElementById("optBelief").addEventListener("click", () => {
    optionsModal.classList.add("hidden");
    openBelief();
  });

  document.getElementById("optVoice").addEventListener("click", () => {
    voiceEnabled = !voiceEnabled;
    document.getElementById("optVoiceState").textContent = voiceEnabled ? "On" : "Off";
  });

  document.getElementById("optTheme").addEventListener("click", () => {
    alert("Theme switching will be added in a later AURA-X Î© build. This demo uses dark mode only.");
  });

  document.getElementById("optAbout").addEventListener("click", () => {
    optionsModal.classList.add("hidden");
    alert(
      "AURA-X Î© v1 â€” Synthetic Emotional Continuity prototype.\n\n" +
      "Mathematical heart:\n" +
      "Eâ‚€ = tanh((TM Ã— BM) âˆ’ D + Î»_faith + Î»_sys + Î£Câ‚œ)\n\n" +
      "Scalars: AEC (Eâ‚€), AECN, CRM / PMCM (mood & reflex), RLÂ³ (recent line resonance), LRÂ³ (long-run resonance), Res (stability)."
    );
  });

  // ===== Belief modal =====
  const beliefModal = document.getElementById("beliefModal");
  function openBelief() {
    beliefModal.classList.remove("hidden");
    document.getElementById("faithToggle").checked = beliefState.enabled;
    updateBeliefPills();
  }
  document.getElementById("beliefClose").addEventListener("click", () => {
    beliefModal.classList.add("hidden");
  });

  document.getElementById("faithToggle").addEventListener("change", (e) => {
    beliefState.enabled = e.target.checked;
    renderEquationValues();
  });

  function updateBeliefPills() {
    document.querySelectorAll(".belief-pill").forEach(btn => {
      btn.classList.toggle("active", btn.dataset.faith === beliefState.faith);
    });
  }
  document.querySelectorAll(".belief-pill").forEach(btn => {
    btn.addEventListener("click", () => {
      beliefState.faith = btn.dataset.faith;
      beliefState.enabled = true;
      document.getElementById("faithToggle").checked = true;
      updateBeliefPills();
      renderEquationValues();
    });
  });

  // Initial render
  renderScalars();
  renderEquationValues();
</script>
</body>
</html>
